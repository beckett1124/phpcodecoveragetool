<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Spike PHPCoverage Details: orgcontroller.php</title> 
    <link href="../../../../..//css/spikesource.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="pageBox" >

      <table border="0" cellpadding="2" cellspacing="0" id="contentBox" width="100%">
        <tr>
          <td align="left" valign="top"><h1>Spike PHPCoverage Details: orgcontroller.php</h1>
          </td>
        </tr>
        <tr>
          <td>

<table width="100%" border="0" cellpadding="2" cellspacing="0"><td width="10%"class="coverageDetailsHead" >Line #</td><td width="10%" class="coverageDetailsHead">Frequency</td><td  width="80%" class="coverageDetailsHead">Source Line</td><tr><td class="coverageDetails"><span>1</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&lt;?php&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>2</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">3</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">define(&quot;PASSPHRASE_MIN_LENGTH&quot;,&nbsp;&quot;16&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">4</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">define(&quot;KEY_DURATION&quot;,&nbsp;&quot;7776000&quot;);//&nbsp;90&nbsp;days</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">5</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">define(&quot;ORG_ID_LENGTH&quot;,&nbsp;&quot;6&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>6</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>7</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>class&nbsp;OrgController&nbsp;extends&nbsp;FWController&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>8</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//accept&nbsp;a&nbsp;POST&nbsp;request&nbsp;with&nbsp;input&nbsp;as&nbsp;{&quot;connetor_url&quot;:&quot;http://www.google.com:6080&quot;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>9</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;create($args)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">10</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($this-&gt;request-&gt;get_method()&nbsp;!=&nbsp;'POST')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">11</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Must&nbsp;use&nbsp;POST');</span></code></td></tr><tr><td class="coverageDetails"><span>12</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>13</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">14</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">15</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$input&nbsp;=&nbsp;json_decode(&nbsp;$this-&gt;request-&gt;get_input()&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span>16</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>17</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//verify&nbsp;user</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">18</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;User::find_by_uvs_token($uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">19</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$user)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">20</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidTokenException('Invalid&nbsp;uvs&nbsp;access&nbsp;token');</span></code></td></tr><tr><td class="coverageDetails"><span>21</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>22</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//verify&nbsp;SSL&nbsp;certificate</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">23</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$ssl_url&nbsp;=&nbsp;&quot;ssl://&quot;.parse_url($input-&gt;connector_url,PHP_URL_HOST).&quot;:443&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">24</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$ssl_certificate&nbsp;=&nbsp;SSLCert::verify($ssl_url);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">25</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$ssl_certificate)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">26</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>27</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>28</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;connector&nbsp;settings</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">29</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$settings&nbsp;=&nbsp;json_decode(ORGConnector::request_settings($input-&gt;connector_url));</span></code></td></tr><tr><td class="coverageDetails"><span>30</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>31</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//check&nbsp;if&nbsp;the&nbsp;Org&nbsp;is&nbsp;already&nbsp;registered,&nbsp;if&nbsp;name&nbsp;(,&nbsp;or&nbsp;connector_url)&nbsp;exists&nbsp;in&nbsp;DB,&nbsp;then&nbsp;we&nbsp;say&nbsp;the&nbsp;org&nbsp;just&nbsp;wants&nbsp;to&nbsp;update&nbsp;its&nbsp;info&nbsp;(name,&nbsp;connector,&nbsp;settings)</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">32</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$is_new_org&nbsp;=&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">33</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$org1&nbsp;=&nbsp;Org::find_by_connector($input-&gt;connector_url);</span></code></td></tr><tr><td class="coverageDetails"><span>34</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//$org2&nbsp;=&nbsp;Org::find_by_name($ssl_certificate-&gt;get_org_name());</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">35</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($org1&nbsp;||&nbsp;$org2)&nbsp;{&nbsp;//existing&nbsp;org</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">36</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$is_new_org&nbsp;=&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">37</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$old_org&nbsp;=&nbsp;$org1?&nbsp;$org1:&nbsp;$org2;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">38</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;&nbsp;=&nbsp;$old_org-&gt;get_id();</span></code></td></tr><tr><td class="coverageDetails"><span>39</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;//new&nbsp;org</span></code></td></tr><tr><td class="coverageDetails"><span>40</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//request&nbsp;public&nbsp;key&nbsp;from&nbsp;Keyserver</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">41</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key_expiration&nbsp;&nbsp;&nbsp;=&nbsp;time()&nbsp;+&nbsp;KEY_DURATION;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">42</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key_passphrase&nbsp;&nbsp;&nbsp;=&nbsp;Util::gen_random('n',&nbsp;PASSPHRASE_MIN_LENGTH);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">43</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$create_key_input&nbsp;=&nbsp;array(&quot;expiration&quot;&nbsp;=&gt;&nbsp;$key_expiration,&nbsp;&quot;passphrase&quot;&nbsp;=&gt;&nbsp;$key_passphrase);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">44</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;KSConnector::create_key($create_key_input);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">45</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key-&gt;private_key_passphrase&nbsp;=&nbsp;$key_passphrase;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">46</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key-&gt;expiration&nbsp;&nbsp;=&nbsp;$key_expiration;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">47</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$this-&gt;id_generator();</span></code></td></tr><tr><td class="coverageDetails"><span>48</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">49</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$org&nbsp;=&nbsp;Org::create($org_id,&nbsp;$input-&gt;connector_url,&nbsp;$ssl_certificate,&nbsp;$settings,&nbsp;$key,&nbsp;$is_new_org);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">50</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$email_confirmed&nbsp;=false;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">51</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(isset($settings-&gt;contact_info-&gt;email))</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">52</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$email_confirmed&nbsp;=&nbsp;Org::is_email_confirmed($org_id,&nbsp;$settings-&gt;contact_info-&gt;email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">53</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$org)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">54</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Add&nbsp;to&nbsp;database&nbsp;Failed');</span></code></td></tr><tr><td class="coverageDetails"><span>55</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>56</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">57</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">58</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;orgid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$org_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">59</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;orgname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$org-&gt;get_name();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">60</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;connector_url&nbsp;&nbsp;=&nbsp;$input-&gt;connector_url;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">61</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;is_new&nbsp;=&nbsp;$is_new_org;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">62</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;email_confirmed&nbsp;=&nbsp;$email_confirmed?1:0;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">63</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(isset($settings-&gt;icon_url))</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">64</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;icon_url&nbsp;=&nbsp;$settings-&gt;icon_url;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">65</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>66</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>67</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>68</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;delete($args)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;internal&nbsp;usage&nbsp;ONLY</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">69</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($this-&gt;request-&gt;get_method()&nbsp;!=&nbsp;'GET')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">70</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Must&nbsp;use&nbsp;GET');</span></code></td></tr><tr><td class="coverageDetails"><span>71</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>72</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>73</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//search&nbsp;in&nbsp;database&nbsp;by&nbsp;org&nbsp;id</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">74</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">75</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">76</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($org_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">77</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Parameter&nbsp;format&nbsp;is&nbsp;wrong');</span></code></td></tr><tr><td class="coverageDetails"><span>78</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">79</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Org::find($org_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">80</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$org)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">81</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerOrgNotFoundException('Organization&nbsp;does&nbsp;not&nbsp;exist');</span></code></td></tr><tr><td class="coverageDetails"><span>82</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>83</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//check&nbsp;if&nbsp;user&nbsp;is&nbsp;the&nbsp;admin&nbsp;of&nbsp;this&nbsp;org</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">84</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;is_admin($org_id,&nbsp;$uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span>85</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//delete&nbsp;all&nbsp;info&nbsp;for&nbsp;this&nbsp;org</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">86</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">87</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(Org::delete($org_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">88</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;status&nbsp;=&nbsp;&quot;ok&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>89</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>90</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">91</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>92</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>93</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>94</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;request_org($args)&nbsp;{&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">95</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($this-&gt;request-&gt;get_method()&nbsp;!=&nbsp;'GET')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">96</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Must&nbsp;use&nbsp;GET');</span></code></td></tr><tr><td class="coverageDetails"><span>97</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>98</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>99</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//search&nbsp;in&nbsp;database&nbsp;by&nbsp;org&nbsp;id</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">100</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$_GET[&quot;orgid&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">101</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">102</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$_GET[&quot;all&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">103</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$include_demo&nbsp;=&nbsp;$_GET[&quot;demo&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">104</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$login_enabled&nbsp;=&nbsp;$_GET[&quot;login_enabled&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">105</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$changed_since&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$_GET[&quot;changed_since&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">106</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$is_admin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;$_GET[&quot;is_admin&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">107</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span>108</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">109</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;User::find_by_uvs_token($uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">110</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$user&nbsp;&amp;&amp;&nbsp;!$login_enabled)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">111</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidTokenException('Invalid&nbsp;uvs&nbsp;access&nbsp;token');</span></code></td></tr><tr><td class="coverageDetails"><span>112</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">113</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($changed_since&nbsp;&gt;&nbsp;0)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">114</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$orgs&nbsp;=&nbsp;Org::find_by_update_time($changed_since);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">115</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$orgs)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">116</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>117</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">118</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($orgs&nbsp;as&nbsp;$org)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">119</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$basic_info&nbsp;=&nbsp;$org-&gt;get_basic_info();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">120</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($basic_info)&nbsp;and&nbsp;is_object($basic_info)){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">121</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$basic_info-&gt;member_count&nbsp;=&nbsp;Badge::count_by_org($org-&gt;get_id());</span></code></td></tr><tr><td class="coverageDetails"><span>122</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">123</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response[]&nbsp;=&nbsp;$basic_info;</span></code></td></tr><tr><td class="coverageDetails"><span>124</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">125</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>126</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>127</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">128</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(isset($org_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>129</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//search&nbsp;in&nbsp;database&nbsp;by&nbsp;org&nbsp;id</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">130</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org&nbsp;=&nbsp;Org::find($org_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">131</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$org)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">132</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>133</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//throw&nbsp;new&nbsp;ControllerFindRequestException('Organization&nbsp;does&nbsp;not&nbsp;exist');</span></code></td></tr><tr><td class="coverageDetails"><span>134</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">135</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($is_admin)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">136</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;is_admin($org_id,&nbsp;$uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span>137</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">138</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$basic_info&nbsp;=&nbsp;$org-&gt;get_basic_info($is_admin);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">139</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($basic_info)&nbsp;and&nbsp;is_object($basic_info)){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">140</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$basic_info-&gt;member_count&nbsp;=&nbsp;Badge::count_by_org($org_id);</span></code></td></tr><tr><td class="coverageDetails"><span>141</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">142</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response[]&nbsp;=&nbsp;$basic_info;</span></code></td></tr><tr><td class="coverageDetails"><span>143</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>144</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">145</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif($all&nbsp;==&nbsp;1)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">146</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($is_admin)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">147</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;$user-&gt;get_uvs_id();</span></code></td></tr><tr><td class="coverageDetails"><span>148</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">149</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$orgs&nbsp;=&nbsp;Org::find_all($uvs_id,&nbsp;$include_demo,&nbsp;$login_enabled);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">150</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$orgs)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">151</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>152</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">153</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($orgs&nbsp;as&nbsp;$org)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">154</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$basic_info&nbsp;=&nbsp;$org-&gt;get_basic_info($is_admin);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">155</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($basic_info)&nbsp;and&nbsp;is_object($basic_info)){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">156</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$basic_info-&gt;member_count&nbsp;=&nbsp;Badge::count_by_org($org-&gt;get_id());</span></code></td></tr><tr><td class="coverageDetails"><span>157</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">158</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response[]&nbsp;=&nbsp;$basic_info;</span></code></td></tr><tr><td class="coverageDetails"><span>159</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>160</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">161</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>162</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>163</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>164</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//an&nbsp;orgnization&nbsp;could&nbsp;change&nbsp;its&nbsp;settings.&nbsp;It&nbsp;will&nbsp;ask&nbsp;UVS&nbsp;to&nbsp;fetch&nbsp;the&nbsp;new&nbsp;settings</span></code></td></tr><tr><td class="coverageDetails"><span>165</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;update_settings($args)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">166</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($this-&gt;request-&gt;get_method()&nbsp;!=&nbsp;'GET')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">167</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Must&nbsp;use&nbsp;GET');</span></code></td></tr><tr><td class="coverageDetails"><span>168</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>169</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>170</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//search&nbsp;in&nbsp;database&nbsp;by&nbsp;org&nbsp;id</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">171</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">172</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">173</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($org_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">174</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Parameter&nbsp;format&nbsp;is&nbsp;wrong');</span></code></td></tr><tr><td class="coverageDetails"><span>175</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">176</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$org&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Org::find($org_id);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">177</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$org)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">178</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerOrgNotFoundException('Organization&nbsp;does&nbsp;not&nbsp;exist');</span></code></td></tr><tr><td class="coverageDetails"><span>179</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>180</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//check&nbsp;if&nbsp;user&nbsp;is&nbsp;the&nbsp;admin&nbsp;of&nbsp;this&nbsp;org</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">181</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;is_admin($org_id,&nbsp;$uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span>182</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;connector&nbsp;settings</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">183</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span>184</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">185</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;&nbsp;&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">186</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$settings&nbsp;=&nbsp;json_decode(&nbsp;ORGConnector::request_settings(&nbsp;$org-&gt;get_connector()&nbsp;)&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">187</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$contact_email&nbsp;=&nbsp;$settings-&gt;contact_info-&gt;email;</span></code></td></tr><tr><td class="coverageDetails"><span>188</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$settings&nbsp;=&nbsp;$conn-&gt;escape(json_encode($settings));</span></code></td></tr><tr><td class="coverageDetails"><span>189</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>190</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//If&nbsp;it&nbsp;is&nbsp;a&nbsp;new&nbsp;contact&nbsp;email,&nbsp;then&nbsp;send&nbsp;a&nbsp;confirmation&nbsp;code</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">191</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($contact_email)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>192</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email&nbsp;=&nbsp;$conn-&gt;escape($contact_email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">193</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;&nbsp;&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;email&nbsp;=&nbsp;:email&nbsp;AND&nbsp;org_id&nbsp;=&nbsp;:org_id&nbsp;AND&nbsp;confirmed&nbsp;=&nbsp;1&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">194</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query,&nbsp;array(&quot;:email&quot;=&gt;$contact_email,&nbsp;&quot;:org_id&quot;=&gt;$org_id));</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">195</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">196</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;&nbsp;&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;account_email(org_id,&nbsp;email,&nbsp;confirmed,&nbsp;login_enabled,&nbsp;creation_time)&nbsp;VALUES&nbsp;(:org_id,&nbsp;:email,&nbsp;0,&nbsp;0,&nbsp;NOW())&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">197</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query,&nbsp;array(&quot;:org_id&quot;=&gt;$org_id,&nbsp;&quot;:email&quot;=&gt;$contact_email));</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">198</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$email_id&nbsp;=&nbsp;$conn-&gt;last_insert_id();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">199</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Org::send_email_code($email_id,&nbsp;$contact_email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">200</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;email_confirmed&nbsp;=&nbsp;0;</span></code></td></tr><tr><td class="coverageDetails"><span>201</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">202</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;email_confirmed&nbsp;=&nbsp;1;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">203</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;org&nbsp;SET&nbsp;settings&nbsp;=&nbsp;:settings,&nbsp;update_time&nbsp;=&nbsp;NOW()&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;:org_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">204</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Org::update($conn,&nbsp;$query,&nbsp;array(&quot;:settings&quot;=&gt;json_encode($settings),&nbsp;&quot;:org_id&quot;=&gt;$org_id));</span></code></td></tr><tr><td class="coverageDetails"><span>205</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>206</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">207</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;status&nbsp;=&nbsp;&quot;ok&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">208</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>209</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>210</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>211</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;update_visibility($args)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">212</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($this-&gt;request-&gt;get_method()&nbsp;!=&nbsp;'GET')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">213</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Must&nbsp;use&nbsp;GET');</span></code></td></tr><tr><td class="coverageDetails"><span>214</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">215</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">216</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">217</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$visibility&nbsp;&nbsp;=&nbsp;$_GET[&quot;visibility&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">218</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($org_id)&nbsp;||&nbsp;!$visibility&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">219</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Parameter&nbsp;format&nbsp;is&nbsp;wrong');</span></code></td></tr><tr><td class="coverageDetails"><span>220</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>221</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//check&nbsp;if&nbsp;user&nbsp;is&nbsp;the&nbsp;admin&nbsp;of&nbsp;this&nbsp;org</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">222</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;is_admin($org_id,&nbsp;$uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span>223</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">224</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">225</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;&nbsp;&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">226</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$visibility&nbsp;=&nbsp;$conn-&gt;escape($visibility);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">227</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;org&nbsp;SET&nbsp;visibility&nbsp;=&nbsp;:visibility,&nbsp;update_time&nbsp;=&nbsp;NOW()&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;:org_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">228</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Org::update($conn,&nbsp;$query,&nbsp;array(&quot;:visibility&quot;=&gt;$visibility,&nbsp;&quot;:org_id&quot;=&gt;$org_id));</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">229</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;status&nbsp;=&nbsp;&quot;ok&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">230</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>231</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>232</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>233</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;public_key($args)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">234</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($this-&gt;request-&gt;get_method()&nbsp;!=&nbsp;'GET')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">235</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Must&nbsp;use&nbsp;GET');</span></code></td></tr><tr><td class="coverageDetails"><span>236</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>237</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">238</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$arg_num&nbsp;=&nbsp;count($args);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">239</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span>240</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">241</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($arg_num&nbsp;==&nbsp;1)&nbsp;{&nbsp;&nbsp;//get&nbsp;the&nbsp;lastest&nbsp;public&nbsp;key</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">242</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">243</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Org::find($org_id);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">244</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$org)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">245</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerOrgNotFoundException('Organization&nbsp;does&nbsp;not&nbsp;exist');</span></code></td></tr><tr><td class="coverageDetails"><span>246</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>247</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">248</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;public_key&nbsp;=&nbsp;$org-&gt;get_current_public_key();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">249</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;key_fingerprint&nbsp;=&nbsp;$org-&gt;get_key_fingerprint();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">250</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;expiration&nbsp;&nbsp;=&nbsp;$org-&gt;get_key_expiration();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">251</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}elseif($arg_num&nbsp;==&nbsp;2)&nbsp;{&nbsp;//get&nbsp;a&nbsp;key&nbsp;with&nbsp;particular&nbsp;fingerprint</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">252</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">253</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Org::find($org_id);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">254</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$org)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">255</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerOrgNotFoundException('Organization&nbsp;does&nbsp;not&nbsp;exist');</span></code></td></tr><tr><td class="coverageDetails"><span>256</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">257</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fingerprint&nbsp;=&nbsp;$args[1];&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">258</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;KSConnector::request_key($fingerprint);</span></code></td></tr><tr><td class="coverageDetails"><span>259</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">260</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Parameter&nbsp;format&nbsp;is&nbsp;wrong');</span></code></td></tr><tr><td class="coverageDetails"><span>261</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">262</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>263</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>264</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>265</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;confirm_email($args)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">266</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($this-&gt;request-&gt;get_method()&nbsp;!=&nbsp;'GET')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">267</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Must&nbsp;use&nbsp;GET');</span></code></td></tr><tr><td class="coverageDetails"><span>268</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">269</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">270</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$confirmation_code&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">271</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;User::find_by_uvs_token($uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">272</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$user)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">273</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidTokenException('Invalid&nbsp;uvs&nbsp;access&nbsp;token');</span></code></td></tr><tr><td class="coverageDetails"><span>274</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">275</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($confirmation_code))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">276</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Parameter&nbsp;format&nbsp;is&nbsp;wrong');</span></code></td></tr><tr><td class="coverageDetails"><span>277</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">278</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$contact&nbsp;=&nbsp;Org::find_by_email_code($confirmation_code);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">279</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$contact)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">280</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidCodeException('Invalid&nbsp;confirmation&nbsp;code');</span></code></td></tr><tr><td class="coverageDetails"><span>281</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">282</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">283</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$email_id&nbsp;=&nbsp;$contact-&gt;email_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">284</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;&nbsp;&nbsp;=&nbsp;$contact-&gt;org_id;</span></code></td></tr><tr><td class="coverageDetails"><span>285</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>286</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_confirmation_code&nbsp;=&nbsp;$conn-&gt;escape($confirmation_code);</span></code></td></tr><tr><td class="coverageDetails"><span>287</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>288</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;1:&nbsp;update&nbsp;`email_confirmation`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">289</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;email_confirmation&nbsp;SET&nbsp;confirmation_time&nbsp;=&nbsp;NOW()&nbsp;WHERE&nbsp;confirmation_code&nbsp;=&nbsp;:confirmation_code&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">290</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Org::update($conn,&nbsp;$query,&nbsp;array(&quot;:confirmation_code&quot;=&gt;$confirmation_code));</span></code></td></tr><tr><td class="coverageDetails"><span>291</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;2:&nbsp;update&nbsp;`account_email`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">292</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_email&nbsp;SET&nbsp;confirmed&nbsp;=&nbsp;1&nbsp;WHERE&nbsp;email_id&nbsp;=&nbsp;:email_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">293</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Org::update($conn,&nbsp;$query,&nbsp;array(&quot;:email_id&quot;&nbsp;=&gt;&nbsp;$email_id));</span></code></td></tr><tr><td class="coverageDetails"><span>294</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;3:&nbsp;update&nbsp;`org`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">295</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;org&nbsp;SET&nbsp;status&nbsp;=&nbsp;'active',&nbsp;update_time&nbsp;=&nbsp;NOW()&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;:org_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">296</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Org::update($conn,&nbsp;$query,&nbsp;array(&quot;:org_id&quot;=&gt;$org_id));</span></code></td></tr><tr><td class="coverageDetails"><span>297</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>298</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//set&nbsp;user&nbsp;as&nbsp;admin</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">299</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!Org::find_admin($org_id,&nbsp;$user-&gt;get_uvs_id()))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">300</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Org::add_admin($org_id,&nbsp;$user-&gt;get_uvs_id());</span></code></td></tr><tr><td class="coverageDetails"><span>301</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">302</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">303</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;status&nbsp;=&nbsp;&quot;ok&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">304</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;org_id&nbsp;=&nbsp;$org_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">305</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>306</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>307</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>308</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;confirm_org_email($args)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>309</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//if($this-&gt;request-&gt;get_method()&nbsp;!=&nbsp;'GET')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>310</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Must&nbsp;use&nbsp;GET');</span></code></td></tr><tr><td class="coverageDetails"><span>311</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">312</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">313</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;User::find_by_uvs_token($uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">314</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$user)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">315</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidTokenException('Invalid&nbsp;uvs&nbsp;access&nbsp;token');</span></code></td></tr><tr><td class="coverageDetails"><span>316</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">317</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">318</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($org_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">319</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Parameter&nbsp;format&nbsp;is&nbsp;wrong');</span></code></td></tr><tr><td class="coverageDetails"><span>320</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">321</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$confirmation_code&nbsp;=&nbsp;$args[1];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">322</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($confirmation_code))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">323</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Parameter&nbsp;format&nbsp;is&nbsp;wrong');</span></code></td></tr><tr><td class="coverageDetails"><span>324</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">325</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$contact&nbsp;=&nbsp;Org::find_by_email_code($confirmation_code);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">326</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$contact)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">327</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidCodeException('Invalid&nbsp;confirmation&nbsp;code');</span></code></td></tr><tr><td class="coverageDetails"><span>328</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>329</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">330</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$email_id&nbsp;=&nbsp;$contact-&gt;email_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">331</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($org_id&nbsp;!=&nbsp;$contact-&gt;org_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">332</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException(&quot;Org&nbsp;id&nbsp;doesn't&nbsp;match&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>333</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">334</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>335</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$e_confirmation_code&nbsp;=&nbsp;$conn-&gt;escape($confirmation_code);</span></code></td></tr><tr><td class="coverageDetails"><span>336</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$e_org_id&nbsp;=&nbsp;$conn-&gt;escape($org_id);</span></code></td></tr><tr><td class="coverageDetails"><span>337</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>338</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;1:&nbsp;update&nbsp;`email_confirmation`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">339</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;email_confirmation&nbsp;SET&nbsp;confirmation_time&nbsp;=&nbsp;NOW()&nbsp;WHERE&nbsp;confirmation_code&nbsp;=&nbsp;:confirmation_code&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">340</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Org::update($conn,&nbsp;$query,&nbsp;array(&quot;:confirmation_code&quot;=&gt;$confirmation_code));</span></code></td></tr><tr><td class="coverageDetails"><span>341</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;2:&nbsp;update&nbsp;`account_email`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">342</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_email&nbsp;SET&nbsp;confirmed&nbsp;=&nbsp;1&nbsp;WHERE&nbsp;email_id&nbsp;=&nbsp;:email_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">343</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Org::update($conn,&nbsp;$query,&nbsp;array(&quot;:email_id&quot;=&gt;$email_id));</span></code></td></tr><tr><td class="coverageDetails"><span>344</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;3:&nbsp;update&nbsp;`org`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">345</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;org&nbsp;SET&nbsp;status&nbsp;=&nbsp;'active',&nbsp;update_time&nbsp;=&nbsp;NOW()&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;:org_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">346</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Org::update($conn,&nbsp;$query,&nbsp;array(&quot;:org_id&quot;=&gt;$org_id));</span></code></td></tr><tr><td class="coverageDetails"><span>347</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>348</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//set&nbsp;user&nbsp;as&nbsp;admin</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">349</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!Org::find_admin($org_id,&nbsp;$user-&gt;get_uvs_id()))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">350</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Org::add_admin($org_id,&nbsp;$user-&gt;get_uvs_id());</span></code></td></tr><tr><td class="coverageDetails"><span>351</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">352</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">353</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;status&nbsp;=&nbsp;&quot;ok&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">354</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;org_id&nbsp;=&nbsp;$org_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">355</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>356</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>357</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>358</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//add&nbsp;a&nbsp;admin</span></code></td></tr><tr><td class="coverageDetails"><span>359</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;add_admin($args)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">360</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($this-&gt;request-&gt;get_method()&nbsp;!=&nbsp;'POST')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">361</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Must&nbsp;use&nbsp;POST');</span></code></td></tr><tr><td class="coverageDetails"><span>362</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">363</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$input&nbsp;=&nbsp;json_decode(&nbsp;$this-&gt;request-&gt;get_input()&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">364</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">365</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">366</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;$input-&gt;uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">367</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$email&nbsp;&nbsp;=&nbsp;$input-&gt;email;</span></code></td></tr><tr><td class="coverageDetails"><span>368</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//check&nbsp;if&nbsp;user&nbsp;is&nbsp;the&nbsp;admin&nbsp;of&nbsp;this&nbsp;org</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">369</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;is_admin($org_id,&nbsp;$uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span>370</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">371</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">372</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;User::find_by_uvs_id($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">373</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$user)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">374</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerFindRequestException('no&nbsp;such&nbsp;user');</span></code></td></tr><tr><td class="coverageDetails"><span>375</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>376</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>377</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$e_uvs_id&nbsp;=&nbsp;$conn-&gt;escape($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span>378</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_email&nbsp;SET&nbsp;reserved&nbsp;=&nbsp;1&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$e_uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>379</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">380</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;($email)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">381</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!preg_match(&quot;/^[_A-Za-z0-9-]+(.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9-]+)+$/&quot;,&nbsp;$email))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">382</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Invalid&nbsp;email&nbsp;address');</span></code></td></tr><tr><td class="coverageDetails"><span>383</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">384</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id_confirmed&nbsp;=&nbsp;User::find_by_email($email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">385</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id_reserved&nbsp;&nbsp;=&nbsp;User::find_by_email_reserved($email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">386</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;$uvs_id_confirmed&nbsp;?&nbsp;$uvs_id_confirmed&nbsp;:&nbsp;$uvs_id_reserved;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">387</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($uvs_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>388</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//create&nbsp;a&nbsp;reserved&nbsp;uvs_id</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">389</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;User::create($input-&gt;email,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;&quot;reserved&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">390</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;$user-&gt;get_uvs_id();</span></code></td></tr><tr><td class="coverageDetails"><span>391</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>392</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>393</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">394</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!Org::find_admin($org_id,&nbsp;$uvs_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">395</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Org::add_admin($org_id,&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span>396</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">397</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">398</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;status&nbsp;=&nbsp;&quot;ok&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">399</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>400</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>401</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>402</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//get&nbsp;all&nbsp;admins</span></code></td></tr><tr><td class="coverageDetails"><span>403</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;admins($args)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">404</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($this-&gt;request-&gt;get_method()&nbsp;!=&nbsp;'GET')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">405</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Must&nbsp;use&nbsp;GET');</span></code></td></tr><tr><td class="coverageDetails"><span>406</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">407</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">408</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">409</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span>410</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//check&nbsp;if&nbsp;user&nbsp;is&nbsp;the&nbsp;admin&nbsp;of&nbsp;this&nbsp;org</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">411</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;is_admin($org_id,&nbsp;$uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span>412</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">413</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$admins&nbsp;=&nbsp;Org::find_admin_portal($org_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">414</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$admins)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">415</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>416</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">417</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($admins&nbsp;as&nbsp;$admin)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">418</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($admin-&gt;name&nbsp;==&nbsp;null)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">419</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;User::find_by_uvs_id($admin-&gt;uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">420</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$user)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">421</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></code></td></tr><tr><td class="coverageDetails"><span>422</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">423</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$basic_info&nbsp;=&nbsp;$user-&gt;get_basic_info();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">424</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($basic_info))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">425</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($basic_info-&gt;first_name))&nbsp;$admin-&gt;name&nbsp;=&nbsp;$basic_info-&gt;first_name;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">426</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($basic_info-&gt;last_name))&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">427</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$admin-&gt;name&nbsp;=&nbsp;(isset($admin-&gt;name)?&nbsp;$admin-&gt;name&nbsp;.&nbsp;&quot;&nbsp;&quot;:&quot;&quot;)&nbsp;.&nbsp;$basic_info-&gt;last_name;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">428</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($basic_info-&gt;email)&nbsp;&amp;&amp;&nbsp;!isset($admin-&gt;name))</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">429</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$admin-&gt;name&nbsp;=&nbsp;$basic_info-&gt;email;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">430</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($basic_info-&gt;phone)&nbsp;&amp;&amp;&nbsp;!isset($admin-&gt;name))</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">431</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$admin-&gt;name&nbsp;=&nbsp;$basic_info-&gt;phone;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">432</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($admin-&gt;name))</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">433</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$admin-&gt;name&nbsp;=&nbsp;$admin-&gt;uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">434</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$admin-&gt;photo&nbsp;=&nbsp;$basic_info-&gt;profile_photo_url;</span></code></td></tr><tr><td class="coverageDetails"><span>435</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>436</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">437</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response[]&nbsp;=&nbsp;$admin;</span></code></td></tr><tr><td class="coverageDetails"><span>438</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">439</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>440</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>441</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>442</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//get&nbsp;badges&nbsp;of&nbsp;an&nbsp;orgnization</span></code></td></tr><tr><td class="coverageDetails"><span>443</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;badges($args)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">444</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($this-&gt;request-&gt;get_method()&nbsp;!=&nbsp;'GET')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">445</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Must&nbsp;use&nbsp;GET');</span></code></td></tr><tr><td class="coverageDetails"><span>446</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">447</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">448</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$group_name&nbsp;&nbsp;=&nbsp;$_GET[&quot;group_name&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">449</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">450</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span>451</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>452</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//check&nbsp;if&nbsp;user&nbsp;is&nbsp;the&nbsp;admin&nbsp;of&nbsp;this&nbsp;org</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">453</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;is_admin($org_id,&nbsp;$uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span>454</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>455</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//search&nbsp;in&nbsp;the&nbsp;table:&nbsp;badge</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">456</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$badges&nbsp;=&nbsp;&nbsp;Badge::find_by_org($org_id,&nbsp;$group_name);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">457</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$badges)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">458</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>459</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">460</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($badges&nbsp;as&nbsp;$badge)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">461</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response[]&nbsp;=&nbsp;$badge-&gt;get_detail();</span></code></td></tr><tr><td class="coverageDetails"><span>462</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">463</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>464</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>465</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>466</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;id_generator()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">467</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">468</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$id&nbsp;=&nbsp;(int)Util::gen_random('n',&nbsp;ORG_ID_LENGTH);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">469</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}while(&nbsp;Org::find($id)&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span>470</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">471</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$id;</span></code></td></tr><tr><td class="coverageDetails"><span>472</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>473</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>474</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;is_admin($org_id,&nbsp;$uvs_access_token)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">475</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Org::find($org_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">476</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$org)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">477</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerOrgNotFoundException('Organization&nbsp;does&nbsp;not&nbsp;exist');</span></code></td></tr><tr><td class="coverageDetails"><span>478</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">479</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;User::find_by_uvs_token($uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">480</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$user)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">481</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidTokenException('Invalid&nbsp;uvs&nbsp;access&nbsp;token');</span></code></td></tr><tr><td class="coverageDetails"><span>482</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">483</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!Org::find_admin($org_id,&nbsp;$user-&gt;get_uvs_id()))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">484</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerAdminPermissionDeniedException('You&nbsp;are&nbsp;not&nbsp;the&nbsp;administrator&nbsp;of&nbsp;this&nbsp;organization');</span></code></td></tr><tr><td class="coverageDetails"><span>485</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>486</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>487</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>488</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;qr($args){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">489</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">490</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$input&nbsp;=&nbsp;json_decode(&nbsp;$this-&gt;request-&gt;get_input()&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span>491</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>492</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//verify&nbsp;user</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">493</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;User::find_by_uvs_token($uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">494</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$user)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">495</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidTokenException('Invalid&nbsp;uvs&nbsp;access&nbsp;token');</span></code></td></tr><tr><td class="coverageDetails"><span>496</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>497</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">498</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!&nbsp;$input)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">499</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidTagParamsException('Invalid&nbsp;Tag&nbsp;params');&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>500</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>501</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>502</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>503</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">504</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$org_ids&nbsp;=&nbsp;$input-&gt;orgid;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">505</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(is_array($org_ids)&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">506</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(&nbsp;$org_ids&nbsp;as&nbsp;&amp;$org_id&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">507</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;=&nbsp;(int)$org_id;</span></code></td></tr><tr><td class="coverageDetails"><span>508</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">509</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org_ids_str&nbsp;=&nbsp;implode(&quot;,&quot;,$org_ids);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">510</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;(is_int($org_ids)){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">511</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org_ids_str&nbsp;=&nbsp;(int)$org_ids;</span></code></td></tr><tr><td class="coverageDetails"><span>512</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">513</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidTagParamsException('missing&nbsp;organization&nbsp;id');</span></code></td></tr><tr><td class="coverageDetails"><span>514</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>515</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">516</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$ttl&nbsp;=&nbsp;(&nbsp;(int)$input-&gt;ttl&nbsp;)&nbsp;?&nbsp;(int)$input-&gt;ttl&nbsp;:&nbsp;86400;&nbsp;//(1&nbsp;day)</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">517</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$expiration_time&nbsp;=&nbsp;time()&nbsp;+&nbsp;$ttl;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">518</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$session_data&nbsp;=&nbsp;json_encode(&nbsp;$input-&gt;session_info&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">519</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$input-&gt;session_info&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">520</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$resource_name&nbsp;=&nbsp;substr($input-&gt;resource_name,0,100);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">521</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$resource_type&nbsp;=&nbsp;$input-&gt;resource_type;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">522</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$resource_type&nbsp;==&nbsp;&quot;physical&quot;&nbsp;||&nbsp;$resource_type&nbsp;==&nbsp;&quot;logical&quot;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">523</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tag_type&nbsp;=&nbsp;$resource_type;</span></code></td></tr><tr><td class="coverageDetails"><span>524</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">525</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tag_type&nbsp;=&nbsp;&quot;unknown&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>526</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>527</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">528</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$multi_use&nbsp;=&nbsp;(&nbsp;$input-&gt;multi_use&nbsp;)&nbsp;?&nbsp;true&nbsp;:&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">529</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$confirm&nbsp;=&nbsp;(&nbsp;$input-&gt;confirm&nbsp;)&nbsp;?&nbsp;true&nbsp;:&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>530</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">531</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$tag_params&nbsp;=&nbsp;Array(&quot;org_id&quot;=&gt;$org_ids_str,&nbsp;&quot;tag_type&quot;=&gt;$tag_type,&nbsp;&quot;resource_name&quot;=&gt;$resource_name,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+532</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;session_data&quot;=&gt;$session_data,&quot;expiration_time&quot;=&gt;$expiration_time,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+533</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;multi_use&quot;=&gt;$multi_use,&nbsp;&quot;confirm&quot;=&gt;$confirm);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">534</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$tag&nbsp;=&nbsp;Tag::create($tag_params);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">535</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($tag)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">536</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$qr_str&nbsp;=&nbsp;$tag-&gt;get_qr_str();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>537</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>538</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">539</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$_GET[&quot;return_string&quot;]&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">540</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Array(&quot;qr_string&quot;=&gt;$qr_str);</span></code></td></tr><tr><td class="coverageDetails"><span>541</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">542</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$mydir&nbsp;=&nbsp;dirname(__FILE__);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">543</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$qr_dir&nbsp;=&nbsp;realpath($mydir&nbsp;.&nbsp;'/../lib/usher_vendor/phpqrcode');</span></code></td></tr><tr><td class="coverageDetails"><span>544</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;&quot;$qr_dir/phpqrcode.php&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">545</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$qr_type&nbsp;=&nbsp;&quot;T&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">546</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;QRcode::png($qr_str,false,&nbsp;QR_ECLEVEL_L,&nbsp;&nbsp;4,&nbsp;&nbsp;1,&nbsp;false);</span></code></td></tr><tr><td class="coverageDetails"><span>547</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">548</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;exit();</span></code></td></tr><tr><td class="coverageDetails"><span>549</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>550</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>551</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>552</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;qr_pdf($args){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">553</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">554</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$input&nbsp;=&nbsp;json_decode(&nbsp;$this-&gt;request-&gt;get_input()&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span>555</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>556</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//verify&nbsp;user</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">557</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;User::find_by_uvs_token($uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">558</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$user)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">559</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidTokenException('Invalid&nbsp;uvs&nbsp;access&nbsp;token');</span></code></td></tr><tr><td class="coverageDetails"><span>560</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>561</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">562</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$orgid&nbsp;=&nbsp;(int)$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">563</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$sessionid&nbsp;=&nbsp;$args[1];</span></code></td></tr><tr><td class="coverageDetails"><span>564</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">565</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!&nbsp;$input)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">566</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidTagParamsException('Invalid&nbsp;Tag&nbsp;params');&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>567</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>568</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">569</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;=&nbsp;(int)$input-&gt;orgid;</span></code></td></tr><tr><td class="coverageDetails"><span>570</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">571</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$ttl&nbsp;=&nbsp;(&nbsp;(int)$input-&gt;ttl&nbsp;)&nbsp;?&nbsp;(int)$input-&gt;ttl&nbsp;:&nbsp;86400;&nbsp;//(1&nbsp;day)</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">572</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$expiration_time&nbsp;=&nbsp;time()&nbsp;+&nbsp;$ttl;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">573</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$session_data&nbsp;=&nbsp;json_encode(&nbsp;$input-&gt;session_info&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">574</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$input-&gt;session_info&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">575</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$resource_name&nbsp;=&nbsp;$input-&gt;resource_name;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">576</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$resource_type&nbsp;=&nbsp;$input-&gt;resource_type;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">577</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$resource_type&nbsp;==&nbsp;&quot;physical&quot;&nbsp;||&nbsp;$resource_type&nbsp;==&nbsp;&quot;logical&quot;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">578</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tag_type&nbsp;=&nbsp;$resource_type;</span></code></td></tr><tr><td class="coverageDetails"><span>579</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">580</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tag_type&nbsp;=&nbsp;&quot;unknown&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>581</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>582</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">583</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$multi_use&nbsp;=&nbsp;(&nbsp;$input-&gt;multi_use&nbsp;)&nbsp;?&nbsp;true&nbsp;:&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">584</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$confirm&nbsp;=&nbsp;(&nbsp;$input-&gt;confirm&nbsp;)&nbsp;?&nbsp;true&nbsp;:&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>585</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">586</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$tag_params&nbsp;=&nbsp;Array(&quot;org_id&quot;=&gt;$org_id,&nbsp;&quot;tag_type&quot;=&gt;$tag_type,&nbsp;&quot;resource_name&quot;=&gt;$resource_name,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+587</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;session_data&quot;=&gt;$session_data,&quot;expiration_time&quot;=&gt;$expiration_time,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+588</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;multi_use&quot;=&gt;$multi_use,&nbsp;&quot;confirm&quot;=&gt;$confirm);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">589</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$tag&nbsp;=&nbsp;Tag::create($tag_params);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">590</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($tag)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">591</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$qr_str&nbsp;=&nbsp;$tag-&gt;get_qr_str();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>592</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>593</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">594</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$url&nbsp;=&nbsp;Util::get_general_config(&quot;sign_qr_url&quot;)&nbsp;.&nbsp;'pdf/qrcode';&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">595</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$ch&nbsp;=&nbsp;curl_init($url);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">596</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch,&nbsp;CURLOPT_URL,&nbsp;$url);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">597</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch,&nbsp;CURLOPT_RETURNTRANSFER,&nbsp;TRUE);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">598</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch,&nbsp;CURLOPT_HTTPHEADER,&nbsp;array(&quot;Content-type:&nbsp;multipart/form-data&quot;));</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">599</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch,&nbsp;CURLOPT_BINARYTRANSFER,&nbsp;true);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">600</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch,&nbsp;CURLOPT_DNS_USE_GLOBAL_CACHE,&nbsp;false);&nbsp;//&nbsp;Not&nbsp;true&nbsp;is&nbsp;not&nbsp;thread-safe.</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">601</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch,&nbsp;CURLOPT_HEADER,&nbsp;false);</span></code></td></tr><tr><td class="coverageDetails"><span>602</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">603</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$input-&gt;pdf_info-&gt;extra[1]-&gt;text&nbsp;=&nbsp;$resource_name;</span></code></td></tr><tr><td class="coverageDetails"><span>604</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">605</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$postfields&nbsp;=&nbsp;array(&quot;doc&quot;&nbsp;=&gt;&nbsp;$input-&gt;pdf_info-&gt;doc,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+606</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;source_type&quot;&nbsp;=&gt;&nbsp;$input-&gt;pdf_info-&gt;source_type,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+607</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;page_size_x&quot;&nbsp;=&gt;&nbsp;$input-&gt;pdf_info-&gt;page_size_x,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+608</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;page_size_y&quot;&nbsp;=&gt;&nbsp;$input-&gt;pdf_info-&gt;page_size_y,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+609</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;qrcode&quot;&nbsp;=&gt;&nbsp;$qr_str,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+610</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;extra&quot;&nbsp;=&gt;&nbsp;json_encode($input-&gt;pdf_info-&gt;extra));</span></code></td></tr><tr><td class="coverageDetails"><span>611</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">612</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch,&nbsp;CURLOPT_POSTFIELDS,&nbsp;$postfields);</span></code></td></tr><tr><td class="coverageDetails"><span>613</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">614</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$res&nbsp;=&nbsp;json_decode(curl_exec($ch));</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">615</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_close($ch);</span></code></td></tr><tr><td class="coverageDetails"><span>616</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">617</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$pdf_signed_url&nbsp;=&nbsp;&quot;pdf/get_qrcode_file/&quot;&nbsp;.&nbsp;basename($res-&gt;payload[0]-&gt;pdf_qrcode_url);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">618</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$url1&nbsp;=&nbsp;Util::get_general_config(&quot;sign_qr_url&quot;)&nbsp;.&nbsp;$pdf_signed_url;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">619</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$ch1&nbsp;=&nbsp;curl_init($url1);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">620</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch1,&nbsp;CURLOPT_URL,&nbsp;$url1);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">621</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch1,&nbsp;CURLOPT_RETURNTRANSFER,&nbsp;TRUE);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">622</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch1,&nbsp;CURLOPT_HEADER,&nbsp;false);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">623</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$content&nbsp;=&nbsp;curl_exec($ch1);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">624</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_close($ch1);</span></code></td></tr><tr><td class="coverageDetails"><span>625</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">626</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;var_dump($content);</span></code></td></tr><tr><td class="coverageDetails"><span>627</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">628</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;exit();</span></code></td></tr><tr><td class="coverageDetails"><span>629</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>630</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>631</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;batch_add_admins($args)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">632</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($this-&gt;request-&gt;get_method()&nbsp;!=&nbsp;'POST')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">633</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Must&nbsp;use&nbsp;POST');</span></code></td></tr><tr><td class="coverageDetails"><span>634</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>635</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">636</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$input&nbsp;=&nbsp;json_decode(&nbsp;$this-&gt;request-&gt;get_input()&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">637</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">638</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">639</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_ids&nbsp;=&nbsp;$input-&gt;uvs_ids;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">640</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_ids&nbsp;=&nbsp;array_unique($uvs_ids);</span></code></td></tr><tr><td class="coverageDetails"><span>641</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">642</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$valid_uvs_ids&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">643</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($uvs_ids&nbsp;as&nbsp;$uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">644</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(User::find_by_uvs_id($uvs_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">645</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$valid_uvs_ids[]&nbsp;=&nbsp;$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span>646</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>647</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>648</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">649</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;Org::add_multiple_admins($org_id,&nbsp;$valid_uvs_ids);</span></code></td></tr><tr><td class="coverageDetails"><span>650</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">651</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">652</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(NULL&nbsp;!=&nbsp;$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">653</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;success_ids&nbsp;=&nbsp;array_diff($valid_uvs_ids,&nbsp;$result);</span></code></td></tr><tr><td class="coverageDetails"><span>654</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>655</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">656</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;success_ids&nbsp;=&nbsp;$valid_uvs_ids;</span></code></td></tr><tr><td class="coverageDetails"><span>657</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>658</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">659</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(count($response-&gt;success_ids)&nbsp;==&nbsp;0)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">660</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;success_ids&nbsp;=&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>661</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>662</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">663</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(NULL&nbsp;==&nbsp;$result)&nbsp;{&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">664</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;failed_ids&nbsp;=&nbsp;array_diff($uvs_ids,&nbsp;$valid_uvs_ids);</span></code></td></tr><tr><td class="coverageDetails"><span>665</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>666</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">667</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;failed_ids&nbsp;=&nbsp;array_merge($result,&nbsp;array_diff($uvs_ids,&nbsp;$valid_uvs_ids));</span></code></td></tr><tr><td class="coverageDetails"><span>668</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>669</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">670</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(count($response-&gt;failed_ids)&nbsp;==&nbsp;0)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">671</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;failed_ids&nbsp;=&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>672</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>673</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">674</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>675</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>676</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>677</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;remove_admin($args)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">678</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($this-&gt;request-&gt;get_method()&nbsp;!=&nbsp;'POST')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">679</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Must&nbsp;use&nbsp;POST');</span></code></td></tr><tr><td class="coverageDetails"><span>680</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>681</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">682</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$input&nbsp;=&nbsp;json_decode(&nbsp;$this-&gt;request-&gt;get_input()&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">683</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">684</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">685</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_ids&nbsp;=&nbsp;$input-&gt;uvs_ids;</span></code></td></tr><tr><td class="coverageDetails"><span>686</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">687</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;Org::remove_multiple_admins($org_id,&nbsp;$uvs_ids);</span></code></td></tr><tr><td class="coverageDetails"><span>688</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">689</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">690</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(NULL&nbsp;!=&nbsp;$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">691</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;success_ids&nbsp;=&nbsp;array_diff($uvs_ids,&nbsp;$result);</span></code></td></tr><tr><td class="coverageDetails"><span>692</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>693</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">694</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;success_ids&nbsp;=&nbsp;$uvs_ids;</span></code></td></tr><tr><td class="coverageDetails"><span>695</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>696</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">697</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;failed_ids&nbsp;=&nbsp;$result;</span></code></td></tr><tr><td class="coverageDetails"><span>698</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">699</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>700</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>701</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>702</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;statistics($args){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">703</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">704</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">705</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$time_from&nbsp;=&nbsp;$_GET[&quot;time_from&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">706</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$time_to&nbsp;=&nbsp;$_GET[&quot;time_to&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">707</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($time_from)&nbsp;or&nbsp;!isset($time_to)&nbsp;or&nbsp;!isset($org_id)&nbsp;or&nbsp;!isset($uvs_access_token)){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">708</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Parameter&nbsp;format&nbsp;is&nbsp;wrong');</span></code></td></tr><tr><td class="coverageDetails"><span>709</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>710</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">711</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$org&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Org::find($org_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">712</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$org)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">713</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerOrgNotFoundException('Organization&nbsp;does&nbsp;not&nbsp;exist');</span></code></td></tr><tr><td class="coverageDetails"><span>714</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>715</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//check&nbsp;if&nbsp;user&nbsp;is&nbsp;the&nbsp;admin&nbsp;of&nbsp;this&nbsp;org</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">716</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;is_admin($org_id,&nbsp;$uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span>717</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//statistics</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">718</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$userlogs&nbsp;=&nbsp;UserLog::get($org_id,&nbsp;$time_from,&nbsp;$time_to);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">719</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">720</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;userlogs&nbsp;=&nbsp;$userlogs;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">721</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>722</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>723</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>724</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;send_email($args)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">725</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;$_GET[&quot;uvs_access_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">726</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;User::find_by_uvs_token($uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">727</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$user)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">728</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidTokenException('Invalid&nbsp;uvs&nbsp;access&nbsp;token');</span></code></td></tr><tr><td class="coverageDetails"><span>729</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>730</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">731</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$org_id&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">732</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($org_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">733</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerBadRequestException('Missing&nbsp;org_id');</span></code></td></tr><tr><td class="coverageDetails"><span>734</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>735</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">736</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$org&nbsp;=&nbsp;Org::find($org_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">737</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$settings&nbsp;=&nbsp;$org-&gt;get_settings();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">738</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$email&nbsp;=&nbsp;$settings-&gt;contact_info-&gt;email;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">739</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">740</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;is_confirmed&nbsp;=&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">741</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($email))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">742</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Org::is_email_confirmed($org_id,&nbsp;$email))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">743</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;is_confirmed&nbsp;=&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">744</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;is_send&nbsp;=&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>745</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">746</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$email_id&nbsp;=&nbsp;Org::add_account_email($org_id,&nbsp;$email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">747</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;is_send&nbsp;=&nbsp;Org::send_email_code($email_id,&nbsp;$email);</span></code></td></tr><tr><td class="coverageDetails"><span>748</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>749</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">750</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response-&gt;is_send&nbsp;=&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>751</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">752</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>753</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>754</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>755</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>}</span></code></td></tr><tr><td class="coverageDetails"><span>756</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>757</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>?&gt;</span></code></td></tr></table></td></tr>
  </table>

    </div>
  </body>
</html>
