<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Spike PHPCoverage Details: uvsdatabase.php</title> 
    <link href="../../../../..//css/spikesource.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="pageBox" >

      <table border="0" cellpadding="2" cellspacing="0" id="contentBox" width="100%">
        <tr>
          <td align="left" valign="top"><h1>Spike PHPCoverage Details: uvsdatabase.php</h1>
          </td>
        </tr>
        <tr>
          <td>

<table width="100%" border="0" cellpadding="2" cellspacing="0"><td width="10%"class="coverageDetailsHead" >Line #</td><td width="10%" class="coverageDetailsHead">Frequency</td><td  width="80%" class="coverageDetailsHead">Source Line</td><tr><td class="coverageDetails"><span>1</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&lt;?php</span></code></td></tr><tr><td class="coverageDetails"><span>2</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>3</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>require_once(dirname(__FILE__)&nbsp;.&nbsp;&quot;/pdo.php&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">define(&quot;VALIDATIONSERVER_CONFIG_LOCATION&quot;,&nbsp;&quot;/MSTR/db_configs/usher/uvs_validationserver_database.json&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>5</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//define(&quot;VALIDATIONSERVER_CONFIG_LOCATION&quot;,&nbsp;&quot;/MSTR/db_configs/usher/uvs_relianceserver_database.json&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>6</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;See&nbsp;sample_database.json&nbsp;in&nbsp;this&nbsp;directory&nbsp;for&nbsp;an&nbsp;example&nbsp;of&nbsp;a&nbsp;database&nbsp;configuration&nbsp;file.</span></code></td></tr><tr><td class="coverageDetails"><span>7</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>8</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>class&nbsp;UVSDatabaseException&nbsp;extends&nbsp;Exception&nbsp;{}</span></code></td></tr><tr><td class="coverageDetails"><span>9</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>10</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>class&nbsp;UVSDatabase&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>11</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//&nbsp;$connection&nbsp;is&nbsp;a&nbsp;MySQLConnection,&nbsp;$dbh&nbsp;is&nbsp;a&nbsp;PDO&nbsp;connection.</span></code></td></tr><tr><td class="coverageDetails"><span>12</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//&nbsp;$dbh&nbsp;should&nbsp;be&nbsp;used&nbsp;for&nbsp;everything,&nbsp;and&nbsp;$connection&nbsp;is&nbsp;only&nbsp;here&nbsp;for</span></code></td></tr><tr><td class="coverageDetails"><span>13</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//&nbsp;the&nbsp;transition.</span></code></td></tr><tr><td class="coverageDetails"><span>14</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;$connection;</span></code></td></tr><tr><td class="coverageDetails"><span>15</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>16</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;create_connection()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">17</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if(isset(self::$connection)){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">18</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self::$connection;</span></code></td></tr><tr><td class="coverageDetails"><span>19</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">20</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$configuration&nbsp;=&nbsp;self::get_configuration(VALIDATIONSERVER_CONFIG_LOCATION);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">21</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$host&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$configuration-&gt;host;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">22</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$port&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$configuration-&gt;port;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">23</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$database&nbsp;=&nbsp;$configuration-&gt;database;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">24</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$configuration-&gt;user;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">25</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$password&nbsp;=&nbsp;trim(file_get_contents($configuration-&gt;password_file));</span></code></td></tr><tr><td class="coverageDetails"><span>26</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">27</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$connection&nbsp;=&nbsp;new&nbsp;PDOConnection($host,&nbsp;$port,&nbsp;$database,&nbsp;$user,&nbsp;$password);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">28</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;self::$connection&nbsp;=&nbsp;$connection;</span></code></td></tr><tr><td class="coverageDetails"><span>29</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>30</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//if(!isset(self::$dbh))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>31</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**</span></code></td></tr><tr><td class="coverageDetails"><span>32</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Create&nbsp;a&nbsp;PDO&nbsp;connection&nbsp;for&nbsp;all&nbsp;new&nbsp;code.&nbsp;&nbsp;To&nbsp;use&nbsp;the&nbsp;connection:</span></code></td></tr><tr><td class="coverageDetails"><span>33</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span></code></td></tr><tr><td class="coverageDetails"><span>34</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>35</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;//&nbsp;The&nbsp;:baz&nbsp;in&nbsp;the&nbsp;query&nbsp;will&nbsp;get&nbsp;correctly&nbsp;escaped&nbsp;in&nbsp;execute().</span></code></td></tr><tr><td class="coverageDetails"><span>36</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;'SELECT&nbsp;foo,&nbsp;quux&nbsp;FROM&nbsp;bar&nbsp;WHERE&nbsp;baz&nbsp;=&nbsp;:baz';</span></code></td></tr><tr><td class="coverageDetails"><span>37</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;$sth&nbsp;=&nbsp;UVSDatabase::$dbh-&gt;prepare($query);</span></code></td></tr><tr><td class="coverageDetails"><span>38</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;$sth-&gt;execute(array(':baz'&nbsp;=&gt;&nbsp;'some&nbsp;baz&nbsp;value'));</span></code></td></tr><tr><td class="coverageDetails"><span>39</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;while($row&nbsp;=&nbsp;$sth-&gt;fetch(PDO::FETCH_OBJ))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>40</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$foo&nbsp;=&nbsp;$row-&gt;foo;</span></code></td></tr><tr><td class="coverageDetails"><span>41</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;quux&nbsp;is&nbsp;supposed&nbsp;to&nbsp;be&nbsp;an&nbsp;integer,&nbsp;but&nbsp;could&nbsp;be&nbsp;NULL.</span></code></td></tr><tr><td class="coverageDetails"><span>42</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;PDO&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;string,&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;cast&nbsp;it.</span></code></td></tr><tr><td class="coverageDetails"><span>43</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$quux&nbsp;=&nbsp;is_null($row-&gt;quux)&nbsp;?&nbsp;NULL&nbsp;:&nbsp;(int)$row-&gt;quux;</span></code></td></tr><tr><td class="coverageDetails"><span>44</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Do&nbsp;something&nbsp;useful&nbsp;with&nbsp;$foo&nbsp;and&nbsp;$quux.</span></code></td></tr><tr><td class="coverageDetails"><span>45</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>46</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;$sth-&gt;closeCursor();</span></code></td></tr><tr><td class="coverageDetails"><span>47</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></code></td></tr><tr><td class="coverageDetails"><span>48</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$dsn&nbsp;=&nbsp;&quot;mysql:host=$host;port=$port;dbname=$database;charset=utf8&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>49</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//self::$dbh&nbsp;=&nbsp;new&nbsp;PDO($dsn,&nbsp;$user,&nbsp;$password);</span></code></td></tr><tr><td class="coverageDetails"><span>50</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//self::$dbh-&gt;setAttribute(PDO::ATTR_ERRMODE,&nbsp;PDO::ERRMODE_EXCEPTION);</span></code></td></tr><tr><td class="coverageDetails"><span>51</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//}</span></code></td></tr><tr><td class="coverageDetails"><span>52</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">53</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$connection;</span></code></td></tr><tr><td class="coverageDetails"><span>54</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>55</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>56</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_configuration($filepath)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">57</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$rawconfig&nbsp;=&nbsp;file_get_contents($filepath);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">58</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if(!$rawconfig)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">59</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;UVSDatabaseException(&quot;Unable&nbsp;to&nbsp;read&nbsp;DB&nbsp;configuration&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>60</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">61</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$config&nbsp;=&nbsp;json_decode($rawconfig);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">62</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if(!$config)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">63</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;UVSDatabaseException(&quot;Unable&nbsp;to&nbsp;parse&nbsp;DB&nbsp;configuration&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>64</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">65</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$config;</span></code></td></tr><tr><td class="coverageDetails"><span>66</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>67</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>68</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>}</span></code></td></tr><tr><td class="coverageDetails"><span>69</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>?&gt;</span></code></td></tr></table></td></tr>
  </table>

    </div>
  </body>
</html>
