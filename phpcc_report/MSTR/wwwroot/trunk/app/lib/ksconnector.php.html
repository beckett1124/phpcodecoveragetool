<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Spike PHPCoverage Details: ksconnector.php</title> 
    <link href="../../../../..//css/spikesource.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="pageBox" >

      <table border="0" cellpadding="2" cellspacing="0" id="contentBox" width="100%">
        <tr>
          <td align="left" valign="top"><h1>Spike PHPCoverage Details: ksconnector.php</h1>
          </td>
        </tr>
        <tr>
          <td>

<table width="100%" border="0" cellpadding="2" cellspacing="0"><td width="10%"class="coverageDetailsHead" >Line #</td><td width="10%" class="coverageDetailsHead">Frequency</td><td  width="80%" class="coverageDetailsHead">Source Line</td><tr><td class="coverageDetails"><span>1</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&lt;?php&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>2</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">define(&quot;KEYSERVER_CONFIG_LOCATION&quot;,&nbsp;&quot;/MSTR/db_configs/usher/uvs_keyserver_api.json&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>4</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>5</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>class&nbsp;KSConnectorCreateRequestException&nbsp;extends&nbsp;FWException&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>6</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;function&nbsp;http_code()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">7</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;400;</span></code></td></tr><tr><td class="coverageDetails"><span>8</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>9</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>}</span></code></td></tr><tr><td class="coverageDetails"><span>10</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>11</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>class&nbsp;KSConnectorFindRequestException&nbsp;extends&nbsp;FWException&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>12</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;function&nbsp;http_code()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">13</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;404;</span></code></td></tr><tr><td class="coverageDetails"><span>14</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>15</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>}</span></code></td></tr><tr><td class="coverageDetails"><span>16</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>17</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>class&nbsp;KSConnectorCreateCertificateException&nbsp;extends&nbsp;FWException&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>18</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;function&nbsp;http_code()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">19</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;655;</span></code></td></tr><tr><td class="coverageDetails"><span>20</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>21</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>}</span></code></td></tr><tr><td class="coverageDetails"><span>22</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>23</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>class&nbsp;KSConnector&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>24</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>25</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;init_request($url,&nbsp;$timeout&nbsp;=&nbsp;30,&nbsp;$connect_timeout&nbsp;=&nbsp;10)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">26</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$handle&nbsp;=&nbsp;curl_init($url);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">27</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($handle,&nbsp;CURLOPT_RETURNTRANSFER,&nbsp;true);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">28</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($handle,&nbsp;CURLOPT_BINARYTRANSFER,&nbsp;true);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">29</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($handle,&nbsp;CURLOPT_DNS_USE_GLOBAL_CACHE,&nbsp;false);&nbsp;//&nbsp;Not&nbsp;true&nbsp;is&nbsp;not&nbsp;thread-safe.</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">30</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($handle,&nbsp;CURLOPT_TIMEOUT,&nbsp;$timeout);&nbsp;//&nbsp;Total&nbsp;time&nbsp;the&nbsp;function&nbsp;is&nbsp;allowed&nbsp;to&nbsp;execute.</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">31</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($handle,&nbsp;CURLOPT_CONNECTTIMEOUT,&nbsp;$connect_timeout);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">32</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$handle;</span></code></td></tr><tr><td class="coverageDetails"><span>33</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>34</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>35</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;create_key($create_key_input)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">36</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$configuration&nbsp;=&nbsp;self::get_configuration(KEYSERVER_CONFIG_LOCATION);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">37</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$ks_url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$configuration-&gt;url;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">38</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$url&nbsp;=&nbsp;$ks_url.'/keypair/create';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">39</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$handle&nbsp;=&nbsp;self::init_request($url);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">40</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt&nbsp;($handle,&nbsp;CURLOPT_POST,&nbsp;1);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">41</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt&nbsp;($handle,&nbsp;CURLOPT_POSTFIELDS,&nbsp;json_encode($create_key_input));</span></code></td></tr><tr><td class="coverageDetails"><span>42</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">43</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;&nbsp;json_decode(&nbsp;curl_exec($handle)&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">44</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;curl_close($handle);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">45</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if($response&nbsp;==&nbsp;false)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">46</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;KSConnectorCreateRequestException(&quot;create&nbsp;key&nbsp;failed&nbsp;--&nbsp;no&nbsp;response&nbsp;from&nbsp;&nbsp;key&nbsp;server&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>47</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">48</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>49</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>50</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>51</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;sign_doc($fingerprint,&nbsp;$sign_doc_input)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">52</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$configuration&nbsp;=&nbsp;self::get_configuration(KEYSERVER_CONFIG_LOCATION);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">53</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$ks_url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$configuration-&gt;url;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">54</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$url&nbsp;=&nbsp;$ks_url.'/keypair/sign/'.$fingerprint;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">55</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$handle&nbsp;=&nbsp;self::init_request($url);&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">56</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt&nbsp;($handle,&nbsp;CURLOPT_POST,&nbsp;1);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">57</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt&nbsp;($handle,&nbsp;CURLOPT_POSTFIELDS,&nbsp;json_encode($sign_doc_input));</span></code></td></tr><tr><td class="coverageDetails"><span>58</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">59</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;&nbsp;json_decode(&nbsp;curl_exec($handle)&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">60</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_close($handle);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">61</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($response&nbsp;==&nbsp;false)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">62</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;KSConnectorCreateRequestException(&quot;sign&nbsp;document&nbsp;failed&nbsp;--&nbsp;no&nbsp;response&nbsp;from&nbsp;&nbsp;key&nbsp;server&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>63</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">64</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$signature&nbsp;&nbsp;&nbsp;=&nbsp;$response-&gt;signature;</span></code></td></tr><tr><td class="coverageDetails"><span>65</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$signature&nbsp;&nbsp;&nbsp;=&nbsp;strtr($response-&gt;signature,&nbsp;'_-',&nbsp;'/+');</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">66</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$signature;</span></code></td></tr><tr><td class="coverageDetails"><span>67</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>68</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>69</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;request_key($fingerprint)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">70</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$configuration&nbsp;=&nbsp;self::get_configuration(KEYSERVER_CONFIG_LOCATION);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">71</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$ks_url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$configuration-&gt;url;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">72</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$url&nbsp;=&nbsp;$ks_url.'/keypair/public_key/'.$fingerprint;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">73</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$handle&nbsp;=&nbsp;self::init_request($url);</span></code></td></tr><tr><td class="coverageDetails"><span>74</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">75</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;&nbsp;json_decode(&nbsp;curl_exec($handle)&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">76</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;curl_close($handle);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">77</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($response&nbsp;==&nbsp;false)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">78</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;KSConnectorFindRequestException(&quot;request&nbsp;key&nbsp;failed&nbsp;--&nbsp;no&nbsp;response&nbsp;from&nbsp;&nbsp;key&nbsp;server&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>79</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">80</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>81</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>82</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>83</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_configuration($filepath)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">84</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rawconfig&nbsp;=&nbsp;file_get_contents($filepath);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">85</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$rawconfig)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">86</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;KSConnectorCreateRequestException(&quot;Unable&nbsp;to&nbsp;read&nbsp;KS&nbsp;configuration&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>87</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">88</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$config&nbsp;=&nbsp;json_decode($rawconfig);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">89</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$config)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">90</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;KSConnectorCreateRequestException(&quot;Unable&nbsp;to&nbsp;parse&nbsp;KS&nbsp;configuration&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>91</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">92</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$config;</span></code></td></tr><tr><td class="coverageDetails"><span>93</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>94</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>95</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//&nbsp;Connect&nbsp;to&nbsp;the&nbsp;KeyServer&nbsp;and&nbsp;request&nbsp;a&nbsp;certificate&nbsp;for&nbsp;a&nbsp;given&nbsp;user</span></code></td></tr><tr><td class="coverageDetails"><span>96</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_certificate($uvs_id,&nbsp;$email,&nbsp;$device_id,&nbsp;$passphrase,&nbsp;$days=365)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">97</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$configuration&nbsp;=&nbsp;self::get_configuration(KEYSERVER_CONFIG_LOCATION);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">98</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$ks_url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$configuration-&gt;url;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">99</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$url&nbsp;=&nbsp;$ks_url.'/certificate/create';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">100</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$handle&nbsp;=&nbsp;self::init_request($url);&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">101</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!&nbsp;($uvs_id&nbsp;&amp;&amp;&nbsp;$email&nbsp;&amp;&amp;&nbsp;$device_id)&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">102</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;KSConnectorCreateCertificateException(&quot;Missing&nbsp;required&nbsp;params&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>103</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">104</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$params&nbsp;=&nbsp;Array(&quot;uvs_id&quot;=&gt;$uvs_id,&nbsp;&quot;email&quot;=&gt;$email,&nbsp;&quot;device_id&quot;=&gt;$device_id,&nbsp;&quot;days&quot;=&gt;$days,&nbsp;&quot;passphrase&quot;=&gt;$passphrase);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">105</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt&nbsp;($handle,&nbsp;CURLOPT_POST,&nbsp;1);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">106</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt&nbsp;($handle,&nbsp;CURLOPT_POSTFIELDS,&nbsp;json_encode($params));</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">107</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;&nbsp;json_decode(&nbsp;curl_exec($handle)&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">108</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;curl_close($handle);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">109</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if($response&nbsp;==&nbsp;false)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">110</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;KSConnectorCreateCertificateException(&quot;Couldn't&nbsp;generate&nbsp;certificate&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>111</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">112</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>113</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>114</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>}</span></code></td></tr><tr><td class="coverageDetails"><span>115</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>116</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>?&gt;</span></code></td></tr></table></td></tr>
  </table>

    </div>
  </body>
</html>
