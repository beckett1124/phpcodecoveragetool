<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Spike PHPCoverage Details: user.php</title> 
    <link href="../../../../..//css/spikesource.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="pageBox" >

      <table border="0" cellpadding="2" cellspacing="0" id="contentBox" width="100%">
        <tr>
          <td align="left" valign="top"><h1>Spike PHPCoverage Details: user.php</h1>
          </td>
        </tr>
        <tr>
          <td>

<table width="100%" border="0" cellpadding="2" cellspacing="0"><td width="10%"class="coverageDetailsHead" >Line #</td><td width="10%" class="coverageDetailsHead">Frequency</td><td  width="80%" class="coverageDetailsHead">Source Line</td><tr><td class="coverageDetails"><span>1</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&lt;?php&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>2</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">define(&quot;UVS_TOKEN_LENGTH&quot;,&nbsp;20);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">define(&quot;EMAIL_CONFIRMATION_CODE_LENGTH&quot;,&nbsp;10);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">5</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">define(&quot;SMS_CONFIRMATION_CODE_LENGTH&quot;,&nbsp;6);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">6</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">define(&quot;UVS_TOKEN_EXPIRATION&quot;,&nbsp;&quot;INTERVAL&nbsp;1&nbsp;MONTH&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">7</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">define(&quot;PASSWORD_MD5_ENCRYPT_LENGTH&quot;,&nbsp;32);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">8</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">define(&quot;MAX_LOGIN_TRIES&quot;,&nbsp;5);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetails"><span class="codeExecuted">9</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">define(&quot;ACCOUNT_LOCKING_DURATION&quot;,&nbsp;900);&nbsp;//15&nbsp;minutes</span></code></td></tr><tr><td class="coverageDetails"><span>10</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>11</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>class&nbsp;User&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>12</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;protected&nbsp;$uvs_id,&nbsp;$email,&nbsp;$password,&nbsp;$first_name,&nbsp;$last_name,&nbsp;$phone,&nbsp;$fb_id,&nbsp;$account_type,&nbsp;$user_type;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>13</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;protected&nbsp;$email_id,&nbsp;$phone_id;//used&nbsp;for&nbsp;find_by_email_code(),&nbsp;find_by_sms_code()</span></code></td></tr><tr><td class="coverageDetails"><span>14</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;protected&nbsp;$fb_access_token,&nbsp;$fb_token_expires,&nbsp;$uvs_access_token,&nbsp;$uvs_token_expires,&nbsp;$application_id,&nbsp;$profile_photo_url;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>15</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;protected&nbsp;$email_accounts,&nbsp;$phone_numbers;&nbsp;//Only&nbsp;used&nbsp;to&nbsp;retrieve&nbsp;emails&nbsp;&amp;&nbsp;phones&nbsp;of&nbsp;a&nbsp;user&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>16</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;protected&nbsp;$initials_url,&nbsp;$signature_url;//different&nbsp;types&nbsp;of&nbsp;images</span></code></td></tr><tr><td class="coverageDetails"><span>17</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;protected&nbsp;$pwd_exists;//bool,indicate&nbsp;whether&nbsp;the&nbsp;uvs_id&nbsp;has&nbsp;a&nbsp;password</span></code></td></tr><tr><td class="coverageDetails"><span>18</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>19</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$ARRAY_EVENT_TYPE_HIGHLIGHT&nbsp;=&nbsp;array(&quot;doc_shared_code&quot;=&gt;1,&quot;doc_shared_email&quot;=&gt;1,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>20</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;doc_received_code&quot;=&gt;1,&quot;doc_received_email&quot;=&gt;0,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>21</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;device_activation&quot;=&gt;0,&quot;badge_added&quot;=&gt;1,&quot;badge_removed&quot;&nbsp;=&gt;1,</span></code></td></tr><tr><td class="coverageDetails"><span>22</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;physical_access&quot;=&gt;0);</span></code></td></tr><tr><td class="coverageDetails"><span>23</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$ARRAY_EVENT_TYPE_V12&nbsp;=&nbsp;array(&quot;doc_shared_code&quot;,&quot;doc_shared_email&quot;,</span></code></td></tr><tr><td class="coverageDetails"><span>24</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;doc_received_code&quot;,&quot;doc_received_email&quot;,</span></code></td></tr><tr><td class="coverageDetails"><span>25</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;device_activation&quot;,&quot;badge_added&quot;,&quot;badge_removed&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>26</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$EVENT_TYPE_DOC_SHARED_CODE&nbsp;=&nbsp;&quot;doc_shared_code&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>27</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$EVENT_TYPE_DOC_SHARED_EMAIL&nbsp;=&nbsp;&quot;doc_shared_email&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>28</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$EVENT_TYPE_DOC_RECEIVED_CODE&nbsp;=&nbsp;&quot;doc_received_code&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>29</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$EVENT_TYPE_DOC_RECEIVED_EMAIL&nbsp;=&nbsp;&quot;doc_received_email&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>30</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$EVENT_TYPE_DEVICE_ACTIVATION&nbsp;=&nbsp;&quot;device_activation&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>31</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$EVENT_TYPE_BADGE_ADDED&nbsp;=&nbsp;&quot;badge_added&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>32</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$EVENT_TYPE_BADGE_REMOVED&nbsp;=&nbsp;&quot;badge_removed&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>33</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$EVENT_TYPE_PHYSICAL_ACCESS&nbsp;=&nbsp;&quot;physical_access&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>34</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$HIGNLIGHT&nbsp;=&nbsp;0;</span></code></td></tr><tr><td class="coverageDetails"><span>35</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_event_type_doc_shared_code(){</span></code></td></tr><tr><td class="coverageDetails"><span>36</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self::$EVENT_TYPE_DOC_SHARED_CODE;</span></code></td></tr><tr><td class="coverageDetails"><span>37</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>38</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_event_type_doc_shared_email(){</span></code></td></tr><tr><td class="coverageDetails"><span>39</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self::$EVENT_TYPE_DOC_SHARED_EMAIL;</span></code></td></tr><tr><td class="coverageDetails"><span>40</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>41</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_event_type_doc_received_code(){</span></code></td></tr><tr><td class="coverageDetails"><span>42</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self::$EVENT_TYPE_DOC_RECEIVED_CODE&nbsp;;</span></code></td></tr><tr><td class="coverageDetails"><span>43</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>44</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_event_type_doc_received_email(){</span></code></td></tr><tr><td class="coverageDetails"><span>45</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self::$EVENT_TYPE_DOC_RECEIVED_EMAIL&nbsp;;</span></code></td></tr><tr><td class="coverageDetails"><span>46</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>47</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_event_type_device_activation(){</span></code></td></tr><tr><td class="coverageDetails"><span>48</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self::$EVENT_TYPE_DEVICE_ACTIVATION;</span></code></td></tr><tr><td class="coverageDetails"><span>49</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>50</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_event_type_badge_added(){</span></code></td></tr><tr><td class="coverageDetails"><span>51</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self::$EVENT_TYPE_BADGE_ADDED;</span></code></td></tr><tr><td class="coverageDetails"><span>52</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>53</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_event_type_badge_removed(){</span></code></td></tr><tr><td class="coverageDetails"><span>54</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self::$EVENT_TYPE_BADGE_REMOVED;</span></code></td></tr><tr><td class="coverageDetails"><span>55</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>56</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_event_type_physical_access(){</span></code></td></tr><tr><td class="coverageDetails"><span>57</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self::$EVENT_TYPE_PHYSICAL_ACCESS;</span></code></td></tr><tr><td class="coverageDetails"><span>58</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>59</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>60</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;function&nbsp;__construct($email,&nbsp;$password,&nbsp;$first_name,&nbsp;$last_name,&nbsp;$phone,&nbsp;$fb_id,&nbsp;$account_type,&nbsp;$uvs_id)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">61</span></td><td class="coverageDetails"><span class="codeExecuted">7</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;email&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$email;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">62</span></td><td class="coverageDetails"><span class="codeExecuted">7</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;password&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$password;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">63</span></td><td class="coverageDetails"><span class="codeExecuted">7</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;first_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$first_name;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">64</span></td><td class="coverageDetails"><span class="codeExecuted">7</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;last_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$last_name;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">65</span></td><td class="coverageDetails"><span class="codeExecuted">7</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;phone&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$phone;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">66</span></td><td class="coverageDetails"><span class="codeExecuted">7</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;fb_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$fb_id;</span></code></td></tr><tr><td class="coverageDetails"><span>67</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;//&nbsp;&nbsp;&nbsp;$this-&gt;fb_access_token&nbsp;=&nbsp;$fb_access_token;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">68</span></td><td class="coverageDetails"><span class="codeExecuted">7</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;account_type&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$account_type;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">69</span></td><td class="coverageDetails"><span class="codeExecuted">7</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;uvs_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span>70</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>71</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>72</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;create($email,&nbsp;$password,&nbsp;$first_name,&nbsp;$last_name,&nbsp;$phone,&nbsp;$fb_id,&nbsp;$account_type,&nbsp;$uvs_id&nbsp;=&nbsp;NULL)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">73</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;new&nbsp;self($email,&nbsp;$password,&nbsp;$first_name,&nbsp;$last_name,&nbsp;$phone,&nbsp;$fb_id,&nbsp;$account_type,&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">74</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$confirmed&nbsp;&nbsp;&nbsp;=&nbsp;($account_type&nbsp;==&nbsp;'confirmed')&nbsp;?&nbsp;1:&nbsp;NULL;&nbsp;&nbsp;//for&nbsp;account_email&nbsp;or&nbsp;account_phone</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">75</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$reserved&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;($account_type&nbsp;==&nbsp;'reserved')&nbsp;&nbsp;?&nbsp;1:&nbsp;NULL;&nbsp;&nbsp;//for&nbsp;account_email&nbsp;or&nbsp;account_phone</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">76</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$provisional&nbsp;=&nbsp;($account_type&nbsp;==&nbsp;'confirmed')&nbsp;?&nbsp;0:&nbsp;1;&nbsp;&nbsp;//for&nbsp;account</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">77</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$login_enabled&nbsp;=&nbsp;isset($password)&nbsp;?&nbsp;1:&nbsp;0;</span></code></td></tr><tr><td class="coverageDetails"><span>78</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">79</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">80</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$i_email&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$conn-&gt;escape($email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">81</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$i_first_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$conn-&gt;escape($first_name);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">82</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$i_last_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$conn-&gt;escape($last_name);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">83</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$i_phone&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$conn-&gt;escape($phone);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">84</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$i_fb_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$conn-&gt;escape($fb_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">85</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$i_account_type&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$conn-&gt;escape($account_type);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">86</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$i_confirmed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$conn-&gt;escape($confirmed);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">87</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$i_reserved&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$conn-&gt;escape($reserved);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">88</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if(isset($password))&nbsp;$i_password_hash&nbsp;=&nbsp;$conn-&gt;escape(crypt($password,&nbsp;User::generate_bcrypt_salt()));</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">89</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;$i_password_hash&nbsp;=&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>90</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">91</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if(isset($uvs_id))&nbsp;{&nbsp;&nbsp;&nbsp;//existing&nbsp;user</span></code></td></tr><tr><td class="coverageDetails"><span>92</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;1:&nbsp;update&nbsp;record&nbsp;in&nbsp;`account`&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>93</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//changed&nbsp;MD5&nbsp;to&nbsp;crypt</span></code></td></tr><tr><td class="coverageDetails"><span>94</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account&nbsp;SET&nbsp;password&nbsp;=&nbsp;MD5($i_password),&nbsp;first_name&nbsp;=&nbsp;$i_first_name,&nbsp;last_name&nbsp;=&nbsp;$i_last_name,&nbsp;fb_id&nbsp;=&nbsp;$i_fb_id,&nbsp;provisional&nbsp;=&nbsp;$provisional,&nbsp;creation_time&nbsp;=&nbsp;NOW()&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">95</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account&nbsp;SET&nbsp;password&nbsp;=&nbsp;$i_password_hash,&nbsp;first_name&nbsp;=&nbsp;$i_first_name,&nbsp;last_name&nbsp;=&nbsp;$i_last_name,&nbsp;fb_id&nbsp;=&nbsp;$i_fb_id,&nbsp;provisional&nbsp;=&nbsp;$provisional,&nbsp;creation_time&nbsp;=&nbsp;NOW()&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">96</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>97</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//new&nbsp;user</span></code></td></tr><tr><td class="coverageDetails"><span>98</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;0:&nbsp;create&nbsp;a&nbsp;new&nbsp;uvs_id</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">99</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;uvs_object(object_type,&nbsp;creation_time)&nbsp;VALUES&nbsp;('account',&nbsp;NOW())&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">100</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">101</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;-&nbsp;$conn-&gt;last_insert_id();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">102</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;uvs_id&nbsp;=&nbsp;$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span>103</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;1:&nbsp;add&nbsp;record&nbsp;to&nbsp;`account`&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>104</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//changed&nbsp;MD5&nbsp;to&nbsp;crypt</span></code></td></tr><tr><td class="coverageDetails"><span>105</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;account(uvs_id,&nbsp;password,&nbsp;first_name,&nbsp;last_name,&nbsp;fb_id,&nbsp;provisional,&nbsp;creation_time)&nbsp;VALUES&nbsp;($uvs_id,&nbsp;MD5($i_password),&nbsp;$i_first_name,&nbsp;$i_last_name,&nbsp;$i_fb_id,&nbsp;$provisional,&nbsp;NOW())&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">106</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($i_password_hash){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">107</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;account(uvs_id,&nbsp;password,&nbsp;first_name,&nbsp;last_name,&nbsp;fb_id,&nbsp;provisional,&nbsp;creation_time)&nbsp;VALUES&nbsp;($uvs_id,&nbsp;$i_password_hash,&nbsp;$i_first_name,&nbsp;$i_last_name,&nbsp;$i_fb_id,&nbsp;$provisional,&nbsp;NOW())&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>108</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">109</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;account(uvs_id,&nbsp;first_name,&nbsp;last_name,&nbsp;fb_id,&nbsp;provisional,&nbsp;creation_time)&nbsp;VALUES&nbsp;($uvs_id,&nbsp;$i_first_name,&nbsp;$i_last_name,&nbsp;$i_fb_id,&nbsp;$provisional,&nbsp;NOW())&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>110</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">111</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>112</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>113</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;2:&nbsp;add&nbsp;record&nbsp;to&nbsp;account_email</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">114</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if(isset($email))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">115</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;account_email(uvs_id,&nbsp;email,&nbsp;confirmed,&nbsp;reserved,&nbsp;login_enabled,&nbsp;is_primary,&nbsp;creation_time)&nbsp;VALUES&nbsp;($uvs_id,&nbsp;$i_email,&nbsp;$i_confirmed,&nbsp;$i_reserved,&nbsp;$login_enabled,&nbsp;1,&nbsp;NOW())&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">116</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">117</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$email_id&nbsp;=&nbsp;$conn-&gt;last_insert_id();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">118</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$confirmed&nbsp;&amp;&amp;&nbsp;!$reserved)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">119</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::send_email_code($email_id,&nbsp;$email,&nbsp;NULL,&nbsp;TRUE);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">120</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if($reserved)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">121</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::send_signup_invitation($email);</span></code></td></tr><tr><td class="coverageDetails"><span>122</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>123</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>124</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;3:&nbsp;add&nbsp;record&nbsp;to&nbsp;account_phone</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">125</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if(isset($phone))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">126</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;account_phone(uvs_id,&nbsp;phone,&nbsp;confirmed,&nbsp;reserved,&nbsp;login_enabled,&nbsp;creation_time)&nbsp;VALUES&nbsp;($uvs_id,&nbsp;$i_phone,&nbsp;$i_confirmed,&nbsp;$i_reserved,&nbsp;$login_enabled,&nbsp;NOW())&quot;;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">127</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">128</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$phone_id&nbsp;=&nbsp;$conn-&gt;last_insert_id();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">129</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$confirmed&nbsp;&amp;&amp;&nbsp;!$reserved)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">130</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::send_sms_code($phone_id,&nbsp;$phone);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">131</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if($reserved)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>132</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//self::send_signup_invitation($phone);</span></code></td></tr><tr><td class="coverageDetails"><span>133</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>134</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">135</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$user;</span></code></td></tr><tr><td class="coverageDetails"><span>136</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>137</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>138</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;generate_bcrypt_salt()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>139</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Salt&nbsp;must&nbsp;be&nbsp;22&nbsp;characters&nbsp;long&nbsp;from&nbsp;alphabet&nbsp;&quot;./0-9A-Za-z&quot;&nbsp;.</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">140</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fp&nbsp;=&nbsp;fopen('/dev/urandom',&nbsp;'rb');</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">141</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$salt&nbsp;=&nbsp;rtrim(strtr(base64_encode(fread($fp,&nbsp;16)),&nbsp;&quot;+&quot;,&nbsp;&quot;.&quot;),&nbsp;'=');</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">142</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fclose($fp);</span></code></td></tr><tr><td class="coverageDetails"><span>143</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>144</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;The&nbsp;salt&nbsp;defines&nbsp;what&nbsp;algorithm&nbsp;to&nbsp;use,&nbsp;and&nbsp;for&nbsp;bcrypt,&nbsp;the&nbsp;cost&nbsp;parameter.</span></code></td></tr><tr><td class="coverageDetails"><span>145</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;$2y$&nbsp;will&nbsp;make&nbsp;crypt()&nbsp;use&nbsp;bcrypt.</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">146</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cost&nbsp;=&nbsp;11;&nbsp;//&nbsp;Iterate&nbsp;2^11&nbsp;times.</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">147</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;'$2y$'&nbsp;.&nbsp;$cost&nbsp;.&nbsp;'$'&nbsp;.&nbsp;$salt&nbsp;.&nbsp;'$';&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>148</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>149</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>150</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;update($conn,&nbsp;$query)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">151</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>152</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>153</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>154</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;delete($uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">155</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!is_numeric($uvs_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">156</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>157</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">158</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>159</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;1:&nbsp;delete&nbsp;from&nbsp;`account`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">160</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account&nbsp;SET&nbsp;status&nbsp;=&nbsp;'deleted'&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">161</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">162</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">163</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>164</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>165</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;2:&nbsp;delete&nbsp;from&nbsp;`account_email`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">166</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">167</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>168</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>169</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;3:&nbsp;delete&nbsp;from&nbsp;`account_phone`</span></code></td></tr><tr><td class="coverageDetails"><span>170</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;4:&nbsp;delete&nbsp;from&nbsp;`facebook_token`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">171</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;facebook_token&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">172</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>173</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;5:&nbsp;delete&nbsp;from&nbsp;`org_token`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">174</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;org_token&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">175</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>176</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;6:&nbsp;delete&nbsp;from&nbsp;`uvs_token`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">177</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;uvs_token&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">178</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>179</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;7:&nbsp;delete&nbsp;from&nbsp;`badge`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">180</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;badge&nbsp;SET&nbsp;status&nbsp;=&nbsp;'deleted',&nbsp;update_time&nbsp;=&nbsp;NOW()&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&nbsp;AND&nbsp;status&nbsp;='active'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">181</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>182</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;8:&nbsp;delete&nbsp;from&nbsp;`org_admin`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">183</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;org_admin&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">184</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>185</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;9:&nbsp;delete&nbsp;from&nbsp;`account_image`</span></code></td></tr><tr><td class="coverageDetails"><span>186</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;account_image&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>187</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>188</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;10:&nbsp;delete&nbsp;from&nbsp;`doc`</span></code></td></tr><tr><td class="coverageDetails"><span>189</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;doc&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>190</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>191</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;11:&nbsp;delete&nbsp;from&nbsp;`doc_share`</span></code></td></tr><tr><td class="coverageDetails"><span>192</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;doc_share&nbsp;WHERE&nbsp;uvs_id_sender&nbsp;=&nbsp;$uvs_id&nbsp;OR&nbsp;uvs_id_recipient&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>193</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>194</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;12:&nbsp;delete&nbsp;from&nbsp;`user_device`</span></code></td></tr><tr><td class="coverageDetails"><span>195</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;user_device&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>196</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>197</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;13:&nbsp;delete&nbsp;from&nbsp;`user_keys`</span></code></td></tr><tr><td class="coverageDetails"><span>198</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;user_keys&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>199</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>200</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;14:&nbsp;delete&nbsp;from&nbsp;`user_resource`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">201</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;user_resource&nbsp;SET&nbsp;status&nbsp;=&nbsp;'deleted',&nbsp;update_time&nbsp;=&nbsp;NOW()&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&nbsp;AND&nbsp;status&nbsp;='active'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">202</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>203</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;15:&nbsp;delete&nbsp;from&nbsp;`shared_resource`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">204</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;shared_resource&nbsp;SET&nbsp;status&nbsp;=&nbsp;'deleted',&nbsp;update_time&nbsp;=&nbsp;NOW()&nbsp;WHERE&nbsp;(shared_by&nbsp;=&nbsp;$uvs_id&nbsp;OR&nbsp;shared_with&nbsp;=&nbsp;$uvs_id)&nbsp;AND&nbsp;status&nbsp;='active'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">205</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">206</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>207</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>208</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>209</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;merge($id_to,&nbsp;$id_from)&nbsp;{&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">210</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;($id_to&nbsp;==&nbsp;$id_from)&nbsp;||&nbsp;is_null($id_to)&nbsp;||&nbsp;is_null($id_from)&nbsp;)&nbsp;{&nbsp;//assuming&nbsp;id&nbsp;will&nbsp;never&nbsp;be&nbsp;0</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">211</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>212</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">213</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>214</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>215</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;1:&nbsp;merge&nbsp;`account`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">216</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&nbsp;AND&nbsp;provisional&nbsp;=&nbsp;0&nbsp;AND&nbsp;status&nbsp;='active'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">217</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">218</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">219</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>220</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">221</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$password_from&nbsp;&nbsp;&nbsp;=&nbsp;$result[&quot;password&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">222</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$first_name_from&nbsp;=&nbsp;$result[&quot;first_name&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">223</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$last_name_from&nbsp;&nbsp;=&nbsp;$result[&quot;last_name&quot;];&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">224</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fb_id_from&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(int)$result[&quot;fb_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">225</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_to&quot;;&nbsp;//&nbsp;AND&nbsp;provisional&nbsp;=&nbsp;0&quot;;(removed,&nbsp;so&nbsp;can&nbsp;merge&nbsp;to&nbsp;reserved&nbsp;id)</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">226</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">227</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">228</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>229</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">230</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$password&nbsp;&nbsp;&nbsp;=&nbsp;$conn-&gt;escape(&nbsp;$result[&quot;password&quot;]&nbsp;?&nbsp;$result[&quot;password&quot;]&nbsp;:&nbsp;$password_from&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">231</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$first_name&nbsp;=&nbsp;$conn-&gt;escape(&nbsp;$result[&quot;first_name&quot;]&nbsp;?&nbsp;$result[&quot;first_name&quot;]&nbsp;:&nbsp;$first_name_from&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">232</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$last_name&nbsp;&nbsp;=&nbsp;$conn-&gt;escape(&nbsp;$result[&quot;last_name&quot;]&nbsp;?&nbsp;$result[&quot;last_name&quot;]&nbsp;:&nbsp;$last_name_from&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">233</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fb_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$conn-&gt;escape(&nbsp;(int)$result[&quot;fb_id&quot;]&nbsp;?&nbsp;(int)$result[&quot;fb_id&quot;]:&nbsp;($fb_id_from&nbsp;?&nbsp;$fb_id_from:&nbsp;NULL)&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span>234</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">235</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account&nbsp;SET&nbsp;password&nbsp;=&nbsp;$password,&nbsp;first_name&nbsp;=&nbsp;$first_name,&nbsp;last_name&nbsp;=&nbsp;$last_name,&nbsp;fb_id&nbsp;=&nbsp;$fb_id,&nbsp;provisional&nbsp;=&nbsp;0&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_to&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">236</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>237</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">238</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account&nbsp;SET&nbsp;status&nbsp;=&nbsp;'merged'&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">239</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>240</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>241</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;2:&nbsp;merge&nbsp;`account_email`&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">242</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;AND&nbsp;is_primary&nbsp;&nbsp;=&nbsp;1&quot;;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">243</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">244</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>245</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//non-conflict&nbsp;email</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">246</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_email&nbsp;SET&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&nbsp;AND&nbsp;email&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+247</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOT&nbsp;IN&nbsp;(select&nbsp;email&nbsp;from&nbsp;(select&nbsp;*&nbsp;from&nbsp;account_email&nbsp;where&nbsp;uvs_id&nbsp;=&nbsp;$id_to)&nbsp;as&nbsp;email_tmp)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">248</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>249</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>250</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//...conflict&nbsp;email,&nbsp;just&nbsp;merge&nbsp;confirmed&amp;login_enabled&nbsp;email&nbsp;for&nbsp;now</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">251</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_email&nbsp;SET&nbsp;confirmed&nbsp;=&nbsp;1,&nbsp;&nbsp;login_enabled&nbsp;=&nbsp;1&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;AND&nbsp;email&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+252</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;(select&nbsp;email&nbsp;from&nbsp;(select&nbsp;*&nbsp;from&nbsp;account_email&nbsp;where&nbsp;uvs_id&nbsp;=&nbsp;$id_from&nbsp;AND&nbsp;confirmed&nbsp;=&nbsp;1&nbsp;AND&nbsp;login_enabled&nbsp;=&nbsp;1)&nbsp;as&nbsp;email_tmp)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">253</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>254</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//...</span></code></td></tr><tr><td class="coverageDetails"><span>255</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>256</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>257</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;//primary&nbsp;email&nbsp;already&nbsp;exists&nbsp;in&nbsp;id_to</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">258</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_email&nbsp;SET&nbsp;uvs_id&nbsp;=&nbsp;$id_to,&nbsp;is_primary&nbsp;=&nbsp;0&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&nbsp;AND&nbsp;email&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+259</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOT&nbsp;IN&nbsp;(select&nbsp;email&nbsp;from&nbsp;(select&nbsp;*&nbsp;from&nbsp;account_email&nbsp;where&nbsp;uvs_id&nbsp;=&nbsp;$id_to)&nbsp;as&nbsp;email_tmp)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">260</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>261</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>262</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//...conflict&nbsp;email,&nbsp;just&nbsp;merge&nbsp;confirmed&amp;login_enabled&nbsp;email&nbsp;for&nbsp;now</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">263</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_email&nbsp;SET&nbsp;confirmed&nbsp;=&nbsp;1,&nbsp;&nbsp;login_enabled&nbsp;=&nbsp;1&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;AND&nbsp;email&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+264</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;(select&nbsp;email&nbsp;from&nbsp;(select&nbsp;*&nbsp;from&nbsp;account_email&nbsp;where&nbsp;uvs_id&nbsp;=&nbsp;$id_from&nbsp;AND&nbsp;confirmed&nbsp;=&nbsp;1&nbsp;AND&nbsp;login_enabled&nbsp;=&nbsp;1)&nbsp;as&nbsp;email_tmp)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">265</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>266</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//...</span></code></td></tr><tr><td class="coverageDetails"><span>267</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>268</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">269</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">270</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>271</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>272</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;3:&nbsp;merge&nbsp;`account_phone`&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">273</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_phone&nbsp;SET&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">274</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>275</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>276</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;4:&nbsp;merge&nbsp;`facebook_token`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">277</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;facebook_token&nbsp;SET&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">278</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>279</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>280</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;5:&nbsp;merge&nbsp;`org_token`</span></code></td></tr><tr><td class="coverageDetails"><span>281</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//if&nbsp;there&nbsp;are&nbsp;conflict&nbsp;org_token&nbsp;(tokens&nbsp;from&nbsp;the&nbsp;same&nbsp;org),&nbsp;then&nbsp;ignore&nbsp;the&nbsp;one&nbsp;from&nbsp;$id_from</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">282</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;org_token&nbsp;SET&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&nbsp;AND&nbsp;org_id&nbsp;NOT&nbsp;IN&nbsp;(select&nbsp;org_id&nbsp;from&nbsp;(select&nbsp;*&nbsp;from&nbsp;org_token&nbsp;where&nbsp;uvs_id&nbsp;=&nbsp;$id_to)&nbsp;as&nbsp;org_token_tmp)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">283</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">284</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;org_token&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">285</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>286</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>287</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;6:&nbsp;merge&nbsp;`uvs_token`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">288</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;uvs_token&nbsp;SET&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">289</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>290</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>291</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;7:&nbsp;add&nbsp;log&nbsp;to&nbsp;`merged_account`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">292</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;merged_account(merged_uvs_id,&nbsp;uvs_id,&nbsp;update_time)&nbsp;VALUES&nbsp;($id_from,&nbsp;$id_to,&nbsp;NOW())&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">293</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>294</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>295</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;8:&nbsp;merge&nbsp;`badge`</span></code></td></tr><tr><td class="coverageDetails"><span>296</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//if&nbsp;there&nbsp;are&nbsp;conflict&nbsp;badges&nbsp;(badges&nbsp;from&nbsp;the&nbsp;same&nbsp;group&nbsp;of&nbsp;an&nbsp;org),&nbsp;then&nbsp;ignore&nbsp;the&nbsp;one&nbsp;from&nbsp;$id_from</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">297</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;badge&nbsp;SET&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&nbsp;AND&nbsp;(orgid,&nbsp;groupname)&nbsp;NOT&nbsp;IN&nbsp;(select&nbsp;orgid,&nbsp;groupname&nbsp;from&nbsp;(select&nbsp;*&nbsp;from&nbsp;badge&nbsp;where&nbsp;uvs_id&nbsp;=&nbsp;$id_to)&nbsp;as&nbsp;badge_tmp)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">298</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>299</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>300</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;9:&nbsp;merge&nbsp;`org_admin`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">301</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;org_admin&nbsp;SET&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">302</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>303</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>304</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;10:&nbsp;merge&nbsp;`account_image`</span></code></td></tr><tr><td class="coverageDetails"><span>305</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;merge&nbsp;images&nbsp;from&nbsp;id_from&nbsp;to&nbsp;id_to,&nbsp;while&nbsp;corresponding&nbsp;field&nbsp;is&nbsp;NULL&nbsp;for&nbsp;id_to</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">306</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_image&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">307</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">308</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">309</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>310</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>311</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">312</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$profile_photo_url_from&nbsp;=&nbsp;$result[&quot;profile_photo_url&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">313</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$initials_url_from&nbsp;=&nbsp;$result[&quot;initials_url&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">314</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$signature_url_from&nbsp;=&nbsp;$result[&quot;signature_url&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">315</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_image&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_to&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">316</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">317</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">318</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_image&nbsp;SET&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">319</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>320</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">321</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_profile_photo_url&nbsp;=&nbsp;$conn-&gt;escape&nbsp;(&nbsp;$result[&quot;profile_photo_url&quot;]&nbsp;?&nbsp;$result[&quot;profile_photo_url&quot;]:&nbsp;&nbsp;$profile_photo_url_from&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">322</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_initials_url&nbsp;=&nbsp;$conn-&gt;escape&nbsp;(&nbsp;$result[&quot;initials_url&quot;]&nbsp;?&nbsp;$result[&quot;initials_url&quot;]:&nbsp;$initials_url_from&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">323</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_signature_url&nbsp;=&nbsp;$conn-&gt;escape&nbsp;(&nbsp;$result[&quot;signature_url&quot;]&nbsp;?&nbsp;$result[&quot;signature_url&quot;]:&nbsp;$signature_url_from&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">324</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_image&nbsp;SET&nbsp;profile_photo_url&nbsp;=&nbsp;$i_profile_photo_url,&nbsp;initials_url&nbsp;=&nbsp;$i_initials_url,&nbsp;signature_url&nbsp;=&nbsp;$i_signature_url&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_to&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">325</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">326</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;account_image&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">327</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>328</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>329</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>330</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;11:&nbsp;merge&nbsp;`doc`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">331</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;doc&nbsp;SET&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">332</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>333</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>334</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;12:&nbsp;merge&nbsp;`doc_share`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">335</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;doc_share&nbsp;SET&nbsp;uvs_id_sender&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;uvs_id_sender&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">336</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>337</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//non-conflict&nbsp;`doc_id`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">338</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;doc_share&nbsp;SET&nbsp;uvs_id_recipient&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;uvs_id_recipient&nbsp;=&nbsp;$id_from&nbsp;AND&nbsp;doc_id&nbsp;NOT&nbsp;IN&nbsp;(select&nbsp;doc_id&nbsp;from&nbsp;(select&nbsp;*&nbsp;from&nbsp;doc_share&nbsp;where&nbsp;uvs_id_recipient&nbsp;=&nbsp;$id_to)&nbsp;as&nbsp;doc_share_tmp)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">339</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>340</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>341</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;13:&nbsp;merge&nbsp;`resource`</span></code></td></tr><tr><td class="coverageDetails"><span>342</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//update&nbsp;owned&nbsp;keys,&nbsp;ignore&nbsp;sames&nbsp;key,&nbsp;if&nbsp;the&nbsp;user_to's&nbsp;status&nbsp;is&nbsp;'active'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">343</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;user_resource&nbsp;SET&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&nbsp;AND&nbsp;resource_id&nbsp;NOT&nbsp;IN&nbsp;(SELECT&nbsp;resource_id&nbsp;FROM&nbsp;(SELECT&nbsp;*&nbsp;FROM&nbsp;user_resource&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;AND&nbsp;status&nbsp;=&nbsp;'active')&nbsp;as&nbsp;user_resource_tmp)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">344</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>345</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//delete&nbsp;sames&nbsp;key&nbsp;with&nbsp;status&nbsp;is&nbsp;not&nbsp;'active'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">346</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;user_resource&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;AND&nbsp;status&nbsp;&lt;&gt;&nbsp;'active'&nbsp;AND&nbsp;resource_id&nbsp;IN&nbsp;(SELECT&nbsp;resource_id&nbsp;FROM&nbsp;(SELECT&nbsp;*&nbsp;FROM&nbsp;user_resource&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;AND&nbsp;status&nbsp;=&nbsp;'active')&nbsp;as&nbsp;user_resource_tmp)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">347</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>348</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>349</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;14:&nbsp;merge&nbsp;`shared_resource`</span></code></td></tr><tr><td class="coverageDetails"><span>350</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//update&nbsp;sent&nbsp;keys</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">351</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;shared_resource&nbsp;SET&nbsp;shared_by&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;shared_by&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">352</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>353</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//update&nbsp;received&nbsp;keys</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">354</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;shared_resource&nbsp;SET&nbsp;shared_with&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;shared_with&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">355</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>356</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>357</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;15:&nbsp;merge&nbsp;`shared_key`&nbsp;FIXME:&nbsp;temporary&nbsp;use,&nbsp;delete&nbsp;when&nbsp;drop&nbsp;'shared_key'</span></code></td></tr><tr><td class="coverageDetails"><span>358</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//update&nbsp;sent&nbsp;keys</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">359</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;shared_key&nbsp;SET&nbsp;shared_by&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;shared_by&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">360</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>361</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//update&nbsp;received&nbsp;keys</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">362</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;shared_key&nbsp;SET&nbsp;shared_with&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;shared_with&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">363</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>364</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>365</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;16:&nbsp;merge&nbsp;'client_store'&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>366</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//this&nbsp;merge&nbsp;is&nbsp;hard&nbsp;to&nbsp;be&nbsp;compable&nbsp;for&nbsp;every&nbsp;type(key_name)&nbsp;of&nbsp;data&nbsp;client&nbsp;stored,&nbsp;(server&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>367</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//could&nbsp;not&nbsp;know&nbsp;how&nbsp;to&nbsp;'add'&nbsp;them,&nbsp;we&nbsp;could&nbsp;only&nbsp;use&nbsp;either,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>368</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//so&nbsp;if&nbsp;A&nbsp;merges&nbsp;B,&nbsp;A's&nbsp;data&nbsp;will&nbsp;be&nbsp;filled&nbsp;with&nbsp;B's&nbsp;only&nbsp;if&nbsp;A&nbsp;has&nbsp;no&nbsp;data&nbsp;of&nbsp;this&nbsp;type,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>369</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//or&nbsp;B's&nbsp;will&nbsp;be&nbsp;ignored&nbsp;directly.&nbsp;Unless&nbsp;we&nbsp;defined&nbsp;special&nbsp;logic&nbsp;for&nbsp;the&nbsp;specific&nbsp;type,&nbsp;like&nbsp;KeysFavorites</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">370</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">371</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;client_store&nbsp;WHERE&nbsp;uvs_id&nbsp;in&nbsp;($id_from,&nbsp;$id_to)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">372</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$client_stores&nbsp;=&nbsp;$conn-&gt;select_all($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">373</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($client_stores))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">374</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key_names&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">375</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$from_values&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">376</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$to_values&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">377</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($client_stores&nbsp;as&nbsp;$client_store)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">378</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uid&nbsp;=&nbsp;(int)$client_store[&quot;uvs_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">379</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key_name&nbsp;=&nbsp;$client_store[&quot;key_name&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">380</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data&nbsp;=&nbsp;$client_store[&quot;data&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">381</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!in_array($key_name,&nbsp;$key_names))&nbsp;$key_names[]&nbsp;=&nbsp;$key_name;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">382</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($uid&nbsp;==&nbsp;$id_from)&nbsp;$from_values[$key_name]&nbsp;=&nbsp;$data;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">383</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;$to_values[$key_name]&nbsp;=&nbsp;$data;</span></code></td></tr><tr><td class="coverageDetails"><span>384</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">385</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($key_names&nbsp;as&nbsp;$tmp)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">386</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($from_values[$tmp]))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">387</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($tmp&nbsp;==&nbsp;&quot;keysFavorites&quot;)&nbsp;{//special&nbsp;operation</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">388</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">389</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($to_values[$tmp]))&nbsp;$to_array&nbsp;=&nbsp;json_decode($to_values[$tmp]);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">390</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$from_array&nbsp;=&nbsp;json_decode($from_values[$tmp]);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">391</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($to_array))&nbsp;$data&nbsp;=&nbsp;$to_array;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">392</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($from_array))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">393</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($from_array&nbsp;as&nbsp;$from_tmp)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">394</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!in_array($from_tmp,&nbsp;$data))&nbsp;$data[]&nbsp;=&nbsp;$from_tmp;</span></code></td></tr><tr><td class="coverageDetails"><span>395</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>396</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">397</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(count($data)&nbsp;&gt;&nbsp;0)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">398</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data&nbsp;=&nbsp;json_encode($data);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">399</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;REPLACE&nbsp;INTO&nbsp;client_store&nbsp;(uvs_id,&nbsp;key_name,&nbsp;data,&nbsp;update_time)&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+400</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUES&nbsp;($id_to,&nbsp;'$tmp',&nbsp;'$data',&nbsp;NOW())&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">401</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>402</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>403</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{//common&nbsp;operation:&nbsp;if&nbsp;id_to&nbsp;has&nbsp;no&nbsp;data,&nbsp;use&nbsp;id_from's&nbsp;else&nbsp;ignore</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">404</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($to_values[$tmp]))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">405</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;client_store&nbsp;SET&nbsp;uvs_id&nbsp;=&nbsp;$id_to,&nbsp;update_time&nbsp;=&nbsp;NOW()&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+406</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&nbsp;AND&nbsp;key_name&nbsp;=&nbsp;'$tmp'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">407</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>408</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>409</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>410</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>411</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>412</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>413</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>414</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;17:&nbsp;merge&nbsp;`user_device`</span></code></td></tr><tr><td class="coverageDetails"><span>415</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//only&nbsp;merge&nbsp;active&nbsp;device</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">416</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user_device_id&nbsp;=&nbsp;Device::get_next_device_id($id_to);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">417</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;user_device&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&nbsp;AND&nbsp;status='active'&nbsp;AND&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+418</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;device_uid&nbsp;NOT&nbsp;IN&nbsp;(SELECT&nbsp;device_uid&nbsp;FROM&nbsp;(&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;user_device&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;AND&nbsp;status='active')&nbsp;as&nbsp;user_device_tmp)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">419</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_all($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">420</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">421</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($result&nbsp;as&nbsp;$row)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">422</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$id&nbsp;=&nbsp;(int)$row[&quot;id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">423</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;user_device&nbsp;SET&nbsp;uvs_id&nbsp;=&nbsp;$id_to,&nbsp;user_device_id&nbsp;=&nbsp;$user_device_id&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;$id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">424</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">425</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user_device_id&nbsp;++;</span></code></td></tr><tr><td class="coverageDetails"><span>426</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>427</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>428</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>429</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;18:&nbsp;merge&nbsp;active&nbsp;log</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">430</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;active_log&nbsp;SET&nbsp;uvs_id&nbsp;=&nbsp;$id_to&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$id_from&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">431</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>432</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>433</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>434</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>435</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>436</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_merged_uvs_id($uvs_id_to)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">437</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;!is_numeric($uvs_id_to)&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">438</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span>439</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">440</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">441</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*,&nbsp;unix_timestamp(update_time)&nbsp;as&nbsp;merge_time&nbsp;FROM&nbsp;&nbsp;merged_account&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id_to&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">442</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_all($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">443</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">444</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span>445</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">446</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$merged_accounts&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">447</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($result&nbsp;as&nbsp;$row)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">448</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$merged_id&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">449</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$merged_id-&gt;uvs_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(int)$row[&quot;merged_uvs_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">450</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$merged_id-&gt;merge_time&nbsp;=&nbsp;(int)$row[&quot;merge_time&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">451</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$merged_accounts[]&nbsp;=&nbsp;$merged_id;</span></code></td></tr><tr><td class="coverageDetails"><span>452</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">453</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$merged_accounts;</span></code></td></tr><tr><td class="coverageDetails"><span>454</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>455</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>456</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_uvs_id($uvs_id,&nbsp;$application_id&nbsp;=&nbsp;NULL)&nbsp;{&nbsp;&nbsp;&nbsp;//if&nbsp;this&nbsp;uvs_id&nbsp;is&nbsp;merged,&nbsp;need&nbsp;to&nbsp;check&nbsp;the&nbsp;`merged_account`&nbsp;for&nbsp;the&nbsp;new&nbsp;uvs_id,&nbsp;ADD&nbsp;CODE&nbsp;LATER</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">457</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($uvs_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">458</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>459</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">460</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">461</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">462</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">463</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">464</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>465</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">466</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$first_name&nbsp;=&nbsp;$result[&quot;first_name&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">467</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$last_name&nbsp;&nbsp;=&nbsp;$result[&quot;last_name&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">468</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fb_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(int)$result[&quot;fb_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>469</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">470</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($result['password'])&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">471</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$pwd_exists&nbsp;=&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>472</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">473</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$pwd_exists&nbsp;=&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>474</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>475</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">476</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$account_type&nbsp;=&nbsp;(int)$result[&quot;provisional&quot;]&nbsp;?&nbsp;&quot;provisional&quot;:&nbsp;&quot;confirmed&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">477</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user_type&nbsp;=&nbsp;(int)$result[&quot;user_type&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>478</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//For&nbsp;those&nbsp;has&nbsp;many&nbsp;emails&nbsp;only&nbsp;get&nbsp;his&nbsp;confirmed&nbsp;or&nbsp;reserved</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">479</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&nbsp;AND&nbsp;(&nbsp;confirmed&nbsp;=&nbsp;1&nbsp;OR&nbsp;reserved&nbsp;=&nbsp;1&nbsp;)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">480</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">481</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">482</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$email&nbsp;=&nbsp;$result[&quot;email&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>483</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span>484</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//If&nbsp;the&nbsp;user&nbsp;is&nbsp;not&nbsp;confirmed,&nbsp;he&nbsp;should&nbsp;have&nbsp;only&nbsp;one&nbsp;email&nbsp;if&nbsp;he&nbsp;has&nbsp;email</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">485</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">486</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">487</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">488</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$email&nbsp;=&nbsp;$result[&quot;email&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>489</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>490</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">491</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_phone&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&nbsp;AND&nbsp;(&nbsp;confirmed&nbsp;=&nbsp;1&nbsp;OR&nbsp;reserved&nbsp;=&nbsp;1&nbsp;)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">492</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">493</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">494</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$phone&nbsp;=&nbsp;(int)$result[&quot;phone&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>495</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>496</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">497</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;new&nbsp;self($email,&nbsp;NULL,&nbsp;$first_name,&nbsp;$last_name,&nbsp;$phone,&nbsp;$fb_id,&nbsp;$account_type,&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">498</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;pwd_exists&nbsp;=&nbsp;$pwd_exists;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">499</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($application_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">500</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;set_uvs_token($conn,&nbsp;$application_id);</span></code></td></tr><tr><td class="coverageDetails"><span>501</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">502</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;user_type&nbsp;=&nbsp;$user_type;</span></code></td></tr><tr><td class="coverageDetails"><span>503</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;account&nbsp;images</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">504</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_image&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">505</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">506</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">507</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;profile_photo_url&nbsp;=&nbsp;$result[&quot;profile_photo_url&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">508</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;initials_url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$result[&quot;initials_url&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">509</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;signature_url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$result[&quot;signature_url&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>510</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>511</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>512</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;fb&nbsp;token&nbsp;info</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">513</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($application_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">514</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;facebook_token&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&nbsp;AND&nbsp;application_id&nbsp;=&nbsp;$application_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">515</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">516</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">517</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;fb_access_token&nbsp;&nbsp;&nbsp;=&nbsp;$result[&quot;fb_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">518</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;fb_token_expires&nbsp;&nbsp;=&nbsp;$result[&quot;expires&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>519</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>520</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>521</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>522</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;email,&nbsp;phone</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">523</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&nbsp;AND&nbsp;email&nbsp;IS&nbsp;NOT&nbsp;NULL&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">524</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_all($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">525</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($result&nbsp;as&nbsp;$row)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">526</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">527</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email-&gt;email_id&nbsp;=&nbsp;(int)$row[&quot;email_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">528</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email-&gt;email&nbsp;&nbsp;&nbsp;=&nbsp;$row[&quot;email&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">529</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email-&gt;is_primary&nbsp;&nbsp;&nbsp;=&nbsp;(int)$row[&quot;is_primary&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">530</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email-&gt;status&nbsp;&nbsp;=&nbsp;(int)$row[&quot;confirmed&quot;]&nbsp;?&nbsp;&quot;confirmed&quot;:&nbsp;&quot;pending&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">531</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;email_accounts[]&nbsp;=&nbsp;$i_email;</span></code></td></tr><tr><td class="coverageDetails"><span>532</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">533</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_phone&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">534</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_all($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">535</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($result&nbsp;as&nbsp;$row)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">536</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_phone&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">537</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_phone-&gt;phone&nbsp;&nbsp;&nbsp;=&nbsp;(int)$row[&quot;phone&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">538</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_phone-&gt;status&nbsp;&nbsp;=&nbsp;(int)$row[&quot;confirmed&quot;]&nbsp;?&nbsp;&quot;confirmed&quot;:&nbsp;&quot;pending&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">539</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;phone_numbers[]&nbsp;=&nbsp;$i_phone;</span></code></td></tr><tr><td class="coverageDetails"><span>540</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>541</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">542</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$user;</span></code></td></tr><tr><td class="coverageDetails"><span>543</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>544</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>545</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_fb_token($fb_access_token,&nbsp;$application_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">546</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($fb_access_token)&nbsp;||&nbsp;is_null($application_id)&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">547</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>548</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">549</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">550</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_fb_access_token&nbsp;=&nbsp;$conn-&gt;escape($fb_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">551</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;facebook_token&nbsp;WHERE&nbsp;fb_token&nbsp;=&nbsp;$i_fb_access_token&nbsp;AND&nbsp;application_id&nbsp;=&nbsp;$application_id&quot;;&nbsp;//&nbsp;AND&nbsp;expires&nbsp;&gt;&nbsp;NOW()&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">552</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">553</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">554</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>555</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">556</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$result[&quot;uvs_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>557</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;aacount&nbsp;info</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">558</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">559</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">560</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">561</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>562</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">563</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$first_name&nbsp;=&nbsp;$result[&quot;first_name&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">564</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$last_name&nbsp;&nbsp;=&nbsp;$result[&quot;last_name&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">565</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fb_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(int)$result[&quot;fb_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">566</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;new&nbsp;self(NULL,&nbsp;NULL,&nbsp;$first_name,&nbsp;$last_name,&nbsp;NULL,&nbsp;$fb_id,&nbsp;&quot;confirmed&quot;,&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">567</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;set_uvs_token($conn,&nbsp;$application_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">568</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$user;</span></code></td></tr><tr><td class="coverageDetails"><span>569</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>570</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>571</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_org_token($org_access_token,&nbsp;$org_id,&nbsp;$application_id,&nbsp;$uvs_id&nbsp;=&nbsp;NULL)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">572</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($org_access_token)&nbsp;||&nbsp;is_null($org_id)&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">573</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>574</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">575</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">576</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_org_access_token&nbsp;=&nbsp;$conn-&gt;escape($org_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">577</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;org_token&nbsp;WHERE&nbsp;org_token&nbsp;=&nbsp;$i_org_access_token&nbsp;AND&nbsp;org_id&nbsp;=&nbsp;$org_id&quot;;&nbsp;//&nbsp;AND&nbsp;expires&nbsp;&gt;&nbsp;NOW()</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">578</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">579</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;$query&nbsp;.&nbsp;&quot;&nbsp;AND&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>580</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">581</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">582</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">583</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>584</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">585</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$result[&quot;uvs_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>586</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;aacount&nbsp;info</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">587</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">588</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">589</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">590</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>591</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">592</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$first_name&nbsp;=&nbsp;$result[&quot;first_name&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">593</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$last_name&nbsp;&nbsp;=&nbsp;$result[&quot;last_name&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">594</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fb_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(int)$result[&quot;fb_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">595</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;new&nbsp;self(NULL,&nbsp;NULL,&nbsp;$first_name,&nbsp;$last_name,&nbsp;NULL,&nbsp;$fb_id,&nbsp;&quot;confirmed&quot;,&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">596</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;set_uvs_token($conn,&nbsp;$application_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">597</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$user;</span></code></td></tr><tr><td class="coverageDetails"><span>598</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>599</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>600</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_org_email($org_email,&nbsp;$org_id,&nbsp;$uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">601</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($org_email)&nbsp;||&nbsp;is_null($org_id)&nbsp;||&nbsp;is_null($uvs_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">602</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>603</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">604</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">605</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_org_email&nbsp;=&nbsp;$conn-&gt;escape($org_email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">606</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;org_token&nbsp;WHERE&nbsp;email&nbsp;=&nbsp;$i_org_email&nbsp;AND&nbsp;org_id&nbsp;=&nbsp;$org_id&nbsp;AND&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;&nbsp;//&nbsp;AND&nbsp;expires&nbsp;&gt;&nbsp;NOW()</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">607</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">608</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result;</span></code></td></tr><tr><td class="coverageDetails"><span>609</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>610</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>611</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_org_user_id($org_user_id,&nbsp;$org_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">612</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($org_user_id)&nbsp;||&nbsp;is_null($org_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">613</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>614</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">615</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">616</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;org_token&nbsp;WHERE&nbsp;org_user_id&nbsp;=&nbsp;$org_user_id&nbsp;AND&nbsp;org_id&nbsp;=&nbsp;$org_id&quot;;&nbsp;//&nbsp;AND&nbsp;expires&nbsp;&gt;&nbsp;NOW()</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">617</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">618</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(int)$result[&quot;uvs_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>619</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>620</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>621</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_fb_id($fb_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">622</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($fb_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">623</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>624</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">625</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">626</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account&nbsp;WHERE&nbsp;fb_id&nbsp;=&nbsp;$fb_id&nbsp;AND&nbsp;provisional&nbsp;=&nbsp;0&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">627</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">628</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">629</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>630</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">631</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(int)$result[&quot;uvs_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>632</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>633</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>634</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_fb_userinfo($fb_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">635</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($fb_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">636</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>637</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>638</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//search&nbsp;in&nbsp;mysql</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">639</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">640</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account&nbsp;WHERE&nbsp;fb_id&nbsp;=&nbsp;$fb_id&nbsp;AND&nbsp;provisional&nbsp;=&nbsp;0&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">641</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">642</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">643</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>644</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">645</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(int)$result[&quot;uvs_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>646</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>647</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>648</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;check_availability_by_email($email,&nbsp;$login_enabled&nbsp;=&nbsp;TRUE)&nbsp;{&nbsp;&nbsp;//</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">649</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($email))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">650</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>651</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">652</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;&nbsp;&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">653</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$email&nbsp;&nbsp;=&nbsp;$conn-&gt;escape($email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">654</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;email&nbsp;=&nbsp;$email&nbsp;AND&nbsp;confirmed&nbsp;=&nbsp;1&nbsp;AND&nbsp;uvs_id&nbsp;IS&nbsp;NOT&nbsp;NULL&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">655</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($login_enabled)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">656</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;$query.&nbsp;&quot;&nbsp;AND&nbsp;login_enabled&nbsp;=&nbsp;1&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>657</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">658</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">659</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">660</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>661</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">662</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>663</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>664</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>665</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_email($email,&nbsp;$confirmed_only&nbsp;=&nbsp;TRUE,&nbsp;$uvs_id&nbsp;=&nbsp;NULL,&nbsp;$primary_only&nbsp;=&nbsp;FALSE)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">666</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($email))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">667</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>668</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">669</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;&nbsp;&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">670</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email&nbsp;&nbsp;=&nbsp;$conn-&gt;escape($email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">671</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;email&nbsp;=&nbsp;$i_email&nbsp;AND&nbsp;uvs_id&nbsp;IS&nbsp;NOT&nbsp;NULL&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">672</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($confirmed_only)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">673</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;$query.&quot;&nbsp;AND&nbsp;confirmed&nbsp;=&nbsp;1&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>674</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">675</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">676</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;$query.&quot;&nbsp;AND&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>677</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">678</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($primary_only)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">679</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;$query.&quot;&nbsp;AND&nbsp;is_primary&nbsp;=&nbsp;1&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>680</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">681</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">682</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">683</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>684</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">685</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(int)$result[&quot;uvs_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>686</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>687</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>688</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_email_reserved($email)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">689</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($email))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">690</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>691</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">692</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;&nbsp;&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">693</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$email&nbsp;&nbsp;=&nbsp;$conn-&gt;escape($email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">694</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;email&nbsp;=&nbsp;$email&nbsp;AND&nbsp;reserved&nbsp;=&nbsp;1&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">695</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">696</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">697</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>698</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">699</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(int)$result[&quot;uvs_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>700</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>701</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>702</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_phone($phone)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">703</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($phone))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">704</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>705</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">706</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">707</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_phone&nbsp;WHERE&nbsp;phone&nbsp;=&nbsp;$phone&nbsp;AND&nbsp;confirmed&nbsp;=&nbsp;1&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">708</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">709</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">710</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>711</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">712</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(int)$result[&quot;uvs_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>713</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>714</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>715</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_public_key($uvs_id,&nbsp;$create_if_needed=false)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">716</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">717</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">718</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;public_key&nbsp;FROM&nbsp;user_keys&nbsp;WHERE&nbsp;uvs_id=$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">719</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">720</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">721</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;$create_if_needed&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">722</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$public_key&nbsp;=&nbsp;User::create_keypair($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">723</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$public_key&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">724</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$public_key;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>725</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>726</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">727</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>728</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">729</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result[&quot;public_key&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>730</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>731</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>732</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;create_keypair($uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">733</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">734</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$key_expiration&nbsp;&nbsp;&nbsp;=&nbsp;time()&nbsp;+&nbsp;315360000;&nbsp;&nbsp;//10&nbsp;years</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">735</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$key_passphrase&nbsp;&nbsp;&nbsp;=&nbsp;Util::gen_random('n',&nbsp;20);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">736</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$create_key_input&nbsp;=&nbsp;array(&quot;expiration&quot;&nbsp;=&gt;&nbsp;$key_expiration,&nbsp;&quot;passphrase&quot;&nbsp;=&gt;&nbsp;$key_passphrase);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">737</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;KSConnector::create_key($create_key_input);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">738</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$key&nbsp;&amp;&amp;&nbsp;$key-&gt;public_key)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">739</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">740</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$public_key_esc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$conn-&gt;escape(&nbsp;$key-&gt;public_key&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">741</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key_fingerprint&nbsp;=&nbsp;$conn-&gt;escape(&nbsp;$key-&gt;key_fingerprint&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">742</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key_passphrase&nbsp;&nbsp;=&nbsp;$conn-&gt;escape(&nbsp;$key_passphrase&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">743</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;user_keys&nbsp;(uvs_id,&nbsp;public_key,&nbsp;private_key,&nbsp;fingerprint,&nbsp;passphrase)&nbsp;VALUES&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+744</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($uvs_id,&nbsp;$public_key_esc,&nbsp;'in&nbsp;the&nbsp;keyserver',&nbsp;$key_fingerprint,&nbsp;$key_passphrase)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">745</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">746</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$result-&gt;num_affected_rows()&nbsp;&gt;&nbsp;0&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">747</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$key-&gt;public_key;</span></code></td></tr><tr><td class="coverageDetails"><span>748</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>749</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>750</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>751</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">752</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>753</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>754</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_private_key($uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">755</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">756</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">757</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;private_key&nbsp;FROM&nbsp;user_keys&nbsp;WHERE&nbsp;uvs_id=$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">758</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">759</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">760</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>761</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">762</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result[&quot;private_key&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>763</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>764</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>765</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_private_key_by_badge_id($badge_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">766</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$badge_id&nbsp;=&nbsp;(int)$badge_id;</span></code></td></tr><tr><td class="coverageDetails"><span>767</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Hardcoding&nbsp;the&nbsp;key&nbsp;for&nbsp;right&nbsp;now&nbsp;has&nbsp;to&nbsp;be&nbsp;updated&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>768</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//return&nbsp;User::get_private_key(1);</span></code></td></tr><tr><td class="coverageDetails"><span>769</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">770</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">771</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;private_key&nbsp;FROM&nbsp;badge&nbsp;b,&nbsp;user_keys&nbsp;uk&nbsp;WHERE&nbsp;b.badgeid=$badge_id&nbsp;and&nbsp;b.uvs_id=uk.uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">772</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">773</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">774</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>775</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">776</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result[&quot;private_key&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>777</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>778</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>779</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_public_key_by_badge_id($badge_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">780</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$badge_id&nbsp;=&nbsp;(int)$badge_id;</span></code></td></tr><tr><td class="coverageDetails"><span>781</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Hardcoding&nbsp;the&nbsp;key&nbsp;for&nbsp;right&nbsp;now&nbsp;has&nbsp;to&nbsp;be&nbsp;updated&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>782</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//return&nbsp;User::get_public_key(1);</span></code></td></tr><tr><td class="coverageDetails"><span>783</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">784</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">785</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;public_key&nbsp;FROM&nbsp;badge&nbsp;b,&nbsp;user_keys&nbsp;uk&nbsp;WHERE&nbsp;b.badgeid=$badge_id&nbsp;and&nbsp;b.uvs_id=uk.uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">786</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">787</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">788</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>789</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">790</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result[&quot;public_key&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>791</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>792</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>793</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_credential($email,&nbsp;$phone,&nbsp;$password,&nbsp;$application_id)&nbsp;{&nbsp;//for&nbsp;$email&nbsp;and&nbsp;$phone,&nbsp;provide&nbsp;either&nbsp;one;&nbsp;application_id&nbsp;is&nbsp;needed&nbsp;for&nbsp;creating&nbsp;uvs_token</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">794</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;(is_null($email)&nbsp;&amp;&amp;&nbsp;is_null($phone))&nbsp;||&nbsp;is_null($password)&nbsp;||&nbsp;is_null($application_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">795</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>796</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">797</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">798</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email&nbsp;=&nbsp;$conn-&gt;escape($email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">799</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_phone&nbsp;=&nbsp;$conn-&gt;escape($phone);</span></code></td></tr><tr><td class="coverageDetails"><span>800</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$i_password&nbsp;=&nbsp;$conn-&gt;escape($password);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">801</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;null;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">802</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;null;</span></code></td></tr><tr><td class="coverageDetails"><span>803</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//find&nbsp;password</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">804</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$logentry&nbsp;=&nbsp;Logentry::getInstance();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">805</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$logentry-&gt;start_sub(&quot;user&quot;,&nbsp;&quot;find_by_credential&quot;,&nbsp;&quot;get&nbsp;user&nbsp;info&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">806</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($email))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>807</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*changed&nbsp;MD5&nbsp;to&nbsp;crypt</span></code></td></tr><tr><td class="coverageDetails"><span>808</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Note:&nbsp;Added&nbsp;on&nbsp;2012-10-26</span></code></td></tr><tr><td class="coverageDetails"><span>809</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;email&nbsp;=&nbsp;$i_email&nbsp;AND&nbsp;confirmed&nbsp;=&nbsp;1&nbsp;AND&nbsp;login_enabled&nbsp;=&nbsp;1&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>810</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span>811</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result){</span></code></td></tr><tr><td class="coverageDetails"><span>812</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;ae.*&nbsp;FROM&nbsp;account_email&nbsp;ae,&nbsp;account&nbsp;account&nbsp;WHERE&nbsp;ae.email&nbsp;=&nbsp;$i_email&nbsp;AND&nbsp;ae.uvs_id=account.uvs_id&nbsp;AND&nbsp;account.password&nbsp;=&nbsp;MD5($i_password)&nbsp;and&nbsp;(ae.confirmed&nbsp;=&nbsp;0&nbsp;or&nbsp;ae.confirmed&nbsp;is&nbsp;NULL)&nbsp;AND&nbsp;ae.login_enabled&nbsp;=&nbsp;1&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>813</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span>814</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result){</span></code></td></tr><tr><td class="coverageDetails"><span>815</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerEmailNotConfirmedException('The&nbsp;email&nbsp;is&nbsp;not&nbsp;confirmed!');</span></code></td></tr><tr><td class="coverageDetails"><span>816</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>817</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>818</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">819</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;ac.*,&nbsp;ae.is_primary&nbsp;FROM&nbsp;account_email&nbsp;ae,&nbsp;account&nbsp;ac&nbsp;WHERE&nbsp;ae.email&nbsp;=&nbsp;$i_email&nbsp;AND&nbsp;ae.uvs_id&nbsp;=&nbsp;ac.uvs_id&nbsp;AND&nbsp;ae.confirmed&nbsp;=&nbsp;1&nbsp;AND&nbsp;ae.login_enabled&nbsp;=&nbsp;1&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">820</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">821</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">822</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;ac.*,&nbsp;ae.is_primary&nbsp;FROM&nbsp;account_email&nbsp;ae,&nbsp;account&nbsp;ac&nbsp;WHERE&nbsp;ae.email&nbsp;=&nbsp;$i_email&nbsp;AND&nbsp;ae.uvs_id=ac.uvs_id&nbsp;AND&nbsp;(ae.confirmed&nbsp;=&nbsp;0&nbsp;or&nbsp;ae.confirmed&nbsp;is&nbsp;NULL)&nbsp;AND&nbsp;ae.login_enabled&nbsp;=&nbsp;1&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">823</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result1&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">824</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result1){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">825</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(User::find_matched_password($password,&nbsp;$result1))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">826</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerEmailNotConfirmedException('The&nbsp;email&nbsp;is&nbsp;not&nbsp;confirmed!');</span></code></td></tr><tr><td class="coverageDetails"><span>827</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>828</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>829</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">830</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if(isset($phone))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>831</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_phone&nbsp;WHERE&nbsp;phone&nbsp;=&nbsp;$i_phone&nbsp;AND&nbsp;confirmed&nbsp;=&nbsp;1&nbsp;AND&nbsp;login_enabled&nbsp;=&nbsp;1&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>832</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span>833</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Note:&nbsp;iphone&nbsp;don't&nbsp;have&nbsp;email,&nbsp;fix&nbsp;it&nbsp;later</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">834</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;ac.*,&nbsp;1&nbsp;as&nbsp;is_primary&nbsp;FROM&nbsp;account_phone&nbsp;ap,&nbsp;account&nbsp;ac&nbsp;WHERE&nbsp;ap.phone&nbsp;=&nbsp;$i_phone&nbsp;AND&nbsp;ap.uvs_id&nbsp;=&nbsp;ac.uvs_id&nbsp;AND&nbsp;ap.confirmed&nbsp;=&nbsp;1&nbsp;AND&nbsp;ap.login_enabled&nbsp;=&nbsp;1&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">835</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span>836</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">837</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$logentry-&gt;end_sub();</span></code></td></tr><tr><td class="coverageDetails"><span>838</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">839</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$logentry-&gt;start_sub(&quot;user&quot;,&nbsp;&quot;find_by_credential&quot;,&nbsp;&quot;update&nbsp;login&nbsp;tries&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">840</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">841</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$result[&quot;uvs_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">842</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$login_tries&nbsp;=&nbsp;(int)$result[&quot;login_tries&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">843</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$last_login_failed_time&nbsp;=&nbsp;(int)$result[&quot;last_login_failed_time&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">844</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$now&nbsp;=&nbsp;strtotime(&quot;now&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">845</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($last_login_failed_time&nbsp;&lt;&nbsp;$now&nbsp;-&nbsp;ACCOUNT_LOCKING_DURATION)&nbsp;{&nbsp;//unlock&nbsp;the&nbsp;account</span></code></td></tr><tr><td class="coverageDetails"><span>846</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//cleanup&nbsp;`login_tries`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">847</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account&nbsp;SET&nbsp;login_tries&nbsp;=&nbsp;0&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">848</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">849</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;($login_tries&nbsp;&gt;=&nbsp;MAX_LOGIN_TRIES)&nbsp;{&nbsp;&nbsp;//account&nbsp;is&nbsp;still&nbsp;locked</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">850</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerAccountLockedException('Too&nbsp;many&nbsp;login&nbsp;failures!&nbsp;Please&nbsp;try&nbsp;again&nbsp;in&nbsp;a&nbsp;few&nbsp;minutes.');</span></code></td></tr><tr><td class="coverageDetails"><span>851</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>852</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//find&nbsp;matched&nbsp;password</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">853</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$password_hash&nbsp;=&nbsp;User::find_matched_password($password,&nbsp;$result);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">854</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$password_hash)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>855</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//update&nbsp;`login_tries`,&nbsp;`last_login_failed_time`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">856</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account&nbsp;SET&nbsp;login_tries&nbsp;=&nbsp;login_tries&nbsp;+&nbsp;1,&nbsp;last_login_failed_time&nbsp;=&nbsp;$now&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">857</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">858</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidCredentialException('The&nbsp;password&nbsp;is&nbsp;not&nbsp;correct!');</span></code></td></tr><tr><td class="coverageDetails"><span>859</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>860</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//cleanup&nbsp;`login_tries`</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">861</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account&nbsp;SET&nbsp;login_tries&nbsp;=&nbsp;0&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">862</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>863</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//convert&nbsp;MD5&nbsp;encrypt&nbsp;to&nbsp;bcrypt</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">864</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(strlen($password_hash)&nbsp;==&nbsp;PASSWORD_MD5_ENCRYPT_LENGTH)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">865</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User::update_password($uvs_id,&nbsp;$password);</span></code></td></tr><tr><td class="coverageDetails"><span>866</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>867</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">868</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>869</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">870</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$logentry-&gt;end_sub();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">871</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result[&quot;is_primary&quot;])&nbsp;{&nbsp;&nbsp;//only&nbsp;primary&nbsp;email&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;login</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">872</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>873</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>874</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>875</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//changed&nbsp;MD5&nbsp;to&nbsp;crypt,&nbsp;checked&nbsp;password&nbsp;already</span></code></td></tr><tr><td class="coverageDetails"><span>876</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&nbsp;AND&nbsp;password&nbsp;=&nbsp;MD5($i_password)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">877</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">878</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">879</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">880</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>881</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">882</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;new&nbsp;self($email,&nbsp;$password,&nbsp;$result[&quot;first_name&quot;],&nbsp;$result[&quot;last_name&quot;],&nbsp;NULL,&nbsp;(int)$result[&quot;fb_id&quot;],&nbsp;&quot;confirmed&quot;,&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">883</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;set_uvs_token($conn,&nbsp;$application_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">884</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;user_type&nbsp;=&nbsp;(int)$result[&quot;user_type&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>885</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">886</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($result['password'])&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">887</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$pwd_exists&nbsp;=&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>888</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">889</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$pwd_exists&nbsp;=&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>890</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">891</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;pwd_exists&nbsp;=&nbsp;$pwd_exists;</span></code></td></tr><tr><td class="coverageDetails"><span>892</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>893</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;account&nbsp;images</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">894</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_image&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">895</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">896</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">897</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;profile_photo_url&nbsp;=&nbsp;$result[&quot;profile_photo_url&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">898</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;initials_url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$result[&quot;initials_url&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">899</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;signature_url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$result[&quot;signature_url&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>900</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>901</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>902</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;fb&nbsp;token&nbsp;info</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">903</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;facebook_token&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&nbsp;AND&nbsp;application_id&nbsp;=&nbsp;$application_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">904</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">905</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">906</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;fb_access_token&nbsp;&nbsp;&nbsp;=&nbsp;$result[&quot;fb_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">907</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;fb_token_expires&nbsp;&nbsp;=&nbsp;$result[&quot;expires&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>908</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>909</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>910</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;email,&nbsp;phone</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">911</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&nbsp;AND&nbsp;email&nbsp;IS&nbsp;NOT&nbsp;NULL&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">912</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_all($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">913</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($result&nbsp;as&nbsp;$row)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">914</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">915</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email-&gt;email_id&nbsp;=&nbsp;(int)$row[&quot;email_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">916</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email-&gt;email&nbsp;&nbsp;&nbsp;=&nbsp;$row[&quot;email&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">917</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email-&gt;is_primary&nbsp;&nbsp;&nbsp;=&nbsp;(int)$row[&quot;is_primary&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">918</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email-&gt;status&nbsp;&nbsp;=&nbsp;(int)$row[&quot;confirmed&quot;]&nbsp;?&nbsp;&quot;confirmed&quot;:&nbsp;&quot;pending&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">919</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;email_accounts[]&nbsp;=&nbsp;$i_email;</span></code></td></tr><tr><td class="coverageDetails"><span>920</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">921</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_phone&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">922</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_all($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">923</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($result&nbsp;as&nbsp;$row)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">924</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_phone&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">925</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_phone-&gt;phone&nbsp;&nbsp;&nbsp;=&nbsp;(int)$row[&quot;phone&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">926</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_phone-&gt;status&nbsp;&nbsp;=&nbsp;(int)$row[&quot;confirmed&quot;]&nbsp;?&nbsp;&quot;confirmed&quot;:&nbsp;&quot;pending&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">927</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;phone_numbers[]&nbsp;=&nbsp;$i_phone;</span></code></td></tr><tr><td class="coverageDetails"><span>928</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>929</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">930</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$user;</span></code></td></tr><tr><td class="coverageDetails"><span>931</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>932</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>933</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//find&nbsp;matched&nbsp;password&nbsp;from&nbsp;a&nbsp;select&nbsp;query&nbsp;result</span></code></td></tr><tr><td class="coverageDetails"><span>934</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_matched_password($password,&nbsp;$row)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">935</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$logentry&nbsp;=&nbsp;Logentry::getInstance();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">936</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$logentry-&gt;start_sub(&quot;user&quot;,&nbsp;&quot;find_matched_password&quot;,&nbsp;&quot;crypt&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">937</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($row)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">938</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(strlen($row[&quot;password&quot;])&nbsp;==&nbsp;PASSWORD_MD5_ENCRYPT_LENGTH)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">939</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(MD5($password)&nbsp;==&nbsp;$row[&quot;password&quot;])&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">940</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$row[&quot;password&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>941</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>942</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">943</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(crypt($password,&nbsp;$row[&quot;password&quot;])&nbsp;==&nbsp;$row[&quot;password&quot;])&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">944</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$row[&quot;password&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>945</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>946</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>947</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">948</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$logentry-&gt;end_sub();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">949</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>950</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>951</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>952</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//now&nbsp;the&nbsp;input&nbsp;argument&nbsp;$uvs_access_token&nbsp;is&nbsp;appended&nbsp;with&nbsp;device&nbsp;id</span></code></td></tr><tr><td class="coverageDetails"><span>953</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_uvs_token($uvs_access_token,&nbsp;$include_fb_token&nbsp;=&nbsp;false,&nbsp;$include_accounts&nbsp;=&nbsp;false,&nbsp;$uvs_id&nbsp;=&nbsp;NULL,&nbsp;$ignore_device_uid&nbsp;=&nbsp;false)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>954</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;$_logger;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">955</span></td><td class="coverageDetails"><span class="codeExecuted">6</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($uvs_access_token))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">956</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>957</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>958</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;For&nbsp;logging,&nbsp;we&nbsp;resolve&nbsp;to&nbsp;uvs_id&nbsp;first.</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">959</span></td><td class="coverageDetails"><span class="codeExecuted">6</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;list(&nbsp;$uvs_pure_access_token,&nbsp;$device_uid)&nbsp;=&nbsp;explode(&quot;_&quot;,$uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span>960</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;token&nbsp;info</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">961</span></td><td class="coverageDetails"><span class="codeExecuted">6</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">962</span></td><td class="coverageDetails"><span class="codeExecuted">6</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$i_uvs_access_token&nbsp;=&nbsp;$conn-&gt;escape($uvs_pure_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">963</span></td><td class="coverageDetails"><span class="codeExecuted">6</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*,&nbsp;unix_timestamp(expires)&nbsp;as&nbsp;uexpires&nbsp;FROM&nbsp;uvs_token&nbsp;WHERE&nbsp;uvs_token&nbsp;=&nbsp;$i_uvs_access_token&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">964</span></td><td class="coverageDetails"><span class="codeExecuted">6</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">965</span></td><td class="coverageDetails"><span class="codeExecuted">6</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">966</span></td><td class="coverageDetails"><span class="codeExecuted">5</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$r_uvs_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(int)$result[&quot;uvs_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">967</span></td><td class="coverageDetails"><span class="codeExecuted">5</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_token_expires&nbsp;=&nbsp;$result[&quot;expires&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">968</span></td><td class="coverageDetails"><span class="codeExecuted">5</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$unix_uvs_token_expires&nbsp;=&nbsp;(int)$result[&quot;uexpires&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">969</span></td><td class="coverageDetails"><span class="codeExecuted">5</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$application_id&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(int)$result[&quot;application_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">970</span></td><td class="coverageDetails"><span class="codeExecuted">5</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_logger-&gt;uvs_id&nbsp;=&nbsp;$r_uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span>971</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>972</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">973</span></td><td class="coverageDetails"><span class="codeExecuted">6</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if(!&nbsp;$ignore_device_uid)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">974</span></td><td class="coverageDetails"><span class="codeExecuted">5</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::validate_uvs_token($uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span>975</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">976</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">977</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>978</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">979</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if($unix_uvs_token_expires&nbsp;&lt;=&nbsp;time())&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">980</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>981</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">982</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if($uvs_id&nbsp;and&nbsp;$uvs_id&nbsp;!=&nbsp;$r_uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">983</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>984</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">985</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;$r_uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span>986</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;aacount&nbsp;info</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">987</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">988</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">989</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">990</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>991</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">992</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$first_name&nbsp;=&nbsp;$result[&quot;first_name&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">993</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$last_name&nbsp;&nbsp;=&nbsp;$result[&quot;last_name&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">994</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$fb_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(int)$result[&quot;fb_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">995</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($result['password'])&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">996</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$pwd_exists&nbsp;=&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>997</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">998</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$pwd_exists&nbsp;=&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>999</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1000</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1001</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;new&nbsp;self(NULL,&nbsp;NULL,&nbsp;$first_name,&nbsp;$last_name,&nbsp;NULL,&nbsp;$fb_id,&nbsp;&quot;confirmed&quot;,&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1002</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;uvs_token_expires&nbsp;=&nbsp;$uvs_token_expires;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1003</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;application_id&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$application_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1004</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;pwd_exists&nbsp;=&nbsp;$pwd_exists;</span></code></td></tr><tr><td class="coverageDetails"><span>1005</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1006</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;account&nbsp;images</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1007</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_image&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1008</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1009</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1010</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;profile_photo_url&nbsp;=&nbsp;$result[&quot;profile_photo_url&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1011</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;initials_url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$result[&quot;initials_url&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1012</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;signature_url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;$result[&quot;signature_url&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>1013</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1014</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1015</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if($include_fb_token)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>1016</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;fb&nbsp;token&nbsp;info</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1017</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;facebook_token&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&nbsp;AND&nbsp;application_id&nbsp;=&nbsp;$application_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1018</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1019</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1020</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;fb_access_token&nbsp;&nbsp;&nbsp;=&nbsp;$result[&quot;fb_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1021</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;fb_token_expires&nbsp;&nbsp;=&nbsp;$result[&quot;expires&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>1022</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1023</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1024</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if($include_accounts)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1025</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&nbsp;AND&nbsp;email&nbsp;IS&nbsp;NOT&nbsp;NULL&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1026</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_all($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1027</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($result&nbsp;as&nbsp;$row)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1028</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1029</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email-&gt;email_id&nbsp;=&nbsp;(int)$row[&quot;email_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1030</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email-&gt;email&nbsp;&nbsp;&nbsp;=&nbsp;$row[&quot;email&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1031</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email-&gt;is_primary&nbsp;&nbsp;&nbsp;=&nbsp;(int)$row[&quot;is_primary&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1032</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_email-&gt;status&nbsp;&nbsp;=&nbsp;(int)$row[&quot;confirmed&quot;]&nbsp;?&nbsp;&quot;confirmed&quot;:&nbsp;&quot;pending&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1033</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;email_accounts[]&nbsp;=&nbsp;$i_email;</span></code></td></tr><tr><td class="coverageDetails"><span>1034</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1035</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_phone&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1036</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_all($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1037</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($result&nbsp;as&nbsp;$row)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1038</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_phone&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1039</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_phone-&gt;phone&nbsp;&nbsp;&nbsp;=&nbsp;(int)$row[&quot;phone&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1040</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_phone-&gt;status&nbsp;&nbsp;=&nbsp;(int)$row[&quot;confirmed&quot;]&nbsp;?&nbsp;&quot;confirmed&quot;:&nbsp;&quot;pending&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1041</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;phone_numbers[]&nbsp;=&nbsp;$i_phone;</span></code></td></tr><tr><td class="coverageDetails"><span>1042</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1043</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1044</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$user;</span></code></td></tr><tr><td class="coverageDetails"><span>1045</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1046</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1047</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1048</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_email_code($confirmation_code,&nbsp;$asset_id_confirmed_for&nbsp;=&nbsp;NULL)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1049</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($confirmation_code))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1050</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>1051</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1052</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1053</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_confirmation_code&nbsp;=&nbsp;$conn-&gt;escape($confirmation_code);</span></code></td></tr><tr><td class="coverageDetails"><span>1054</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;code&nbsp;info</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1055</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;email_confirmation&nbsp;WHERE&nbsp;confirmation_code&nbsp;=&nbsp;$i_confirmation_code&nbsp;AND&nbsp;confirmation_time&nbsp;IS&nbsp;NULL&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1056</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($asset_id_confirmed_for))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1057</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_asset_id_confirmed_for&nbsp;=&nbsp;$conn-&gt;escape($asset_id_confirmed_for);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1058</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;$query.&quot;&nbsp;AND&nbsp;&nbsp;asset_id_confirmed_for&nbsp;=&nbsp;$i_asset_id_confirmed_for&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1059</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1060</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1061</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1062</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>1063</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1064</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$email_id&nbsp;=&nbsp;(int)$result[&quot;email_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>1065</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;email&nbsp;info&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1066</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;email_id&nbsp;=&nbsp;$email_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1067</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1068</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1069</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>1070</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1071</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;&nbsp;=&nbsp;new&nbsp;self($result[&quot;email&quot;],&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;&quot;confirmed&quot;,&nbsp;(int)$result[&quot;uvs_id&quot;]);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1072</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;email_id&nbsp;=&nbsp;$email_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1073</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$user;</span></code></td></tr><tr><td class="coverageDetails"><span>1074</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1075</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1076</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_sms_code($confirmation_code)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1077</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($confirmation_code))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1078</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>1079</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1080</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1081</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_confirmation_code&nbsp;=&nbsp;$conn-&gt;escape($confirmation_code);</span></code></td></tr><tr><td class="coverageDetails"><span>1082</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;code&nbsp;info</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1083</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;sms_confirmation&nbsp;WHERE&nbsp;confirmation_code&nbsp;=&nbsp;$i_confirmation_code&nbsp;AND&nbsp;confirmation_time&nbsp;IS&nbsp;NULL&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1084</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1085</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1086</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>1087</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1088</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$phone_id&nbsp;=&nbsp;(int)$result[&quot;phone_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>1089</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;email&nbsp;info</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1090</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_phone&nbsp;WHERE&nbsp;phone_id&nbsp;=&nbsp;$phone_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1091</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1092</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1093</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>1094</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1095</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;&nbsp;=&nbsp;new&nbsp;self(NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;(int)$result[&quot;phone&quot;],&nbsp;NULL,&nbsp;&quot;confirmed&quot;,&nbsp;(int)$result[&quot;uvs_id&quot;]);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1096</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;phone_id&nbsp;=&nbsp;$phone_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1097</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$user;</span></code></td></tr><tr><td class="coverageDetails"><span>1098</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1099</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1100</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;send_email_code($email_id,&nbsp;$email,&nbsp;$asset_id_confirmed_for&nbsp;=&nbsp;NULL,&nbsp;$code_only&nbsp;=&nbsp;FALSE)&nbsp;{&nbsp;//if&nbsp;$code_only&nbsp;is&nbsp;True,&nbsp;then&nbsp;just&nbsp;send&nbsp;the&nbsp;code&nbsp;instead&nbsp;of&nbsp;the&nbsp;link</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1101</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($email_id)&nbsp;||&nbsp;is_null($email))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1102</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>1103</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1104</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;1:&nbsp;generate&nbsp;code</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1105</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$code&nbsp;=&nbsp;self::gen_confirmation_code($email_id,&nbsp;$asset_id_confirmed_for);</span></code></td></tr><tr><td class="coverageDetails"><span>1106</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1107</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;2:&nbsp;send&nbsp;the&nbsp;request</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1108</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if($code_only)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>1109</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;subject</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1110</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$subject&nbsp;=&nbsp;'Confirmation&nbsp;Code&nbsp;for&nbsp;Your&nbsp;Usher&nbsp;Account';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1111</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$message&nbsp;=&nbsp;'Please&nbsp;use&nbsp;this&nbsp;code&nbsp;to&nbsp;confirm&nbsp;your&nbsp;action:';</span></code></td></tr><tr><td class="coverageDetails"><span>1112</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;message</span></code></td></tr><tr><td class="coverageDetails"><span>1113</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*$message&nbsp;=&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span>1114</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;html&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1115</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1116</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;Confirmation&nbsp;Code&nbsp;for&nbsp;Your&nbsp;Usher&nbsp;Account&lt;/title&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1117</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1118</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1119</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Please&nbsp;use&nbsp;this&nbsp;code&nbsp;to&nbsp;confirm&nbsp;your&nbsp;action:&lt;/p&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1120</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;'.$code.'&lt;/p&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1121</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1122</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/html&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1123</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';*/</span></code></td></tr><tr><td class="coverageDetails"><span>1124</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>1125</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;subject</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1126</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$subject&nbsp;=&nbsp;'Activate&nbsp;your&nbsp;Usher&nbsp;Account';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1127</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($_SERVER['HTTPS']))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1128</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url&nbsp;=&nbsp;&quot;https://&quot;.$_SERVER[&quot;HTTP_HOST&quot;].&quot;/ConfirmEmail.php?code=&quot;.$code;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1129</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1130</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url&nbsp;=&nbsp;&quot;http://&quot;.$_SERVER[&quot;HTTP_HOST&quot;].&quot;/ConfirmEmail.php?code=&quot;.$code;</span></code></td></tr><tr><td class="coverageDetails"><span>1131</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1132</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$message&nbsp;=&nbsp;'Visit&nbsp;this&nbsp;URL&nbsp;to&nbsp;activate&nbsp;your&nbsp;account:'&nbsp;.&nbsp;$url;</span></code></td></tr><tr><td class="coverageDetails"><span>1133</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;message</span></code></td></tr><tr><td class="coverageDetails"><span>1134</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*$message&nbsp;=&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span>1135</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;html&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1136</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1137</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;Activate&nbsp;your&nbsp;Usher&nbsp;Account&lt;/title&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1138</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1139</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1140</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Your&nbsp;account&nbsp;has&nbsp;been&nbsp;created!&lt;/p&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1141</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Visit&nbsp;this&nbsp;URL&nbsp;to&nbsp;activate&nbsp;your&nbsp;account:&lt;/p&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1142</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;'.$url.'&lt;/p&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1143</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1144</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/html&gt;</span></code></td></tr><tr><td class="coverageDetails"><span>1145</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';*/</span></code></td></tr><tr><td class="coverageDetails"><span>1146</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1147</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;To&nbsp;send&nbsp;HTML&nbsp;mail,&nbsp;the&nbsp;Content-type&nbsp;header&nbsp;must&nbsp;be&nbsp;set</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1148</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;&nbsp;=&nbsp;'MIME-Version:&nbsp;1.0'&nbsp;.&nbsp;&quot;\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1149</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;.=&nbsp;'Content-type:&nbsp;text/html;&nbsp;charset=iso-8859-1'&nbsp;.&nbsp;&quot;\n&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1150</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;.=&nbsp;'From:&nbsp;usher.com&nbsp;&lt;noreply@usher.com&gt;'&nbsp;.&nbsp;&quot;\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1151</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//$headers&nbsp;.=&nbsp;'Bcc:&nbsp;birthdaycheck@example.com'&nbsp;.&nbsp;&quot;\r\n&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1152</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Mail&nbsp;it</span></code></td></tr><tr><td class="coverageDetails"><span>1153</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//$is_success&nbsp;=&nbsp;mail($email,&nbsp;$subject,&nbsp;$message,&nbsp;$headers);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1154</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$message&nbsp;=&nbsp;'Please&nbsp;use&nbsp;this&nbsp;code&nbsp;to&nbsp;confirm&nbsp;your&nbsp;action:';</span></code></td></tr><tr><td class="coverageDetails"><span>1155</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//$message&nbsp;=&nbsp;'Usher&nbsp;received&nbsp;a&nbsp;request&nbsp;to&nbsp;reset&nbsp;the&nbsp;password&nbsp;for&nbsp;your&nbsp;account.&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;reset&nbsp;your&nbsp;password,&nbsp;click&nbsp;on&nbsp;the&nbsp;link&nbsp;below&nbsp;(or&nbsp;copy&nbsp;and&nbsp;paste&nbsp;the&nbsp;URL&nbsp;into&nbsp;your&nbsp;browser)';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1156</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$is_success&nbsp;=&nbsp;Util::mail_code($email,&nbsp;$subject,&nbsp;$message,&nbsp;$code,&nbsp;$headers);</span></code></td></tr><tr><td class="coverageDetails"><span>1157</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1158</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;3:&nbsp;write&nbsp;to&nbsp;DB</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1159</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1160</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$i_code&nbsp;=&nbsp;$conn-&gt;escape($code);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1161</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$i_asset_id_confirmed_for&nbsp;=&nbsp;$conn-&gt;escape($asset_id_confirmed_for);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1162</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;email_confirmation(email_id,&nbsp;asset_id_confirmed_for,&nbsp;confirmation_code,&nbsp;creation_time)&nbsp;VALUES&nbsp;($email_id,&nbsp;$i_asset_id_confirmed_for,&nbsp;$i_code,&nbsp;NOW())&quot;;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1163</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;self::update($conn,&nbsp;$query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1164</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$is_success;</span></code></td></tr><tr><td class="coverageDetails"><span>1165</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1166</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1167</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;protected&nbsp;static&nbsp;function&nbsp;gen_confirmation_code($email_id,&nbsp;$asset_id_confirmed_for&nbsp;=&nbsp;NULL)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1168</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1169</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;escape($email_id);</span></code></td></tr><tr><td class="coverageDetails"><span>1170</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;email_confirmation&nbsp;WHERE&nbsp;email_id=$email_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1171</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//$row&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span>1172</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//if&nbsp;($row)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1173</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;email_confirmation&nbsp;WHERE&nbsp;email_id=$email_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1174</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($asset_id_confirmed_for)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1175</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_asset_id_confirmed_for&nbsp;=&nbsp;$conn-&gt;escape($asset_id_confirmed_for);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1176</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;$query.&quot;&nbsp;AND&nbsp;&nbsp;asset_id_confirmed_for&nbsp;=&nbsp;$i_asset_id_confirmed_for&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1177</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1178</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>1179</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1180</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1181</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$code&nbsp;=&nbsp;Util::gen_random('n',&nbsp;EMAIL_CONFIRMATION_CODE_LENGTH);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1182</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;while(self::find_by_email_code($code));</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1183</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$code;</span></code></td></tr><tr><td class="coverageDetails"><span>1184</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1185</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1186</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;send_sms_code($phone_id,&nbsp;$phone)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1187</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($phone_id)&nbsp;||&nbsp;is_null($phone))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1188</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>1189</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1190</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;1:&nbsp;generate&nbsp;code</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1191</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1192</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$code&nbsp;=&nbsp;Util::gen_random('n',&nbsp;SMS_CONFIRMATION_CODE_LENGTH);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1193</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}while(&nbsp;self::find_by_sms_code($code)&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span>1194</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1195</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;2:&nbsp;send&nbsp;the&nbsp;request</span></code></td></tr><tr><td class="coverageDetails"><span>1196</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//file_put_contents(&quot;/tmp/sms_confirmation_code.usher&quot;,&nbsp;$code);&nbsp;//just&nbsp;for&nbsp;test</span></code></td></tr><tr><td class="coverageDetails"><span>1197</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1198</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//step&nbsp;3:&nbsp;write&nbsp;to&nbsp;DB</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1199</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1200</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$i_code&nbsp;=&nbsp;$conn-&gt;escape($code);&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1201</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;sms_confirmation(phone_id,&nbsp;confirmation_code,&nbsp;creation_time)&nbsp;VALUES&nbsp;($phone_id,&nbsp;$i_code,&nbsp;NOW())&quot;;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1202</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;self::update($conn,&nbsp;$query);&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1203</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1204</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1205</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;send_signup_invitation($email)&nbsp;{&nbsp;&nbsp;//will&nbsp;support&nbsp;phone&nbsp;later</span></code></td></tr><tr><td class="coverageDetails"><span>1206</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//send&nbsp;the&nbsp;link&nbsp;to&nbsp;the&nbsp;email&nbsp;addrees</span></code></td></tr><tr><td class="coverageDetails"><span>1207</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;message</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1208</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$subject&nbsp;=&nbsp;'Usher&nbsp;Sign&nbsp;up';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1209</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$message&nbsp;=&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+1210</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;html&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+1211</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+1212</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;'.$subject.'&lt;/title&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+1213</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+1214</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+1215</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;You&nbsp;are&nbsp;shared&nbsp;a&nbsp;document.&nbsp;Please&nbsp;click&nbsp;on&nbsp;the&nbsp;link&nbsp;below&nbsp;to&nbsp;download&nbsp;Usher&nbsp;and&nbsp;sign&nbsp;up:&lt;/p&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+1216</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;http://www.usher.com/&lt;/p&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+1217</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+1218</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/html&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+1219</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';</span></code></td></tr><tr><td class="coverageDetails"><span>1220</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;To&nbsp;send&nbsp;HTML&nbsp;mail,&nbsp;the&nbsp;Content-type&nbsp;header&nbsp;must&nbsp;be&nbsp;set</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1221</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;&nbsp;=&nbsp;'MIME-Version:&nbsp;1.0'&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1222</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;.=&nbsp;'Content-type:&nbsp;text/html;&nbsp;charset=iso-8859-1'&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1223</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;.=&nbsp;'From:&nbsp;usher.com&nbsp;&lt;noreply@usher.com&gt;'&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1224</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Mail&nbsp;it</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1225</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;mail($email,&nbsp;$subject,&nbsp;$message,&nbsp;$headers);</span></code></td></tr><tr><td class="coverageDetails"><span>1226</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1227</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1228</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;uvs_token_generator()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1229</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1230</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$token&nbsp;=&nbsp;Util::gen_random('s',&nbsp;UVS_TOKEN_LENGTH);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1231</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}while(&nbsp;self::find_by_uvs_token($token)&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span>1232</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1233</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$token;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1234</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1235</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1236</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;store_db_image($uvs_id,&nbsp;$image_type,&nbsp;$dest)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>1237</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!copy($temp_file_path,&nbsp;$dest))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>1238</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>1239</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1240</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1241</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1242</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(substr($dest,&nbsp;0,&nbsp;4)&nbsp;!=&nbsp;'http')&nbsp;$dest&nbsp;=&nbsp;'/'.$dest;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1243</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_dest&nbsp;=&nbsp;$conn-&gt;escape($dest);&nbsp;//add&nbsp;'/'&nbsp;before&nbsp;relative&nbsp;path</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1244</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_image&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1245</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1246</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1247</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($image_type&nbsp;==&nbsp;'profile')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1248</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_image&nbsp;SET&nbsp;profile_photo_url&nbsp;=&nbsp;$i_dest&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1249</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;($image_type&nbsp;==&nbsp;'initials')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1250</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_image&nbsp;SET&nbsp;initials_url&nbsp;=&nbsp;$i_dest&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1251</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;($image_type&nbsp;==&nbsp;'signature')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1252</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_image&nbsp;SET&nbsp;signature_url&nbsp;=&nbsp;$i_dest&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1253</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;($image_type&nbsp;==&nbsp;'facebook')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1254</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_image&nbsp;SET&nbsp;facebook_photo_url&nbsp;=&nbsp;$i_dest&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1255</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1256</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1257</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($image_type&nbsp;==&nbsp;'profile')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1258</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;account_image(uvs_id,&nbsp;profile_photo_url)&nbsp;VALUES&nbsp;($uvs_id,&nbsp;$i_dest)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1259</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;($image_type&nbsp;==&nbsp;'initials')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1260</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;account_image(uvs_id,&nbsp;initials_url)&nbsp;VALUES&nbsp;($uvs_id,&nbsp;$i_dest)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1261</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;($image_type&nbsp;==&nbsp;'signature')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1262</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;account_image(uvs_id,&nbsp;signature_url)&nbsp;VALUES&nbsp;($uvs_id,&nbsp;$i_dest)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1263</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;($image_type&nbsp;==&nbsp;'facebook')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1264</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;account_image(uvs_id,&nbsp;facebook_photo_url)&nbsp;VALUES&nbsp;($uvs_id,&nbsp;$i_dest)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1265</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1266</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1267</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1268</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>1269</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1270</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1271</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;store_image($uvs_id,&nbsp;$image_type,&nbsp;$temp_file_path,&nbsp;$dest)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1272</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$file_name&nbsp;=&nbsp;end(explode(&quot;/&quot;,&nbsp;$dest));</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1273</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$absolute_dest&nbsp;=&nbsp;Util::get_general_config(&quot;uvs_file_path&quot;)&nbsp;.&nbsp;$file_name;</span></code></td></tr><tr><td class="coverageDetails"><span>1274</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1275</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//encrypt&nbsp;initials&nbsp;and&nbsp;signature&nbsp;image</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1276</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($image_type&nbsp;==&nbsp;'initials'&nbsp;||&nbsp;$image_type&nbsp;==&nbsp;'signature')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1277</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data&nbsp;=&nbsp;file_get_contents($temp_file_path);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1278</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$encrypted_data&nbsp;=&nbsp;Util::encrypt_data($data);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1279</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$encrypted_data)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1280</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1281</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1282</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(file_put_contents($absolute_dest,&nbsp;$encrypted_data)&nbsp;===&nbsp;false)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1283</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1284</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1285</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>1286</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//profile&nbsp;,do&nbsp;not&nbsp;encrypt</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1287</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!move_uploaded_file($temp_file_path,&nbsp;$absolute_dest))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1288</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1289</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1290</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1291</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;self::store_db_image($uvs_id,&nbsp;$image_type,&nbsp;$dest);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1292</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>1293</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1294</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1295</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;store_encrypted_image($uvs_id,&nbsp;$image_type,&nbsp;$temp_file_path,&nbsp;$dest)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1296</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$file_name&nbsp;=&nbsp;end(explode(&quot;/&quot;,&nbsp;$dest));</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1297</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$absolute_dest&nbsp;=&nbsp;Util::get_general_config(&quot;uvs_file_path&quot;)&nbsp;.&nbsp;$file_name;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1298</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!move_uploaded_file($temp_file_path,&nbsp;$absolute_dest))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1299</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1300</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1301</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;self::store_db_image($uvs_id,&nbsp;$image_type,&nbsp;$dest);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1302</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>1303</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1304</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1305</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;set_uvs_token($conn,&nbsp;$application_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1306</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($conn)&nbsp;||&nbsp;is_null($application_id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1307</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>1308</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1309</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;$this-&gt;uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1310</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;application_id&nbsp;=&nbsp;$application_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1311</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;uvs_token&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&nbsp;AND&nbsp;application_id&nbsp;=&nbsp;$application_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1312</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1313</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>1314</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;save&nbsp;original&nbsp;codes&nbsp;in&nbsp;case</span></code></td></tr><tr><td class="coverageDetails"><span>1315</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;strtotime($result[&quot;expires&quot;])&nbsp;&gt;&nbsp;time()&nbsp;+&nbsp;86400&nbsp;)&nbsp;{&nbsp;//will&nbsp;not&nbsp;expire&nbsp;in&nbsp;1&nbsp;day</span></code></td></tr><tr><td class="coverageDetails"><span>1316</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;uvs_access_token&nbsp;&nbsp;=&nbsp;$result[&quot;uvs_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>1317</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;//token&nbsp;out-of-date&nbsp;(soon)</span></code></td></tr><tr><td class="coverageDetails"><span>1318</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;&nbsp;&nbsp;=&nbsp;self::uvs_token_generator();</span></code></td></tr><tr><td class="coverageDetails"><span>1319</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_uvs_access_token&nbsp;=&nbsp;$conn-&gt;escape($uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span>1320</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$token_id&nbsp;&nbsp;=&nbsp;(int)$result[&quot;token_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>1321</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;uvs_token&nbsp;SET&nbsp;uvs_token&nbsp;=&nbsp;$i_uvs_access_token,&nbsp;expires&nbsp;=&nbsp;NOW()+&quot;.UVS_TOKEN_EXPIRATION.&quot;,&nbsp;update_time&nbsp;=&nbsp;NOW()&nbsp;WHERE&nbsp;token_id&nbsp;=&nbsp;$token_id&quot;;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1322</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::update($conn,&nbsp;$query);</span></code></td></tr><tr><td class="coverageDetails"><span>1323</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;uvs_access_token&nbsp;=&nbsp;$uvs_access_token;</span></code></td></tr><tr><td class="coverageDetails"><span>1324</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1325</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**/</span></code></td></tr><tr><td class="coverageDetails"><span>1326</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//replaced&nbsp;begin,&nbsp;enlarge&nbsp;expiration&nbsp;time&nbsp;when&nbsp;login</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1327</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;strtotime($result[&quot;expires&quot;])&nbsp;&gt;&nbsp;time()&nbsp;+&nbsp;86400&nbsp;)&nbsp;{//will&nbsp;not&nbsp;expire&nbsp;in&nbsp;1&nbsp;day,&nbsp;change&nbsp;token</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1328</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;&nbsp;=&nbsp;$result[&quot;uvs_token&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span>1329</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;//token&nbsp;out-of-date&nbsp;(soon),&nbsp;keep&nbsp;token</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1330</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;&nbsp;&nbsp;=&nbsp;self::uvs_token_generator();</span></code></td></tr><tr><td class="coverageDetails"><span>1331</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1332</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_uvs_access_token&nbsp;=&nbsp;$conn-&gt;escape($uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1333</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$token_id&nbsp;&nbsp;=&nbsp;(int)$result[&quot;token_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1334</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;uvs_token&nbsp;SET&nbsp;uvs_token&nbsp;=&nbsp;$i_uvs_access_token,&nbsp;expires&nbsp;=&nbsp;NOW()+&quot;.UVS_TOKEN_EXPIRATION.&quot;,&nbsp;update_time&nbsp;=&nbsp;NOW()&nbsp;WHERE&nbsp;token_id&nbsp;=&nbsp;$token_id&quot;;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1335</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::update($conn,&nbsp;$query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1336</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;uvs_access_token&nbsp;=&nbsp;$uvs_access_token;</span></code></td></tr><tr><td class="coverageDetails"><span>1337</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//end</span></code></td></tr><tr><td class="coverageDetails"><span>1338</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>1339</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//first&nbsp;time&nbsp;login,&nbsp;create&nbsp;a&nbsp;new&nbsp;record&nbsp;in&nbsp;`token`&nbsp;(will&nbsp;add&nbsp;logic&nbsp;for&nbsp;uvs_token&nbsp;expires&nbsp;later)</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1340</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_access_token&nbsp;=&nbsp;self::uvs_token_generator();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1341</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_uvs_access_token&nbsp;=&nbsp;$conn-&gt;escape($uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1342</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;uvs_token(application_id,&nbsp;uvs_id,&nbsp;uvs_token,&nbsp;expires,&nbsp;update_time)&nbsp;VALUES&nbsp;($application_id,&nbsp;$uvs_id,&nbsp;$i_uvs_access_token,&nbsp;NOW()+&quot;.UVS_TOKEN_EXPIRATION.&quot;,&nbsp;NOW())&quot;;&nbsp;//&amp;&nbsp;application_id&nbsp;=&nbsp;...</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1343</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::update($conn,&nbsp;$query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1344</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;uvs_access_token&nbsp;=&nbsp;$uvs_access_token;</span></code></td></tr><tr><td class="coverageDetails"><span>1345</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1346</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1347</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1348</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_uvs_id()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1349</span></td><td class="coverageDetails"><span class="codeExecuted">7</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span>1350</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1351</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1352</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_first_name()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1353</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;first_name;</span></code></td></tr><tr><td class="coverageDetails"><span>1354</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1355</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1356</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_last_name()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1357</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;last_name;</span></code></td></tr><tr><td class="coverageDetails"><span>1358</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1359</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1360</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;set_name($first_name,&nbsp;$last_name)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1361</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;first_name&nbsp;=&nbsp;$first_name;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1362</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;last_name&nbsp;=&nbsp;$last_name;</span></code></td></tr><tr><td class="coverageDetails"><span>1363</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1364</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1365</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_fb_id()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1366</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;fb_id&nbsp;?&nbsp;$this-&gt;fb_id&nbsp;:&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>1367</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1368</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1369</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_fb_access_token()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1370</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;fb_access_token;</span></code></td></tr><tr><td class="coverageDetails"><span>1371</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1372</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1373</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_fb_token_expires()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1374</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;fb_token_expires;</span></code></td></tr><tr><td class="coverageDetails"><span>1375</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1376</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1377</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_uvs_access_token($device_uid=null)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1378</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$device_uid&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1379</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;uvs_access_token&nbsp;.&nbsp;&quot;_&quot;&nbsp;.&nbsp;$device_uid;</span></code></td></tr><tr><td class="coverageDetails"><span>1380</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1381</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;uvs_access_token;</span></code></td></tr><tr><td class="coverageDetails"><span>1382</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1383</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1384</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_uvs_token_expires()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1385</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;uvs_token_expires;</span></code></td></tr><tr><td class="coverageDetails"><span>1386</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1387</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1388</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_application_id()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1389</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;application_id;</span></code></td></tr><tr><td class="coverageDetails"><span>1390</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1391</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1392</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_email_accounts()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1393</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;email_accounts;</span></code></td></tr><tr><td class="coverageDetails"><span>1394</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1395</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1396</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_phone_numbers()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1397</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;phone_numbers;</span></code></td></tr><tr><td class="coverageDetails"><span>1398</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1399</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1400</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_email_id()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1401</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;email_id;</span></code></td></tr><tr><td class="coverageDetails"><span>1402</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1403</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>1404</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_phone_id()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1405</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;phone_id;</span></code></td></tr><tr><td class="coverageDetails"><span>1406</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1407</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1408</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_email()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1409</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;email;</span></code></td></tr><tr><td class="coverageDetails"><span>1410</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1411</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1412</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_phone()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1413</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;phone;</span></code></td></tr><tr><td class="coverageDetails"><span>1414</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1415</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1416</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_password()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1417</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;password;</span></code></td></tr><tr><td class="coverageDetails"><span>1418</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1419</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1420</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_profile_photo()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1421</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;profile_photo_url;</span></code></td></tr><tr><td class="coverageDetails"><span>1422</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1423</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1424</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;set_profile_photo($profile_photo_url)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1425</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;profile_photo_url&nbsp;=&nbsp;$profile_photo_url;</span></code></td></tr><tr><td class="coverageDetails"><span>1426</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1427</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1428</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_initials_img()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1429</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;initials_url;</span></code></td></tr><tr><td class="coverageDetails"><span>1430</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1431</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1432</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_signature_img()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1433</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;signature_url;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1434</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1435</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1436</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_basic_info()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1437</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$userinfo&nbsp;=&nbsp;json_encode&nbsp;(&nbsp;array(&quot;uvs_id&quot;&nbsp;=&gt;&nbsp;$this-&gt;uvs_id,&nbsp;&quot;first_name&quot;&nbsp;=&gt;&nbsp;$this-&gt;first_name,&nbsp;&quot;last_name&quot;&nbsp;=&gt;&nbsp;$this-&gt;last_name,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+1438</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;fb_id&quot;&nbsp;=&gt;&nbsp;$this-&gt;fb_id&nbsp;?&nbsp;$this-&gt;fb_id&nbsp;:&nbsp;NULL,&nbsp;&quot;profile_photo_url&quot;&nbsp;=&gt;&nbsp;$this-&gt;profile_photo_url,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+1439</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;initials_url&quot;&nbsp;=&gt;&nbsp;$this-&gt;initials_url,&nbsp;&quot;signature_url&quot;&nbsp;=&gt;&nbsp;$this-&gt;signature_url)</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+1440</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1441</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;json_decode($userinfo);</span></code></td></tr><tr><td class="coverageDetails"><span>1442</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1443</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1444</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_user_type()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1445</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;user_type;</span></code></td></tr><tr><td class="coverageDetails"><span>1446</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1447</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1448</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_primary_email(){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1449</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1450</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;$conn-&gt;escape($this-&gt;uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1451</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&nbsp;AND&nbsp;is_primary&nbsp;&nbsp;=&nbsp;1&quot;;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1452</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1453</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1454</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result['email'];</span></code></td></tr><tr><td class="coverageDetails"><span>1455</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1456</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>1457</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1458</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1459</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1460</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//&nbsp;maybe&nbsp;needed</span></code></td></tr><tr><td class="coverageDetails"><span>1461</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;is_emailid_existed($email_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1462</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1463</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_email_id&nbsp;=&nbsp;$conn-&gt;escape($email_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1464</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;email_id&nbsp;=&nbsp;$e_email_id&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1465</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1466</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1467</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>1468</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1469</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1470</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1471</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1472</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1473</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//&nbsp;include&nbsp;logic&nbsp;of&nbsp;is_emailid_existed</span></code></td></tr><tr><td class="coverageDetails"><span>1474</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;is_emailid_belong_to_user($email_id,&nbsp;$uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1475</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1476</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_email_id&nbsp;=&nbsp;$conn-&gt;escape($email_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1477</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;email_id&nbsp;=&nbsp;$e_email_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1478</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1479</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1480</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((int)$result['uvs_id']&nbsp;==&nbsp;$uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1481</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result['email'];</span></code></td></tr><tr><td class="coverageDetails"><span>1482</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1483</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1484</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1485</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1486</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>1487</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//&nbsp;include&nbsp;logic&nbsp;of&nbsp;is_emailid_existed</span></code></td></tr><tr><td class="coverageDetails"><span>1488</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;is_primary_email($email_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1489</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1490</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_email_id&nbsp;=&nbsp;$conn-&gt;escape($email_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1491</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;email_id&nbsp;=&nbsp;$e_email_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1492</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1493</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1494</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((int)$result['is_primary'])&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1495</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>1496</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1497</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1498</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1499</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1500</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1501</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//&nbsp;include&nbsp;logic&nbsp;of&nbsp;is_emailid_existed</span></code></td></tr><tr><td class="coverageDetails"><span>1502</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;is_confirmed_email($email_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1503</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1504</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_email_id&nbsp;=&nbsp;$conn-&gt;escape($email_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1505</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;email_id&nbsp;=&nbsp;$e_email_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1506</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1507</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1508</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((int)$result['confirmed'])&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1509</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>1510</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1511</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1512</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1513</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1514</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>1515</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;is_primary_email_set($uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1516</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1517</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account_email&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&nbsp;&nbsp;AND&nbsp;is_primary&nbsp;&nbsp;=&nbsp;1&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1518</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1519</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1520</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>1521</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1522</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1523</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1524</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1525</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;is_password_set($uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1526</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1527</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1528</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1529</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1530</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($result['password'])&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1531</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>1532</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1533</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1534</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1535</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1536</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1537</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;is_name_exist($uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1538</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;&nbsp;&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1539</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$e_uvs_id&nbsp;=&nbsp;$conn-&gt;escape($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1540</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;account&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$e_uvs_id&nbsp;AND&nbsp;first_name&nbsp;IS&nbsp;NOT&nbsp;NULL&nbsp;AND&nbsp;last_name&nbsp;IS&nbsp;NOT&nbsp;NULL&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1541</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1542</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($row)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1543</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>1544</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1545</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>1546</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1547</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1548</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1549</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;record_location($lon,&nbsp;$lat,&nbsp;$time&nbsp;=&nbsp;NULL)&nbsp;{&nbsp;&nbsp;//$time&nbsp;is&nbsp;UNIX&nbsp;timestamp</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1550</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1551</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_lon&nbsp;=&nbsp;$conn-&gt;escape($lon);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1552</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_lat&nbsp;=&nbsp;$conn-&gt;escape($lat);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1553</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_uvs_id&nbsp;=&nbsp;$conn-&gt;escape($this-&gt;uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1554</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($time)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1555</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;usher_location(uvs_id,&nbsp;longitude,&nbsp;latitude,&nbsp;time)&nbsp;VALUES&nbsp;($e_uvs_id,&nbsp;$e_lon,&nbsp;$e_lat,&nbsp;FROM_UNIXTIME($time))&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1556</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1557</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;usher_location(uvs_id,&nbsp;longitude,&nbsp;latitude,&nbsp;time)&nbsp;VALUES&nbsp;($e_uvs_id,&nbsp;$e_lon,&nbsp;$e_lat,&nbsp;NOW())&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1558</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1559</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;self::update($conn,&nbsp;$query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1560</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$ret&nbsp;=&nbsp;$conn-&gt;last_insert_id();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1561</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($ret&nbsp;==&nbsp;0&nbsp;or&nbsp;$ret&nbsp;==&nbsp;FALSE)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1562</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1563</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1564</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>1565</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1566</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1567</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1568</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;hasBadge($badgeid)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1569</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1570</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_badgeid&nbsp;=&nbsp;$conn-&gt;escape($badgeid);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1571</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;uvs_id&nbsp;FROM&nbsp;badge&nbsp;WHERE&nbsp;badgeid=$e_badgeid&nbsp;AND&nbsp;status='active'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1572</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$row&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1573</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($row)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1574</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($this-&gt;uvs_id)&nbsp;&amp;&amp;&nbsp;(int)$row['uvs_id']&nbsp;==&nbsp;$this-&gt;uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1575</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>1576</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1577</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1578</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1579</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1580</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1581</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1582</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1583</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1584</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;punch_in($badgeid,&nbsp;$lon,&nbsp;$lat)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1585</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1586</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_badgeid&nbsp;=&nbsp;$conn-&gt;escape($badgeid);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1587</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_lon&nbsp;=&nbsp;$conn-&gt;escape($lon);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1588</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_lat&nbsp;=&nbsp;$conn-&gt;escape($lat);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1589</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;badge_punch&nbsp;VALUES&nbsp;(null,&nbsp;$e_badgeid,&nbsp;'in',&nbsp;$e_lon,&nbsp;$e_lat,&nbsp;NOW())&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1590</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;self::update($conn,&nbsp;$query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1591</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$ret&nbsp;=&nbsp;$conn-&gt;last_insert_id();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1592</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($ret&nbsp;==&nbsp;0&nbsp;or&nbsp;$ret&nbsp;==&nbsp;FALSE)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1593</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1594</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1595</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>1596</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1597</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1598</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1599</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;punch_out($badgeid,&nbsp;$lon,&nbsp;$lat)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1600</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1601</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_badgeid&nbsp;=&nbsp;$conn-&gt;escape($badgeid);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1602</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_lon&nbsp;=&nbsp;$conn-&gt;escape($lon);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1603</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_lat&nbsp;=&nbsp;$conn-&gt;escape($lat);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1604</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;badge_punch&nbsp;VALUES&nbsp;(null,&nbsp;$e_badgeid,&nbsp;'out',&nbsp;$e_lon,&nbsp;$e_lat,&nbsp;NOW())&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1605</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;self::update($conn,&nbsp;$query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1606</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$ret&nbsp;=&nbsp;$conn-&gt;last_insert_id();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1607</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($ret&nbsp;==&nbsp;0&nbsp;or&nbsp;$ret&nbsp;==&nbsp;FALSE)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1608</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;</span></code></td></tr><tr><td class="coverageDetails"><span>1609</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1610</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>1611</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1612</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1613</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1614</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_punch_status($badgeid)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1615</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1616</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_badgeid&nbsp;=&nbsp;$conn-&gt;escape($badgeid);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1617</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;badge_punch&nbsp;WHERE&nbsp;badgeid&nbsp;=&nbsp;$e_badgeid&nbsp;ORDER&nbsp;BY&nbsp;id&nbsp;DESC&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1618</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$row&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1619</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($row)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1620</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$row['action'];</span></code></td></tr><tr><td class="coverageDetails"><span>1621</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1622</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;'out';</span></code></td></tr><tr><td class="coverageDetails"><span>1623</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1624</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1625</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1626</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_events($uvs_id,&nbsp;$last_eid,&nbsp;$num_events,&nbsp;$event_types&nbsp;=&nbsp;null)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1627</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>1628</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1629</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_uvs_id&nbsp;=&nbsp;$conn-&gt;escape($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1630</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_last_eid&nbsp;=&nbsp;$conn-&gt;escape($last_eid);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1631</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_num_events&nbsp;=&nbsp;$conn-&gt;escape($num_events);</span></code></td></tr><tr><td class="coverageDetails"><span>1632</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1633</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;event_id,&nbsp;event_type,&nbsp;uvs_id,&nbsp;UNIX_TIMESTAMP(create_time)&nbsp;AS&nbsp;create_time,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+1634</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;highlight,&nbsp;parameters,&nbsp;event_icon&nbsp;from&nbsp;active_log&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$e_uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1635</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query_count&nbsp;=&nbsp;&quot;select&nbsp;ifnull(count(event_id),0)&nbsp;as&nbsp;num_acount&nbsp;from&nbsp;active_log&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$e_uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1636</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(isset($event_types)){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1637</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$escape_event_types&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1638</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($event_types&nbsp;as&nbsp;$event_type){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1639</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$escape_event_types[]&nbsp;=&nbsp;$conn-&gt;escape($event_type);</span></code></td></tr><tr><td class="coverageDetails"><span>1640</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1641</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql_where&nbsp;=&nbsp;implode(',',&nbsp;$escape_event_types);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1642</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;$query&nbsp;.&nbsp;&quot;&nbsp;AND&nbsp;event_type&nbsp;in&nbsp;($sql_where)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1643</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1644</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($last_eid&gt;0){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1645</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;$query&nbsp;.&nbsp;&quot;&nbsp;AND&nbsp;event_id&nbsp;&lt;&nbsp;$last_eid&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1646</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query_count&nbsp;=&nbsp;$query_count&nbsp;.&nbsp;&quot;&nbsp;AND&nbsp;event_id&nbsp;&lt;&nbsp;$last_eid&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1647</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1648</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;$query.&nbsp;&quot;&nbsp;&nbsp;order&nbsp;by&nbsp;event_id&nbsp;desc&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1649</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($num_events&nbsp;&gt;&nbsp;0)</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1650</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;$query.&nbsp;&quot;&nbsp;limit&nbsp;$num_events&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1651</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1652</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$events&nbsp;=&nbsp;$conn-&gt;select_all($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1653</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($events&nbsp;as&nbsp;&amp;$row){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1654</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row['event_id']&nbsp;=&nbsp;(int)$row['event_id'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1655</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row['uvs_id']&nbsp;=&nbsp;(int)$row['uvs_id'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1656</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row['create_time']&nbsp;=&nbsp;(int)$row['create_time'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1657</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row['highlight']&nbsp;=&nbsp;(int)$row['highlight'];</span></code></td></tr><tr><td class="coverageDetails"><span>1658</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1659</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1660</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result_count&nbsp;=&nbsp;$conn-&gt;select_first($query_count);</span></code></td></tr><tr><td class="coverageDetails"><span>1661</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>1662</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//If&nbsp;is&nbsp;the&nbsp;last&nbsp;data</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1663</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if((int)$result_count[&quot;num_acount&quot;]&nbsp;==&nbsp;0&nbsp;||&nbsp;(int)$result_count[&quot;num_acount&quot;]&nbsp;&lt;=&nbsp;$num_events&nbsp;||&nbsp;$num_events&lt;=0){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1664</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$none_data&nbsp;=&nbsp;array();//new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1665</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$none_data[&quot;event_id&quot;]&nbsp;=&nbsp;&nbsp;-1;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1666</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$none_data[&quot;event_type&quot;]&nbsp;=&nbsp;&nbsp;&quot;&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1667</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$none_data[&quot;uvs_id&quot;]&nbsp;=&nbsp;&nbsp;0;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1668</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$none_data[&quot;create_time&quot;]&nbsp;=&nbsp;0;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1669</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$none_data[&quot;highlight&quot;]&nbsp;=&nbsp;0;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1670</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$none_data[&quot;parameters&quot;]&nbsp;=&nbsp;&nbsp;null;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1671</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$none_data[&quot;event_icon&quot;]&nbsp;=&nbsp;&nbsp;&quot;&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1672</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$events[]&nbsp;=&nbsp;$none_data;</span></code></td></tr><tr><td class="coverageDetails"><span>1673</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1674</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$events;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1675</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1676</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1677</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;delete_events($uvs_id,&nbsp;$last_eid)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1678</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>1679</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1680</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_uvs_id&nbsp;=&nbsp;$conn-&gt;escape($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1681</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_last_eid&nbsp;=&nbsp;$conn-&gt;escape($last_eid);</span></code></td></tr><tr><td class="coverageDetails"><span>1682</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1683</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;active_log&nbsp;where&nbsp;uvs_id&nbsp;=&nbsp;$e_uvs_id&nbsp;AND&nbsp;event_id&nbsp;&lt;=&nbsp;$e_last_eid&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1684</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1685</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>1686</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1687</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(PDOException&nbsp;$e)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1688</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;$e;</span></code></td></tr><tr><td class="coverageDetails"><span>1689</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1690</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1691</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;SUCCESS&nbsp;*/</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1692</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;</span></code></td></tr><tr><td class="coverageDetails"><span>1693</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1694</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1695</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;mark_all_events_read($uvs_id,&nbsp;$last_eid)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1696</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>1697</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1698</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_uvs_id&nbsp;=&nbsp;$conn-&gt;escape($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1699</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_last_eid&nbsp;=&nbsp;$conn-&gt;escape($last_eid);</span></code></td></tr><tr><td class="coverageDetails"><span>1700</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1701</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;active_log&nbsp;SET&nbsp;highlight&nbsp;=&nbsp;1&nbsp;where&nbsp;uvs_id&nbsp;=&nbsp;$e_uvs_id&nbsp;AND&nbsp;event_id&nbsp;&lt;=&nbsp;$e_last_eid&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1702</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1703</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>1704</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1705</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(PDOException&nbsp;$e)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1706</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;$e;</span></code></td></tr><tr><td class="coverageDetails"><span>1707</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1708</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1709</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;SUCCESS&nbsp;*/</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1710</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;</span></code></td></tr><tr><td class="coverageDetails"><span>1711</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1712</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1713</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;mark_events_read($uvs_id,&nbsp;$eids)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1714</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>1715</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1716</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$e_uvs_id&nbsp;=&nbsp;$conn-&gt;escape($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span>1717</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1718</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($eids&nbsp;as&nbsp;$event_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1719</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$e_event_id&nbsp;=&nbsp;$conn-&gt;escape($event_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1720</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;active_log&nbsp;SET&nbsp;highlight&nbsp;=&nbsp;1&nbsp;where&nbsp;uvs_id&nbsp;=&nbsp;$e_uvs_id&nbsp;AND&nbsp;event_id&nbsp;=&nbsp;&nbsp;$e_event_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1721</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1722</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>1723</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1724</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(PDOException&nbsp;$e)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1725</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;$e;</span></code></td></tr><tr><td class="coverageDetails"><span>1726</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1727</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1728</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>1729</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;SUCCESS&nbsp;*/</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1730</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;</span></code></td></tr><tr><td class="coverageDetails"><span>1731</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1732</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1733</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;save_active_log($uvs_id,&nbsp;$email,&nbsp;$method,&nbsp;$from_email&nbsp;=&nbsp;null){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1734</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$active_logs&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1735</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;User::find_by_uvs_id($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1736</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params&nbsp;=&nbsp;self::assemble_active_log_params($email,&nbsp;$from_email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1737</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$active_log&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1738</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$active_log-&gt;event_type&nbsp;=&nbsp;$method;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1739</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$active_log-&gt;uvs_id&nbsp;=&nbsp;$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1740</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$active_log-&gt;parameters&nbsp;=&nbsp;$params;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1741</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$active_log-&gt;event_icon&nbsp;=&nbsp;$user-&gt;get_profile_photo();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1742</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$active_logs[]&nbsp;=&nbsp;$active_log;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1743</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User::add_active_logs($active_logs);</span></code></td></tr><tr><td class="coverageDetails"><span>1744</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1745</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1746</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;private&nbsp;static&nbsp;function&nbsp;assemble_active_log_params($email,&nbsp;$from_email&nbsp;=&nbsp;null){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1747</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$log&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1748</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1749</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;name&nbsp;=&nbsp;&quot;email&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;$email;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$log[]&nbsp;=&nbsp;$element;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1750</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($from_email)){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1751</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1752</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;name&nbsp;=&nbsp;&quot;from_email&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;$from_email;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$log[]&nbsp;=&nbsp;$element;</span></code></td></tr><tr><td class="coverageDetails"><span>1753</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1754</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1755</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;name&nbsp;=&nbsp;&quot;datetime&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;time();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$log[]&nbsp;=&nbsp;$element;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1756</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;json_encode($log);</span></code></td></tr><tr><td class="coverageDetails"><span>1757</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1758</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>1759</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//Event_TYPE</span></code></td></tr><tr><td class="coverageDetails"><span>1760</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;add_active_logs($events)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1761</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1762</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($events&nbsp;as&nbsp;$event){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1763</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::add_active_log($event,&nbsp;$conn);</span></code></td></tr><tr><td class="coverageDetails"><span>1764</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1765</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1766</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1767</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//Event_TYPE</span></code></td></tr><tr><td class="coverageDetails"><span>1768</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;add_active_log($event,&nbsp;$conn)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1769</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;&nbsp;&nbsp;!isset($event-&gt;event_type)&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+1770</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;!isset($event-&gt;uvs_id)&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+1771</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;!isset($event-&gt;parameters))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>1772</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;ERROR&nbsp;*/</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1773</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></code></td></tr><tr><td class="coverageDetails"><span>1774</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1775</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if(!isset(Activelog::$ARRAY_EVENT_TYPE_HIGHLIGHT[$event-&gt;event_type]))</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1776</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1777</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($conn))</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1778</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>1779</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1780</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$e_event_type&nbsp;=&nbsp;$conn-&gt;escape($event-&gt;event_type);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1781</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$e_uvs_id&nbsp;=&nbsp;$conn-&gt;escape($event-&gt;uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1782</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$e_parameters&nbsp;=&nbsp;$conn-&gt;escape($event-&gt;parameters);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1783</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$e_highlight&nbsp;=&nbsp;$conn-&gt;escape(Activelog::$ARRAY_EVENT_TYPE_HIGHLIGHT[$event-&gt;event_type]);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1784</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$e_event_icon&nbsp;=&nbsp;$conn-&gt;escape($event-&gt;event_icon);</span></code></td></tr><tr><td class="coverageDetails"><span>1785</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1786</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;active_log&nbsp;VALUES(DEFAULT,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+1787</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$e_event_type,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+1788</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFAULT,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+1789</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$e_highlight,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+1790</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$e_parameters,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+1791</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$e_uvs_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+1792</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$e_event_icon&nbsp;)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1793</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1794</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1795</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>1796</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1797</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(PDOException&nbsp;$e)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1798</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;$e;</span></code></td></tr><tr><td class="coverageDetails"><span>1799</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1800</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>1801</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//Note:&nbsp;will&nbsp;not&nbsp;triger&nbsp;badge&nbsp;count&nbsp;here,&nbsp;maybe&nbsp;performance&nbsp;problem</span></code></td></tr><tr><td class="coverageDetails"><span>1802</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(Activelog::$HIGNLIGHT&nbsp;==&nbsp;$e_highlight){</span></code></td></tr><tr><td class="coverageDetails"><span>1803</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>1804</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;select&nbsp;count(*)&nbsp;as&nbsp;HL&nbsp;from&nbsp;uvs_validationserver.active_log&nbsp;where&nbsp;highlight&nbsp;=&nbsp;$e_highlight&nbsp;and&nbsp;uvs_id&nbsp;=&nbsp;$e_uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1805</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span>1806</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$count&nbsp;=&nbsp;$result['HL'];</span></code></td></tr><tr><td class="coverageDetails"><span>1807</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$notification&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span>1808</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$notification-&gt;type&nbsp;=&nbsp;'new_event';</span></code></td></tr><tr><td class="coverageDetails"><span>1809</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$notification-&gt;num&nbsp;=&nbsp;$count;</span></code></td></tr><tr><td class="coverageDetails"><span>1810</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NotificationSender::push_notification($e_uvs_id,&nbsp;$notification);</span></code></td></tr><tr><td class="coverageDetails"><span>1811</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1812</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1813</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;SUCCESS&nbsp;*/</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1814</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;</span></code></td></tr><tr><td class="coverageDetails"><span>1815</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1816</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1817</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1818</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;save_device_token($uid,&nbsp;$device_id,&nbsp;$device_type,&nbsp;$device_token){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1819</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uid&nbsp;=&nbsp;(int)$uid;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1820</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$device_type&nbsp;=&nbsp;(int)$device_type;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1821</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!isset($device_token))&nbsp;$device_token&nbsp;=&nbsp;'';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1822</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1823</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uid&nbsp;=&nbsp;$conn-&gt;escape($uid);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1824</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$device_id&nbsp;=&nbsp;$conn-&gt;escape($device_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1825</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$device_type&nbsp;=&nbsp;$conn-&gt;escape($device_type);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1826</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$device_token&nbsp;=&nbsp;$conn-&gt;escape($device_token);</span></code></td></tr><tr><td class="coverageDetails"><span>1827</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1828</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;REPLACE&nbsp;INTO&nbsp;device_token(uid,&nbsp;device_id,&nbsp;device_type,&nbsp;device_token,&nbsp;device_token_hash)&quot;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+1829</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;.&quot;&nbsp;VALUES&nbsp;($uid,&nbsp;$device_id,&nbsp;$device_type,&nbsp;$device_token,&nbsp;CONV(RIGHT(MD5($device_token),&nbsp;16),&nbsp;16,&nbsp;-10))&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1830</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;try{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1831</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query_result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1832</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(PDOException&nbsp;$e)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1833</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;$e;</span></code></td></tr><tr><td class="coverageDetails"><span>1834</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1835</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($query_result-&gt;num_affected_rows()&nbsp;&gt;&nbsp;0){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1836</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>1837</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1838</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>1839</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1840</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>1841</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1842</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1843</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;remove_device_token($uid,&nbsp;$device_id,&nbsp;$device_type){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1844</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uid&nbsp;=&nbsp;(int)$uid;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1845</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$device_type&nbsp;=&nbsp;(int)$device_type;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1846</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1847</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uid&nbsp;=&nbsp;$conn-&gt;escape($uid);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1848</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$device_id&nbsp;=&nbsp;$conn-&gt;escape($device_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1849</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$device_type&nbsp;=&nbsp;$conn-&gt;escape($device_type);</span></code></td></tr><tr><td class="coverageDetails"><span>1850</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1851</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;device_token&nbsp;WHERE&nbsp;uid&nbsp;=&nbsp;$uid&nbsp;AND&nbsp;device_id&nbsp;=&nbsp;$device_id&nbsp;AND&nbsp;device_type&nbsp;=&nbsp;$device_type&nbsp;&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1852</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;try{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1853</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query_result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1854</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}catch(PDOException&nbsp;$e)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1855</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;$e;</span></code></td></tr><tr><td class="coverageDetails"><span>1856</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1857</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1858</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($query_result-&gt;num_affected_rows()&nbsp;&gt;&nbsp;0){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1859</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>1860</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1861</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>1862</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1863</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1864</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1865</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//used&nbsp;by&nbsp;APNs&nbsp;feedback&nbsp;service&nbsp;only</span></code></td></tr><tr><td class="coverageDetails"><span>1866</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;remove_apns_tokens($token,&nbsp;$timestamp)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1867</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>1868</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$token&nbsp;=&nbsp;base64_encode($token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1869</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$token&nbsp;=&nbsp;$conn-&gt;escape($token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1870</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$timestamp&nbsp;=&nbsp;$conn-&gt;escape($timestamp);</span></code></td></tr><tr><td class="coverageDetails"><span>1871</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1872</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;device_token&nbsp;WHERE&nbsp;device_token_hash&nbsp;=&nbsp;CONV(RIGHT(MD5($token),&nbsp;16),&nbsp;16,&nbsp;10)&nbsp;AND&nbsp;device_token&nbsp;=&nbsp;$token&nbsp;AND&nbsp;device_type&nbsp;=&nbsp;1&nbsp;AND&nbsp;update_time&lt;FROM_UNIXTIME($timestamp)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1873</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;try{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1874</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query_result&nbsp;=&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1875</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}catch(PDOException&nbsp;$e)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1876</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;$e;</span></code></td></tr><tr><td class="coverageDetails"><span>1877</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1878</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1879</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($query_result-&gt;num_affected_rows()&nbsp;&gt;&nbsp;0){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1880</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>1881</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1882</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>1883</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1884</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>1885</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1886</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1887</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;validate_uvs_token($uvs_access_token)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>1888</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1889</span></td><td class="coverageDetails"><span class="codeExecuted">5</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$token_parts&nbsp;=&nbsp;explode(&quot;_&quot;,$uvs_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1890</span></td><td class="coverageDetails"><span class="codeExecuted">5</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;count($token_parts)&nbsp;==&nbsp;1)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1891</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1892</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;(count($token_parts)&nbsp;&gt;1&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>1893</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1894</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1895</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list($uvs_token,&nbsp;$device_uid)&nbsp;=&nbsp;$token_parts;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1896</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_token&nbsp;=&nbsp;$conn-&gt;escape($uvs_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1897</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device_uid&nbsp;=&nbsp;$conn-&gt;escape($device_uid);</span></code></td></tr><tr><td class="coverageDetails"><span>1898</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1899</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;from&nbsp;uvs_token&nbsp;t,&nbsp;user_device&nbsp;d&nbsp;WHERE&nbsp;t.uvs_token&nbsp;=&nbsp;$uvs_token&nbsp;&nbsp;AND&nbsp;t.expires&nbsp;&gt;&nbsp;NOW()&nbsp;AND</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+1900</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.uvs_id&nbsp;=&nbsp;d.uvs_id&nbsp;AND&nbsp;d.device_uid&nbsp;=&nbsp;$device_uid&nbsp;AND&nbsp;d.status&nbsp;=&nbsp;'active'&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1901</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1902</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!&nbsp;$result&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">1903</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerInvalidTokenException('Invalid&nbsp;uvs&nbsp;access&nbsp;token');</span></code></td></tr><tr><td class="coverageDetails"><span>1904</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1905</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1906</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1907</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1908</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;save_profile_photo_url($uvs_id,&nbsp;$photo_url){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1909</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1910</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;$conn-&gt;escape($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1911</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$photo_url&nbsp;=&nbsp;$conn-&gt;escape($photo_url);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1912</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;account_image(uvs_id,&nbsp;profile_photo_url)&nbsp;VALUES($uvs_id,&nbsp;$photo_url)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1913</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;try{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1914</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query_result&nbsp;=&nbsp;$conn-&gt;execute($sql);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1915</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}catch(PDODuplicateEntryException&nbsp;$e){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1916</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_image&nbsp;SET&nbsp;profile_photo_url=$photo_url&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1917</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query_result&nbsp;=&nbsp;$conn-&gt;execute($sql);</span></code></td></tr><tr><td class="coverageDetails"><span>1918</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1919</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}//end&nbsp;of&nbsp;save_profile_photo_url</span></code></td></tr><tr><td class="coverageDetails"><span>1920</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1921</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;add_update_org_token($orgid,&nbsp;$uvs_id,&nbsp;$org_access_token,&nbsp;$is_create){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1922</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1923</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;$conn-&gt;escape($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1924</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$orgid&nbsp;=&nbsp;$conn-&gt;escape($orgid);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1925</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$org_access_token&nbsp;=&nbsp;$conn-&gt;escape($org_access_token);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1926</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1927</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($is_create){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1928</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;org_token&nbsp;(org_id,&nbsp;uvs_id,&nbsp;org_token)&nbsp;VALUES&nbsp;($orgid,&nbsp;$uvs_id,&nbsp;$org_access_token)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1929</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1930</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;&quot;UPDATE&nbsp;org_token&nbsp;SET&nbsp;org_token&nbsp;=&nbsp;$org_access_token&nbsp;WHERE&nbsp;uvs_id=$uvs_id&nbsp;AND&nbsp;org_id=$orgid&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>1931</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1932</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($sql);</span></code></td></tr><tr><td class="coverageDetails"><span>1933</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}//end&nbsp;of&nbsp;add_update_org_token</span></code></td></tr><tr><td class="coverageDetails"><span>1934</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1935</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//&nbsp;enable&nbsp;the&nbsp;email's&nbsp;login&nbsp;perimission</span></code></td></tr><tr><td class="coverageDetails"><span>1936</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;update_email_login_enabled($uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1937</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1938</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;$conn-&gt;escape($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1939</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_email&nbsp;SET&nbsp;login_enabled&nbsp;=&nbsp;1&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1940</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>1941</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1942</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1943</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//&nbsp;enable&nbsp;the&nbsp;phone's&nbsp;login&nbsp;perimission</span></code></td></tr><tr><td class="coverageDetails"><span>1944</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;update_phone_login_enabled($uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1945</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1946</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;$conn-&gt;escape($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1947</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account_phone&nbsp;SET&nbsp;login_enabled&nbsp;=&nbsp;1&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1948</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>1949</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1950</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1951</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//update&nbsp;password&nbsp;with&nbsp;bcrypt</span></code></td></tr><tr><td class="coverageDetails"><span>1952</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;update_password($uvs_id,&nbsp;$password)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1953</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1954</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;$conn-&gt;escape($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1955</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_password_hash&nbsp;=&nbsp;$conn-&gt;escape(crypt($password,&nbsp;User::generate_bcrypt_salt()));</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1956</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;account&nbsp;SET&nbsp;password&nbsp;=&nbsp;$i_password_hash&nbsp;where&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1957</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1958</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$i_password_hash;</span></code></td></tr><tr><td class="coverageDetails"><span>1959</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1960</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1961</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;check_fb_user($uvs_id){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1962</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1963</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;select&nbsp;fb_id&nbsp;from&nbsp;account&nbsp;where&nbsp;uvs_id&nbsp;=&nbsp;$uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1964</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1965</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if((int)$result['fb_id']){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1966</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>1967</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1968</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>1969</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1970</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1971</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>1972</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_multi_uvs_ids($uvs_ids){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1973</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1974</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$escape_uvs_ids&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1975</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($uvs_ids&nbsp;as&nbsp;$uvs_id){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1976</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$escape_uvs_ids[]&nbsp;=&nbsp;$conn-&gt;escape($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span>1977</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1978</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql_where&nbsp;=&nbsp;implode(',',&nbsp;$escape_uvs_ids);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1979</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;&quot;select&nbsp;fb_id,&nbsp;uvs_id&nbsp;from&nbsp;account&nbsp;where&nbsp;uvs_id&nbsp;in&nbsp;(&quot;&nbsp;.&nbsp;$sql_where&nbsp;.&nbsp;&quot;)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1980</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_all($sql);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1981</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($result&nbsp;as&nbsp;$row){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1982</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($row&nbsp;as&nbsp;$name&nbsp;=&gt;&nbsp;&amp;$value){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1983</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value&nbsp;=&nbsp;(int)$value;</span></code></td></tr><tr><td class="coverageDetails"><span>1984</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1985</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1986</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result;</span></code></td></tr><tr><td class="coverageDetails"><span>1987</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>1988</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>1989</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_multi_fb_ids($fb_ids){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1990</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1991</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$escape_fb_ids&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1992</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($fb_ids&nbsp;as&nbsp;$fb_id){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1993</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$escape_fb_ids[]&nbsp;=&nbsp;$conn-&gt;escape($fb_id);</span></code></td></tr><tr><td class="coverageDetails"><span>1994</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1995</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql_where&nbsp;=&nbsp;implode(',',&nbsp;$escape_fb_ids);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1996</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;&quot;select&nbsp;fb_id,&nbsp;uvs_id&nbsp;from&nbsp;account&nbsp;where&nbsp;fb_id&nbsp;in&nbsp;(&quot;&nbsp;.&nbsp;$sql_where&nbsp;.&nbsp;&quot;)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1997</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_all($sql);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1998</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($result&nbsp;as&nbsp;$row){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">1999</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($row&nbsp;as&nbsp;$name&nbsp;=&gt;&nbsp;&amp;$value){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">2000</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value&nbsp;=&nbsp;(int)$value;</span></code></td></tr><tr><td class="coverageDetails"><span>2001</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>2002</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">2003</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result;</span></code></td></tr><tr><td class="coverageDetails"><span>2004</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>2005</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>2006</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;function&nbsp;get_pwd_exists()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">2007</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;pwd_exists;</span></code></td></tr><tr><td class="coverageDetails"><span>2008</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>2009</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>2010</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>}</span></code></td></tr><tr><td class="coverageDetails"><span>2011</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>2012</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>?&gt;</span></code></td></tr></table></td></tr>
  </table>

    </div>
  </body>
</html>
