<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Spike PHPCoverage Details: doc.php</title> 
    <link href="../../../../..//css/spikesource.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="pageBox" >

      <table border="0" cellpadding="2" cellspacing="0" id="contentBox" width="100%">
        <tr>
          <td align="left" valign="top"><h1>Spike PHPCoverage Details: doc.php</h1>
          </td>
        </tr>
        <tr>
          <td>

<table width="100%" border="0" cellpadding="2" cellspacing="0"><td width="10%"class="coverageDetailsHead" >Line #</td><td width="10%" class="coverageDetailsHead">Frequency</td><td  width="80%" class="coverageDetailsHead">Source Line</td><tr><td class="coverageDetails"><span>1</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&lt;?php</span></code></td></tr><tr><td class="coverageDetails"><span>2</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">3</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">define(&quot;DELETE_STATUS&quot;,&nbsp;&quot;hidden&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">4</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">define(&quot;RESERVED_STATUS&quot;,&nbsp;&quot;reserved&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">5</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">define(&quot;SEND_METHOD_EMAIL&quot;,&nbsp;&quot;email&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">6</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">define(&quot;SEND_METHOD_USHERCODE&quot;,&nbsp;&quot;ushercode&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">7</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">define(&quot;EMAIL_TITLE&quot;,&nbsp;&quot;Usher&nbsp;Notification&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">8</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">define(&quot;EMAIL_CONTENT&quot;,&nbsp;&quot;A&nbsp;new&nbsp;document&nbsp;was&nbsp;shared&nbsp;to&nbsp;you&nbsp;by&nbsp;Usher,&nbsp;you&nbsp;can&nbsp;login&nbsp;and&nbsp;check&nbsp;it.&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">9</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">define(&quot;ASSET_TYPE_DOC&quot;,&nbsp;&quot;D&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>10</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>11</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>Class&nbsp;Doc{</span></code></td></tr><tr><td class="coverageDetails"><span>12</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;$id,&nbsp;$owner,&nbsp;$status,&nbsp;$name,&nbsp;$signed_file_size,&nbsp;$file_url,&nbsp;$overlays;</span></code></td></tr><tr><td class="coverageDetails"><span>13</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;protected&nbsp;$signed_file_url,&nbsp;$signed_thumbnail_url,&nbsp;$signed_with_badge,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">14</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$signed_time,&nbsp;$signed_location;</span></code></td></tr><tr><td class="coverageDetails"><span>15</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>16</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;__construct($id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">17</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;id&nbsp;=&nbsp;$id;</span></code></td></tr><tr><td class="coverageDetails"><span>18</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>19</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>20</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;create($id,&nbsp;$owner_uvs_id,&nbsp;$doc_name_customized,&nbsp;$name,&nbsp;$signed_file_size,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">21</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$signed_with_badges,&nbsp;$status='active',&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+22</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file_url&nbsp;=&nbsp;null,&nbsp;$overlays&nbsp;=&nbsp;null,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+23</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$signed_file_url&nbsp;=&nbsp;null,&nbsp;$signed_thumbnail_url&nbsp;=&nbsp;null,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+24</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$signed_time&nbsp;=&nbsp;null,&nbsp;$signed_location&nbsp;=&nbsp;null)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">25</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!is_numeric($id))&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">26</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc&nbsp;=&nbsp;new&nbsp;self($id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">27</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc-&gt;owner&nbsp;=&nbsp;$owner_uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">28</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc-&gt;status&nbsp;=&nbsp;$status;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">29</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc-&gt;name&nbsp;=&nbsp;$name;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">30</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc-&gt;doc_name_customized&nbsp;=&nbsp;$doc_name_customized;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">31</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc-&gt;signed_file_size&nbsp;=&nbsp;$signed_file_size;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">32</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc-&gt;file_url&nbsp;=&nbsp;$file_url;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">33</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc-&gt;overlays&nbsp;=&nbsp;$overlays;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">34</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc-&gt;signed_file_url&nbsp;=&nbsp;$signed_file_url;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">35</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc-&gt;signed_thumbnail_url&nbsp;=&nbsp;$signed_thumbnail_url;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">36</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc-&gt;signed_with_badge&nbsp;=&nbsp;json_encode($signed_with_badges);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">37</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc-&gt;signed_time&nbsp;=&nbsp;$signed_time;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">38</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc-&gt;signed_location&nbsp;=&nbsp;$signed_location;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">39</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">40</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;'INSERT&nbsp;INTO&nbsp;doc(doc_id,&nbsp;uvs_id,&nbsp;status,&nbsp;doc_name_customized,&nbsp;file_name,&nbsp;signed_file_size,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+41</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_url,&nbsp;overlays,&nbsp;signed_file_url,&nbsp;signed_thumbnail_url,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+42</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signed_with_badge,&nbsp;signed_time,&nbsp;signed_location)&nbsp;VALUES('</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+43</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&quot;:id&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+44</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&quot;:owner&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+45</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&quot;:status&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+46</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&quot;:doc_name_customized&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+47</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&quot;:name&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+48</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&quot;:signed_file_size&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+49</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&quot;:file_url&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+50</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&quot;:overlays&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+51</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&quot;:signed_file_url&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+52</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&quot;:signed_thumbnail_url&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+53</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&quot;:signed_with_badge&quot;.',&nbsp;';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">54</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($doc-&gt;signed_time&nbsp;!=&nbsp;null)&nbsp;$query&nbsp;.=&nbsp;&quot;:signed_time&quot;.',&nbsp;';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">55</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;$query&nbsp;.=&nbsp;'NOW(),&nbsp;';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">56</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;.=&nbsp;&quot;:signed_location&quot;.')';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">57</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+58</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:id&quot;&nbsp;=&gt;&nbsp;$doc-&gt;id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+59</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:owner&quot;&nbsp;=&gt;&nbsp;$doc-&gt;owner,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+60</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:status&quot;&nbsp;=&gt;&nbsp;$doc-&gt;status,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+61</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:doc_name_customized&quot;&nbsp;=&gt;&nbsp;$doc-&gt;doc_name_customized,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+62</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:name&quot;&nbsp;=&gt;&nbsp;$doc-&gt;name,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+63</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:signed_file_size&quot;&nbsp;=&gt;&nbsp;$doc-&gt;signed_file_size,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+64</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:file_url&quot;&nbsp;=&gt;&nbsp;$doc-&gt;file_url,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+65</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:overlays&quot;&nbsp;=&gt;&nbsp;$doc-&gt;overlays,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+66</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:signed_file_url&quot;&nbsp;=&gt;&nbsp;$doc-&gt;signed_file_url,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+67</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:signed_thumbnail_url&quot;&nbsp;=&gt;&nbsp;$doc-&gt;signed_thumbnail_url,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+68</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:signed_with_badge&quot;&nbsp;=&gt;&nbsp;$doc-&gt;signed_with_badge,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+69</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:signed_time&quot;&nbsp;=&gt;&nbsp;$doc-&gt;signed_time,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+70</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:signed_location&quot;&nbsp;=&gt;&nbsp;$doc-&gt;signed_location</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+71</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">72</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">73</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$doc;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>74</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>75</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>76</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_doc($uvs_id,&nbsp;$args){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">77</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">78</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">79</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$limit&nbsp;=&nbsp;(int)$args['limit'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">80</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$offset&nbsp;=&nbsp;(int)$args['offset'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">81</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$doc_id&nbsp;=&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>82</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//$repeat_id&nbsp;=&nbsp;NULL;//flag&nbsp;repeat&nbsp;doc&nbsp;id&nbsp;in&nbsp;shared&nbsp;list</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">83</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">84</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($args[0]&nbsp;==&nbsp;&quot;created&quot;){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">85</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;uvs_id,&nbsp;doc_id,&nbsp;doc_name_customized,&nbsp;file_name,&nbsp;signed_file_size,&nbsp;signed_with_badge,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+86</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(signed_time)&nbsp;as&nbsp;sign_time,&nbsp;signed_location,&nbsp;signed_file_url,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+87</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signed_thumbnail_url&nbsp;from&nbsp;doc&nbsp;where&nbsp;uvs_id=:uvs_id&nbsp;and&nbsp;status&lt;&gt;'hidden'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">88</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;.=&nbsp;&quot;order&nbsp;by&nbsp;sign_time&nbsp;desc&nbsp;limit&nbsp;:limit&nbsp;offset&nbsp;:offset&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">89</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stm&nbsp;=&nbsp;$conn-&gt;prepare($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">90</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stm-&gt;bindValue(&quot;:uvs_id&quot;,&nbsp;$uvs_id,&nbsp;PDO::PARAM_INT);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">91</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stm-&gt;bindValue(&quot;:limit&quot;,&nbsp;$limit,&nbsp;PDO::PARAM_INT);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">92</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stm-&gt;bindValue(&quot;:offset&quot;,&nbsp;$offset,&nbsp;PDO::PARAM_INT);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">93</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stm-&gt;execute();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">94</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rows&nbsp;=&nbsp;$stm-&gt;all_rows();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">95</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}else&nbsp;if($args[0]&nbsp;==&nbsp;&quot;shared&quot;){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">96</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;DISTINCT&nbsp;doc.doc_id,&nbsp;doc.uvs_id,&nbsp;doc.doc_name_customized,&nbsp;doc.file_name,&nbsp;doc.signed_file_size,&nbsp;doc.signed_with_badge,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+97</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(doc.signed_time)&nbsp;as&nbsp;sign_time,&nbsp;doc.signed_location,&nbsp;doc_share.doc_name_customized&nbsp;as&nbsp;share_name,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+98</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc.signed_file_url,&nbsp;doc.signed_thumbnail_url,&nbsp;UNIX_TIMESTAMP(doc_share.sent_time)&nbsp;as&nbsp;sent_time&nbsp;from&nbsp;doc_share,&nbsp;doc&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+99</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;doc_share.uvs_id_recipient&nbsp;=&nbsp;:uvs_id&nbsp;and&nbsp;doc_share.doc_id&nbsp;=&nbsp;doc.doc_id</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+100</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;doc_share.status&lt;&gt;'hidden'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">101</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;.=&nbsp;&quot;order&nbsp;by&nbsp;doc_share.sent_time&nbsp;desc&nbsp;limit&nbsp;:limit&nbsp;offset&nbsp;:offset&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">102</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stm&nbsp;=&nbsp;$conn-&gt;prepare($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">103</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stm-&gt;bindValue(&quot;:uvs_id&quot;,&nbsp;$uvs_id,&nbsp;PDO::PARAM_INT);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">104</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stm-&gt;bindValue(&quot;:limit&quot;,&nbsp;$limit,&nbsp;PDO::PARAM_INT);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">105</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stm-&gt;bindValue(&quot;:offset&quot;,&nbsp;$offset,&nbsp;PDO::PARAM_INT);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">106</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stm-&gt;execute();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">107</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rows&nbsp;=&nbsp;$stm-&gt;all_rows();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">108</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}else&nbsp;if($args[0]&nbsp;==&nbsp;&quot;badgeid&quot;){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">109</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$badge_id&nbsp;=&nbsp;(int)$args[1];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">110</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;uvs_id,&nbsp;doc_id,&nbsp;doc_name_customized,&nbsp;file_name,&nbsp;signed_file_size,&nbsp;signed_with_badge,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+111</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(signed_time)&nbsp;as&nbsp;sign_time,&nbsp;signed_location,&nbsp;signed_file_url,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+112</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signed_thumbnail_url&nbsp;from&nbsp;doc&nbsp;where&nbsp;uvs_id=:uvs_id&nbsp;and&nbsp;status&lt;&gt;'hidden'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">113</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;.=&nbsp;&quot;order&nbsp;by&nbsp;sign_time&nbsp;desc&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">114</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:uvs_id&quot;&nbsp;=&gt;&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">115</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rows&nbsp;=&nbsp;$conn-&gt;select_all($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">116</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($rows&nbsp;as&nbsp;&amp;$row){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">117</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$badge&nbsp;=&nbsp;json_decode($row['signed_with_badge']);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">118</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($badge_id&nbsp;!=&nbsp;$badge-&gt;id){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">119</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row&nbsp;=&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>120</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>121</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">122</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rows&nbsp;=&nbsp;array_filter($rows);</span></code></td></tr><tr><td class="coverageDetails"><span>123</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>124</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$doc_id&nbsp;=&nbsp;(int)$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">125</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc_id&nbsp;=&nbsp;$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">126</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($args[1])&nbsp;&amp;&amp;&nbsp;$args[1]&nbsp;==&nbsp;&quot;encoded&quot;){</span></code></td></tr><tr><td class="coverageDetails"><span>127</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//decode&nbsp;the&nbsp;doc&nbsp;id</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">128</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$length&nbsp;=&nbsp;strlen($doc_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">129</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc_id_part&nbsp;=&nbsp;substr($doc_id,&nbsp;2,&nbsp;$length-3);&nbsp;//skip&nbsp;the&nbsp;two&nbsp;letters,&nbsp;which&nbsp;are&nbsp;'P'&nbsp;&amp;&nbsp;a&nbsp;random&nbsp;prefix</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">130</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$checksum&nbsp;=&nbsp;$doc_id[$length-1];</span></code></td></tr><tr><td class="coverageDetails"><span>131</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">132</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($doc_id[0]&nbsp;!=&nbsp;'P'&nbsp;||&nbsp;!Util::id_validate($doc_id_part,&nbsp;$checksum))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">133</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>134</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">135</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc_id&nbsp;=&nbsp;Util::id_decode($doc_id_part);</span></code></td></tr><tr><td class="coverageDetails"><span>136</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">137</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;uvs_id,&nbsp;doc_id,&nbsp;doc_name_customized,&nbsp;file_name,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+138</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signed_file_size,&nbsp;signed_with_badge,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+139</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(signed_time)&nbsp;as&nbsp;sign_time,&nbsp;signed_location,&nbsp;signed_file_url,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+140</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signed_thumbnail_url&nbsp;from&nbsp;doc&nbsp;where&nbsp;doc_id=:doc_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">141</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">142</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rows&nbsp;=&nbsp;$conn-&gt;select_all($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span>143</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{//get&nbsp;doc&nbsp;from&nbsp;doc&nbsp;table</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">144</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc_id&nbsp;=&nbsp;(int)$args[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">145</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;uvs_id,&nbsp;doc_id,&nbsp;doc_name_customized,&nbsp;file_name,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+146</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signed_file_size,&nbsp;signed_with_badge,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+147</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(signed_time)&nbsp;as&nbsp;sign_time,&nbsp;signed_location,&nbsp;signed_file_url,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+148</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signed_thumbnail_url&nbsp;from&nbsp;doc&nbsp;where&nbsp;doc_id=:doc_id&nbsp;and&nbsp;uvs_id=:uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">149</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id,&nbsp;&quot;:uvs_id&quot;&nbsp;=&gt;&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">150</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rows&nbsp;=&nbsp;$conn-&gt;select_all($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">151</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($rows[0])){//get&nbsp;doc&nbsp;from&nbsp;doc_share&nbsp;table</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">152</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;DISTINCT&nbsp;doc.doc_id,&nbsp;doc.uvs_id,&nbsp;&nbsp;doc.doc_name_customized,&nbsp;doc.file_name,&nbsp;doc.signed_file_size,&nbsp;doc.signed_with_badge,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+153</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(doc.signed_time)&nbsp;as&nbsp;sign_time,&nbsp;doc.signed_location,&nbsp;UNIX_TIMESTAMP(doc_share.sent_time)&nbsp;as&nbsp;sent_time,&nbsp;doc_share.doc_name_customized&nbsp;as&nbsp;share_name,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+154</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc.signed_file_url,&nbsp;doc.signed_thumbnail_url&nbsp;from&nbsp;doc_share,&nbsp;doc&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+155</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;doc_share.doc_id=:doc_id&nbsp;and&nbsp;doc_share.uvs_id_recipient=:uvs_id&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+156</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;doc_share.doc_id=doc.doc_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">157</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id,&nbsp;&quot;:uvs_id&quot;&nbsp;=&gt;&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">158</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rows&nbsp;=&nbsp;$conn-&gt;select_all($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span>159</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>160</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>161</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>162</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//$rows&nbsp;=&nbsp;$conn-&gt;select_all($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">163</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;self::format_docs($rows,&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">164</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>165</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>166</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>167</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;private&nbsp;static&nbsp;function&nbsp;format_docs($rows,&nbsp;$uvs_id){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">168</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">169</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($rows&nbsp;as&nbsp;$row){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">170</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span>171</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*if($row['doc_id']&nbsp;==&nbsp;$repeat_id){</span></code></td></tr><tr><td class="coverageDetails"><span>172</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></code></td></tr><tr><td class="coverageDetails"><span>173</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>174</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$repeat_id&nbsp;=&nbsp;$row['doc_id'];*/</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">175</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;doc_id&nbsp;=&nbsp;(int)$row['doc_id'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">176</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($row['share_name'])&nbsp;&amp;&amp;&nbsp;$row['share_name']){//get&nbsp;customized&nbsp;doc&nbsp;name&nbsp;for&nbsp;shared</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">177</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;doc_name&nbsp;=&nbsp;$row['share_name'];</span></code></td></tr><tr><td class="coverageDetails"><span>178</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">179</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;doc_name&nbsp;=&nbsp;$row['doc_name_customized'];</span></code></td></tr><tr><td class="coverageDetails"><span>180</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">181</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($row['sent_time'])&nbsp;$item-&gt;sent_time&nbsp;=&nbsp;(int)$row['sent_time'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">182</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;file_name&nbsp;=&nbsp;$row['file_name'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">183</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;file_size&nbsp;=&nbsp;(int)$row['signed_file_size'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">184</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;signed_with_badge&nbsp;=&nbsp;json_decode(&nbsp;$row['signed_with_badge']&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">185</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;signed_time&nbsp;=&nbsp;(int)$row['sign_time'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">186</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;signed_location&nbsp;=&nbsp;$row['signed_location'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">187</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;signed_thumbnail_url&nbsp;=&nbsp;$row['signed_thumbnail_url'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">188</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;signed_file_url&nbsp;=&nbsp;$row['signed_file_url'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">189</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if((int)$row['uvs_id']&nbsp;==&nbsp;$uvs_id){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">190</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;created_by_me&nbsp;=&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>191</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">192</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;created_by_me&nbsp;=&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">193</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($row['share_name'])&nbsp;&amp;&amp;&nbsp;$doc_id){//get&nbsp;customized&nbsp;doc&nbsp;name&nbsp;for&nbsp;single&nbsp;doc&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">194</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;select&nbsp;*&nbsp;from&nbsp;doc_share&nbsp;where&nbsp;doc_id=:doc_id&nbsp;and&nbsp;uvs_id_recipient=:uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">195</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id,&nbsp;&quot;:uvs_id&quot;&nbsp;=&gt;&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">196</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">197</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">198</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($result['doc_name_customized'])&nbsp;$item-&gt;doc_name&nbsp;=&nbsp;$result['doc_name_customized'];</span></code></td></tr><tr><td class="coverageDetails"><span>199</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>200</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>201</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">202</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response[]&nbsp;=&nbsp;$item;</span></code></td></tr><tr><td class="coverageDetails"><span>203</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">204</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>205</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>206</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>207</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//change&nbsp;the&nbsp;status&nbsp;value&nbsp;to&nbsp;hidden&nbsp;in&nbsp;doc&nbsp;talbe</span></code></td></tr><tr><td class="coverageDetails"><span>208</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;delete($id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">209</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">210</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$id&nbsp;=&nbsp;(int)$id;</span></code></td></tr><tr><td class="coverageDetails"><span>211</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//update&nbsp;status&nbsp;to&nbsp;'hidden'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">212</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;doc&nbsp;SET&nbsp;status&nbsp;=&nbsp;'&quot;.DELETE_STATUS.&quot;'&nbsp;WHERE&nbsp;doc_id&nbsp;=&nbsp;:id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">213</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:id&quot;&nbsp;=&gt;&nbsp;$id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">214</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span>215</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">216</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$number&nbsp;=&nbsp;$result-&gt;num_affected_rows();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">217</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$number&nbsp;==&nbsp;1&nbsp;?&nbsp;true&nbsp;:&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>218</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>219</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>220</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//change&nbsp;the&nbsp;status&nbsp;value&nbsp;to&nbsp;hidden&nbsp;in&nbsp;doc_share&nbsp;table</span></code></td></tr><tr><td class="coverageDetails"><span>221</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;delete_share($doc_id,&nbsp;$uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">222</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">223</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">224</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$doc_id&nbsp;=&nbsp;(int)$doc_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">225</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;doc_share&nbsp;SET&nbsp;status&nbsp;=&nbsp;'&quot;&nbsp;.&nbsp;DELETE_STATUS&nbsp;.&nbsp;&quot;'&nbsp;WHERE&nbsp;doc_id&nbsp;=&nbsp;:doc_id&nbsp;and&nbsp;uvs_id_recipient=:uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">226</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id,&nbsp;&quot;:uvs_id&quot;&nbsp;=&gt;&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">227</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">228</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$number&nbsp;=&nbsp;$result-&gt;num_affected_rows();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">229</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$number&nbsp;==&nbsp;1&nbsp;?&nbsp;true&nbsp;:&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>230</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>231</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>232</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;check_share_permission($doc_id,&nbsp;$sender_id)&nbsp;{&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">233</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">234</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$doc_id&nbsp;=&nbsp;(int)$doc_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">235</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$sender_id&nbsp;=&nbsp;(int)$sender_id;</span></code></td></tr><tr><td class="coverageDetails"><span>236</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//search&nbsp;in&nbsp;doc</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">237</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;doc_id&nbsp;FROM&nbsp;doc&nbsp;WHERE&nbsp;doc_id&nbsp;=&nbsp;:doc_id&nbsp;and&nbsp;uvs_id&nbsp;=&nbsp;:sender_id&nbsp;and&nbsp;status&nbsp;!=&nbsp;'hidden'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">238</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id,&nbsp;&quot;:sender_id&quot;&nbsp;=&gt;&nbsp;$sender_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">239</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">240</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{//search&nbsp;in&nbsp;doc_share</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">241</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query_shared&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;doc_share&nbsp;WHERE&nbsp;doc_id&nbsp;=&nbsp;:doc_id&nbsp;and&nbsp;uvs_id_recipient&nbsp;=&nbsp;:sender_id&nbsp;and&nbsp;status&nbsp;!=&nbsp;'hidden'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">242</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id,&nbsp;&quot;:sender_id&quot;&nbsp;=&gt;&nbsp;$sender_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">243</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result_shared&nbsp;=&nbsp;$conn-&gt;select_first($query_shared,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">244</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result_shared)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">245</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>246</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>247</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">248</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>249</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>250</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>251</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//just&nbsp;for&nbsp;checking&nbsp;whether&nbsp;the&nbsp;input&nbsp;doc_id&nbsp;exists&nbsp;in&nbsp;db</span></code></td></tr><tr><td class="coverageDetails"><span>252</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find($id)&nbsp;{&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">253</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($id))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">254</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>255</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">256</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">257</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$id&nbsp;=&nbsp;(int)$id;</span></code></td></tr><tr><td class="coverageDetails"><span>258</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//search&nbsp;in&nbsp;mysql&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">259</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;doc_id&nbsp;FROM&nbsp;doc&nbsp;WHERE&nbsp;doc_id&nbsp;=&nbsp;:id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">260</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:id&quot;&nbsp;=&gt;&nbsp;$id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">261</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">262</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">263</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>264</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">265</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>266</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>267</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>268</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//check&nbsp;whether&nbsp;the&nbsp;user&nbsp;is&nbsp;the&nbsp;doc's&nbsp;owner</span></code></td></tr><tr><td class="coverageDetails"><span>269</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;is_doc_owner($doc_id,&nbsp;$uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">270</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">271</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">272</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$doc_id&nbsp;=&nbsp;(int)$doc_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">273</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;doc_id&nbsp;FROM&nbsp;doc&nbsp;WHERE&nbsp;doc_id&nbsp;=&nbsp;:doc_id&nbsp;and&nbsp;uvs_id&nbsp;=&nbsp;:uvs_id&nbsp;and&nbsp;status&nbsp;!=&nbsp;'hidden'&nbsp;&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">274</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id,&nbsp;&quot;:uvs_id&quot;&nbsp;=&gt;&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">275</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">276</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">277</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>278</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">279</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>280</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>281</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>282</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;share($id,&nbsp;$uvs_id_sender,&nbsp;$emails,&nbsp;$sent_as_attachment,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">283</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ttl=NULL,&nbsp;$sent_location=NULL)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">284</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">285</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($emails))&nbsp;{//share&nbsp;by&nbsp;emails</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">286</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">287</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($emails&nbsp;as&nbsp;$email)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>288</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//check&nbsp;if&nbsp;email&nbsp;is&nbsp;usher&nbsp;user</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">289</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!preg_match(&quot;/^[_A-Za-z0-9-]+(.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9-]+)+$/&quot;,&nbsp;$email))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">290</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[]&nbsp;=&nbsp;$email;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">291</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></code></td></tr><tr><td class="coverageDetails"><span>292</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">293</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id_recipient&nbsp;=&nbsp;User::find_by_email($email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">294</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($uvs_id_recipient))&nbsp;$uvs_id_recipient&nbsp;=&nbsp;User::find_by_email_reserved($email);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">295</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($uvs_id_recipient))&nbsp;{//not&nbsp;exist,&nbsp;create&nbsp;a&nbsp;reserved&nbsp;account&nbsp;for&nbsp;this&nbsp;email</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">296</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user&nbsp;=&nbsp;User::create($email,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;RESERVED_STATUS,&nbsp;NULL);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">297</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id_recipient&nbsp;=&nbsp;$user-&gt;get_uvs_id();</span></code></td></tr><tr><td class="coverageDetails"><span>298</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">299</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($uvs_id_recipient)&nbsp;||&nbsp;($uvs_id_sender&nbsp;==&nbsp;$uvs_id_recipient))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">300</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[]&nbsp;=&nbsp;$email;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">301</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></code></td></tr><tr><td class="coverageDetails"><span>302</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>303</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//add&nbsp;share&nbsp;to&nbsp;doc_share</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">304</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;'INSERT&nbsp;INTO&nbsp;doc_share(doc_id,&nbsp;uvs_id_sender,&nbsp;uvs_id_recipient,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+305</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sent_time,&nbsp;sent_location,&nbsp;sent_method)&nbsp;VALUES('</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+306</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&quot;:id&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+307</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&quot;:uvs_id_sender&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+308</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&quot;:uvs_id_recipient&quot;.',&nbsp;';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">309</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;.=&nbsp;&quot;NOW(),&nbsp;&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">310</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;.=&nbsp;&quot;:sent_location&quot;.&quot;,&nbsp;'&quot;.SEND_METHOD_EMAIL.&quot;')&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">311</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+312</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:id&quot;&nbsp;=&gt;&nbsp;$id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+313</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:uvs_id_sender&quot;&nbsp;=&gt;&nbsp;$uvs_id_sender,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+314</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:uvs_id_recipient&quot;&nbsp;=&gt;&nbsp;$uvs_id_recipient,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+315</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:sent_location&quot;&nbsp;=&gt;&nbsp;$sent_location);</span></code></td></tr><tr><td class="coverageDetails"><span>316</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>317</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//if&nbsp;not&nbsp;exist,&nbsp;insert,&nbsp;else,&nbsp;update&nbsp;status&nbsp;to&nbsp;'accecpted';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">318</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!self::check_duplicate_share($id,&nbsp;$uvs_id_recipient,&nbsp;true))&nbsp;$conn-&gt;execute($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span>319</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//send&nbsp;email&nbsp;to&nbsp;notify</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">320</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!self::sent_share_email($id,&nbsp;$email,&nbsp;$uvs_id_sender,&nbsp;$sent_as_attachment))&nbsp;$result[]&nbsp;=&nbsp;$email;</span></code></td></tr><tr><td class="coverageDetails"><span>321</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Added&nbsp;on&nbsp;2012-10-25,&nbsp;Send&nbsp;notification&nbsp;to&nbsp;notify</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">322</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::save_active_log($id,&nbsp;$uvs_id_sender,&nbsp;$uvs_id_recipient,&nbsp;&quot;email&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">323</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch(Exception&nbsp;$e)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">324</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[]&nbsp;=&nbsp;$email;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">325</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></code></td></tr><tr><td class="coverageDetails"><span>326</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>327</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">328</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">329</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if(isset($ttl))&nbsp;{//share&nbsp;by&nbsp;ushercode</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">330</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ushercode&nbsp;=&nbsp;UsherCode::create($uvs_id_sender,&nbsp;$id,&nbsp;ASSET_TYPE_DOC,&nbsp;$ttl);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">331</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$ushercode;</span></code></td></tr><tr><td class="coverageDetails"><span>332</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>333</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>334</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>335</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;function&nbsp;sent_share_email($id,&nbsp;$email,&nbsp;$uvs_id_sender,&nbsp;$sent_as_attachment)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">336</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;=&nbsp;&quot;MIME-Version:&nbsp;1.0&quot;&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">337</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;.=&nbsp;&quot;From:&nbsp;usher.com&nbsp;&lt;noreply@usher.com&gt;&quot;&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">338</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$message&nbsp;=&nbsp;&quot;&lt;html&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+339</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+340</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;&quot;.EMAIL_TITLE.&quot;&lt;/title&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+341</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+342</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+343</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&quot;.EMAIL_CONTENT.&quot;&lt;/p&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+344</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+345</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/html&gt;&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">346</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($sent_as_attachment)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">347</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$args&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">348</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$args[]&nbsp;=&nbsp;$id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">349</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;self::get_doc($uvs_id_sender,&nbsp;$args);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">350</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc&nbsp;=&nbsp;$result[0];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">351</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fp&nbsp;=&nbsp;fopen($doc-&gt;signed_file_url,&nbsp;&quot;r&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">352</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$read&nbsp;=&nbsp;fread($fp,&nbsp;filesize($doc-&gt;signed_file_url));</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">353</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$read&nbsp;=&nbsp;base64_encode($read);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">354</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$read&nbsp;=&nbsp;chunk_split($read);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">355</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$boundary&nbsp;=&nbsp;uniqid(&quot;&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">356</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;.=&nbsp;&quot;Content-type:&nbsp;multipart/mixed;&nbsp;boundary=\&quot;$boundary\&quot;&quot;&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">357</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body&nbsp;=&nbsp;&quot;--$boundary&quot;&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">358</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body&nbsp;.=&nbsp;&quot;Content-type:&nbsp;text/html;&nbsp;charset=utf-8&quot;&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">359</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body&nbsp;.=&nbsp;&quot;Content-transfer-encoding:&nbsp;8bit&quot;&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">360</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body&nbsp;.=&nbsp;$message&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">361</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body&nbsp;.=&nbsp;&quot;--$boundary&quot;&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">362</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($doc-&gt;doc_name))&nbsp;$doc-&gt;doc_name&nbsp;=&nbsp;&quot;noname.pdf&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">363</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body&nbsp;.=&nbsp;&quot;Content-type:&nbsp;application/pdf;&nbsp;name=$doc-&gt;doc_name&quot;&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">364</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body&nbsp;.=&nbsp;&quot;Content-disposition:&nbsp;attachment;&nbsp;filename==?UTF-8?B?&quot;.base64_encode($doc-&gt;doc_name).&quot;?=&quot;&nbsp;.&nbsp;&quot;.pdf&quot;&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">365</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body&nbsp;.=&nbsp;&quot;Content-transfer-encoding:&nbsp;base64&quot;&nbsp;.&nbsp;&quot;\r\n\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">366</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body&nbsp;.=&nbsp;$read&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">367</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body&nbsp;.=&nbsp;&quot;--$boundary--&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>368</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">369</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;.=&nbsp;&quot;Content-type:&nbsp;text/html;&nbsp;charset=utf-8&quot;&nbsp;.&nbsp;&quot;\r\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">370</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body&nbsp;=&nbsp;$message;</span></code></td></tr><tr><td class="coverageDetails"><span>371</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">372</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;mail($email,&nbsp;EMAIL_TITLE,&nbsp;$body,&nbsp;$headers);</span></code></td></tr><tr><td class="coverageDetails"><span>373</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>374</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>375</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;check_shared_by_id($documentId,&nbsp;$recipientId,&nbsp;$changeStatusToAccepted=false,&nbsp;$by_email=false){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">376</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">377</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($documentId)&nbsp;||&nbsp;&nbsp;!isset($recipientId)){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">378</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>379</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">380</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;doc_share&nbsp;WHERE&nbsp;doc_id&nbsp;=&nbsp;:documentId&nbsp;&quot;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+381</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;.&quot;AND&nbsp;&nbsp;uvs_id_recipient&nbsp;=&nbsp;:recipientId&nbsp;AND&nbsp;status&nbsp;!=&nbsp;'hidden'&nbsp;&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">382</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($by_email)&nbsp;$query&nbsp;.=&nbsp;&quot;&nbsp;AND&nbsp;sent_method='&quot;.SEND_METHOD_EMAIL.&quot;'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">383</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:documentId&quot;&nbsp;=&gt;&nbsp;$documentId,&nbsp;&quot;:recipientId&quot;&nbsp;=&gt;&nbsp;$recipientId);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">384</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$queryResult&nbsp;=&nbsp;$conn-&gt;select_all($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">385</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$queryResult){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">386</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>387</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">388</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($changeStatusToAccepted){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">389</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$updateQuery&nbsp;=&nbsp;&quot;UPDATE&nbsp;doc_share&nbsp;SET&nbsp;status&nbsp;=&nbsp;'accepted'&nbsp;&quot;.</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+390</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;WHERE&nbsp;doc_id&nbsp;=&nbsp;:documentId&nbsp;AND&nbsp;&nbsp;uvs_id_recipient&nbsp;=&nbsp;:recipientId&nbsp;AND&nbsp;status&nbsp;!=&nbsp;'hidden'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">391</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:documentId&quot;&nbsp;=&gt;&nbsp;$documentId,&nbsp;&quot;:recipientId&quot;&nbsp;=&gt;&nbsp;$recipientId);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">392</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($updateQuery,&nbsp;$attr);&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>393</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">394</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>395</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>396</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>397</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>398</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;function&nbsp;check_duplicate_share($doc_id,&nbsp;$uvs_id_recipient,&nbsp;$change_status=false)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">399</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">400</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($doc_id)&nbsp;||&nbsp;!isset($uvs_id_recipient))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">401</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>402</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">403</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;doc_share&nbsp;WHERE&nbsp;doc_id&nbsp;=&nbsp;:doc_id&nbsp;AND&nbsp;uvs_id_recipient&nbsp;=&nbsp;:uvs_id_recipient&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">404</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id,&nbsp;&quot;:uvs_id_recipient&quot;&nbsp;=&gt;&nbsp;$uvs_id_recipient);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">405</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">406</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">407</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>408</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">409</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($change_status&nbsp;&amp;&amp;&nbsp;$result['status']&nbsp;==&nbsp;'hidden')&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">410</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$update_query&nbsp;=&nbsp;&quot;UPDATE&nbsp;doc_share&nbsp;SET&nbsp;status&nbsp;=&nbsp;'accepted',&nbsp;sent_method&nbsp;=&nbsp;'&quot;.SEND_METHOD_EMAIL.&quot;'&nbsp;&quot;.</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+411</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;WHERE&nbsp;doc_id&nbsp;=&nbsp;:doc_id&nbsp;AND&nbsp;uvs_id_recipient&nbsp;=&nbsp;:uvs_id_recipient&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">412</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id,&nbsp;&quot;:uvs_id_recipient&quot;&nbsp;=&gt;&nbsp;$uvs_id_recipient);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">413</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($update_query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span>414</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">415</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>416</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>417</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>418</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>419</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;check_shared_by_ushercode($usherCode){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">420</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">421</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$asset_type&nbsp;=&nbsp;ASSET_TYPE_DOC;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">422</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;asset_id,&nbsp;uvs_id&nbsp;FROM&nbsp;usher_code&nbsp;&quot;.</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+423</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&quot;WHERE&nbsp;code&nbsp;=&nbsp;:usherCode&nbsp;AND&nbsp;expiration&nbsp;&gt;&nbsp;UNIX_TIMESTAMP(NOW())&nbsp;AND&nbsp;asset_type&nbsp;=&nbsp;:asset_type&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">424</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:usherCode&quot;&nbsp;=&gt;&nbsp;$usherCode,&nbsp;&quot;:asset_type&quot;&nbsp;=&gt;&nbsp;$asset_type);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">425</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$row&nbsp;=&nbsp;$conn-&gt;select_first($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">426</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$row){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">427</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>428</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">429</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">430</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;documentId&nbsp;=&nbsp;(int)$row['asset_id'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">431</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;senderId&nbsp;=&nbsp;(int)$row['uvs_id'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">432</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result;</span></code></td></tr><tr><td class="coverageDetails"><span>433</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>434</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>435</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>436</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;add_shard_info($documentId,&nbsp;$senderId,&nbsp;$recipientId,&nbsp;$sendMethod){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">437</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">438</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$documentId&nbsp;=&nbsp;(int)$documentId;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">439</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$senderId&nbsp;=&nbsp;(int)$senderId;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">440</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$recipientId&nbsp;=&nbsp;(int)$recipientId;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">441</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$origin_send_method&nbsp;=&nbsp;$sendMethod;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">442</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$selectQuery&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;doc_share&nbsp;WHERE&nbsp;&quot;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+443</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;.&quot;doc_id=:documentId&nbsp;AND&nbsp;uvs_id_recipient=:recipientId&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">444</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:documentId&quot;&nbsp;=&gt;&nbsp;$documentId,&nbsp;&quot;:recipientId&quot;&nbsp;=&gt;&nbsp;$recipientId);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">445</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$row&nbsp;=&nbsp;$conn-&gt;select_first($selectQuery,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">446</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$row){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">447</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;'INSERT&nbsp;INTO&nbsp;doc_share(doc_id,&nbsp;uvs_id_sender,&nbsp;uvs_id_recipient,'.</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+448</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'status,sent_time,&nbsp;sent_method)&nbsp;VALUES('</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+449</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&quot;:documentId&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+450</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&quot;:senderId&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+451</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&quot;:recipientId&quot;.',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+452</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&quot;'accepted',&quot;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+453</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.'NOW()&nbsp;,&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+454</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&quot;:sendMethod&quot;.&quot;)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">455</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+456</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:documentId&quot;&nbsp;=&gt;&nbsp;$documentId,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+457</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:senderId&quot;&nbsp;=&gt;&nbsp;$senderId,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+458</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:recipientId&quot;&nbsp;=&gt;&nbsp;$recipientId,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+459</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:sendMethod&quot;&nbsp;=&gt;&nbsp;$sendMethod);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">460</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span>461</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Noted:&nbsp;recipient&nbsp;send&nbsp;notification&nbsp;to&nbsp;sender</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">462</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::save_active_log($documentId,&nbsp;$senderId,&nbsp;$recipientId,&nbsp;$origin_send_method);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">463</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>464</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">465</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($row[&quot;status&quot;]&nbsp;!=&nbsp;'accepted'){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">466</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$updateQuery&nbsp;=&nbsp;&quot;UPDATE&nbsp;doc_share&nbsp;SET&nbsp;status='accepted'&nbsp;WHERE&nbsp;&quot;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+467</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&quot;doc_id=:documentId&nbsp;AND&nbsp;uvs_id_recipient=:recipientId&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">468</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:documentId&quot;&nbsp;=&gt;&nbsp;$documentId,&nbsp;&quot;:recipientId&quot;&nbsp;=&gt;&nbsp;$recipientId);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">469</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($updateQuery,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span>470</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Noted:&nbsp;recipient&nbsp;send&nbsp;notification&nbsp;to&nbsp;sender</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">471</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::save_active_log($documentId,&nbsp;$senderId,&nbsp;$recipientId,&nbsp;$origin_send_method);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">472</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>473</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>474</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//take&nbsp;the&nbsp;save_log&nbsp;out,&nbsp;to&nbsp;make&nbsp;every&nbsp;request&nbsp;are&nbsp;saved&nbsp;to&nbsp;log,&nbsp;not&nbsp;only&nbsp;those&nbsp;ones&nbsp;change&nbsp;DB</span></code></td></tr><tr><td class="coverageDetails"><span>475</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//A&nbsp;shared&nbsp;docD&nbsp;to&nbsp;B,&nbsp;C&nbsp;shared&nbsp;docD&nbsp;to&nbsp;B,&nbsp;A-&gt;B&nbsp;will&nbsp;be&nbsp;saved&nbsp;in&nbsp;active_log,&nbsp;C-&gt;B&nbsp;should&nbsp;be&nbsp;the&nbsp;same&nbsp;though&nbsp;no&nbsp;DB&nbsp;change.</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">476</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;self::save_active_log($documentId,&nbsp;$senderId,&nbsp;$recipientId,&nbsp;$origin_send_method);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">477</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>478</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>479</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>480</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;check_shared_by_qr_sonic($code){</span></code></td></tr><tr><td class="coverageDetails"><span>481</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">482</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($code[0]&nbsp;!=&nbsp;ASSET_TYPE_DOC){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">483</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>484</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>485</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//substr($code,1);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">486</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;list($documentId,&nbsp;$senderId,&nbsp;$random,&nbsp;$md5_token&nbsp;)&nbsp;=&nbsp;explode(&quot;:&quot;,&nbsp;$code);</span></code></td></tr><tr><td class="coverageDetails"><span>487</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">488</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$publicKey&nbsp;=&nbsp;User::get_public_key($senderId*-1,&nbsp;true);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">489</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$timeRam&nbsp;=&nbsp;floor(time()/300);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">490</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$string_to_verify&nbsp;=&nbsp;&quot;$documentId:$senderId:$random&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">491</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$md5_token&nbsp;==&nbsp;Util::generate_truncated_md5($string_to_verify,&nbsp;$publicKey,&nbsp;$timeRam)&nbsp;||</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+492</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$md5_token&nbsp;==&nbsp;Util::generate_truncated_md5($string_to_verify,&nbsp;$publicKey,&nbsp;$timeRam&nbsp;-&nbsp;1)&nbsp;||</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+493</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$md5_token&nbsp;==&nbsp;Util::generate_truncated_md5($string_to_verify,&nbsp;$publicKey,&nbsp;$timeRam&nbsp;+&nbsp;1)&nbsp;){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">494</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">495</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;senderId&nbsp;=&nbsp;(int)$senderId&nbsp;*&nbsp;-1;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">496</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$documentId&nbsp;=&nbsp;substr($documentId,1);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">497</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;documentId&nbsp;=&nbsp;(int)$documentId;</span></code></td></tr><tr><td class="coverageDetails"><span>498</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">499</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result;</span></code></td></tr><tr><td class="coverageDetails"><span>500</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">501</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>502</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>503</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>504</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>505</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;doc_by_id($documentId,&nbsp;$recipient_id&nbsp;=&nbsp;NULL,&nbsp;$check_status&nbsp;=&nbsp;FALSE){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">506</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">507</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$selectQuery&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;doc&nbsp;WHERE&nbsp;doc_id&nbsp;=&nbsp;:documentId&nbsp;&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>508</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;//if&nbsp;get&nbsp;created,&nbsp;need&nbsp;check&nbsp;status;&nbsp;if&nbsp;get&nbsp;shared,&nbsp;needn't</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">509</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if($check_status)&nbsp;$selectQuery&nbsp;.=&nbsp;&quot;&nbsp;and&nbsp;status&nbsp;!=&nbsp;'hidden'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">510</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:documentId&quot;&nbsp;=&gt;&nbsp;$documentId);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">511</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$selectResult&nbsp;=&nbsp;$conn-&gt;select_first($selectQuery,&nbsp;$attr);//return&nbsp;false&nbsp;if&nbsp;no&nbsp;record&nbsp;is&nbsp;selected</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">512</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$selectResult)&nbsp;{&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">513</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;</span></code></td></tr><tr><td class="coverageDetails"><span>514</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">515</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">516</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;doc_id&nbsp;=&nbsp;(int)$selectResult['doc_id'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">517</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;doc_name&nbsp;=&nbsp;$selectResult['doc_name_customized'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">518</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;file_name&nbsp;=&nbsp;$selectResult['file_name'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">519</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;file_size&nbsp;=&nbsp;(int)$selectResult['signed_file_size'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">520</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;signed_file_url&nbsp;=&nbsp;$selectResult['signed_file_url'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">521</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;signed_thumbnail_url&nbsp;=&nbsp;$selectResult['signed_thumbnail_url'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">522</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;signed_time&nbsp;=&nbsp;strtotime($selectResult['signed_time']);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">523</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;signed_location&nbsp;=&nbsp;$selectResult['signed_location'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">524</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;signed_with_badge&nbsp;=&nbsp;json_decode(&nbsp;$selectResult['signed_with_badge']&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">525</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(isset($recipient_id)){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">526</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($selectResult['uvs_id']&nbsp;==&nbsp;$recipient_id){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">527</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;created_by_me&nbsp;=&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>528</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">529</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;created_by_me&nbsp;=&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>530</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>531</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">532</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result;</span></code></td></tr><tr><td class="coverageDetails"><span>533</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>534</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>535</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//&nbsp;get&nbsp;shared&nbsp;doc&nbsp;info&nbsp;by&nbsp;doc&nbsp;id&nbsp;and&nbsp;recipient&nbsp;id</span></code></td></tr><tr><td class="coverageDetails"><span>536</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_shared_by_id($doc_id,&nbsp;$recipient_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">537</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">538</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$doc_id&nbsp;=&nbsp;(int)$doc_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">539</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$recipient_id&nbsp;=&nbsp;(int)$recipient_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">540</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;select&nbsp;*&nbsp;from&nbsp;doc_share&nbsp;where&nbsp;doc_id=:doc_id&nbsp;and&nbsp;uvs_id_recipient=:recipient_id&nbsp;and&nbsp;status&nbsp;!=&nbsp;'hidden'&nbsp;&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">541</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id,&nbsp;&quot;:recipient_id&quot;&nbsp;=&gt;&nbsp;$recipient_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">542</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">543</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!$result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">544</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;</span></code></td></tr><tr><td class="coverageDetails"><span>545</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">546</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_info&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">547</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_info-&gt;doc_id&nbsp;=&nbsp;$result['doc_id'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">548</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_info-&gt;doc_name_customized&nbsp;=&nbsp;$result['doc_name_customized'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">549</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_info-&gt;sender_id&nbsp;=&nbsp;$result['uvs_id_sender'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">550</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_info-&gt;recipient_id&nbsp;=&nbsp;$result['uvs_id_recipient'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">551</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_info-&gt;status&nbsp;=&nbsp;$result['status'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">552</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_info-&gt;sent_time&nbsp;=&nbsp;strtotime($result['sent_time']);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">553</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_info-&gt;sent_method&nbsp;=&nbsp;$result['sent_method'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">554</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_info-&gt;sent_location&nbsp;=&nbsp;$result['sent_location'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">555</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$shared_info;</span></code></td></tr><tr><td class="coverageDetails"><span>556</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>557</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>558</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>559</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//update&nbsp;file&nbsp;name&nbsp;in&nbsp;doc&nbsp;table&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>560</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;update_docname_by_id($doc_id,&nbsp;$new_name)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">561</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">562</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$doc_id&nbsp;=&nbsp;(int)$doc_id;</span></code></td></tr><tr><td class="coverageDetails"><span>563</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//update&nbsp;status&nbsp;to&nbsp;'hidden'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">564</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;doc&nbsp;SET&nbsp;doc_name_customized=:new_name&nbsp;WHERE&nbsp;doc_id&nbsp;=&nbsp;:doc_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">565</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:new_name&quot;&nbsp;=&gt;&nbsp;$new_name,&nbsp;&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">566</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">567</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$number&nbsp;=&nbsp;$result-&gt;num_affected_rows();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">568</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$number&nbsp;==&nbsp;1&nbsp;?&nbsp;true&nbsp;:&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>569</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>570</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>571</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//update&nbsp;shared&nbsp;file&nbsp;name&nbsp;in&nbsp;doc_shared&nbsp;table</span></code></td></tr><tr><td class="coverageDetails"><span>572</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;update_sharedname_by_id($doc_id,&nbsp;$uvs_id,&nbsp;$new_name)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">573</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">574</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$doc_id&nbsp;=&nbsp;(int)$doc_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">575</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span>576</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//update&nbsp;status&nbsp;to&nbsp;'hidden'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">577</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;doc_share&nbsp;SET&nbsp;doc_name_customized=:new_name&nbsp;WHERE&nbsp;doc_id&nbsp;=&nbsp;:doc_id&nbsp;and&nbsp;uvs_id_recipient=:uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">578</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:new_name&quot;&nbsp;=&gt;&nbsp;$new_name,&nbsp;&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id,&nbsp;&quot;:uvs_id&quot;&nbsp;=&gt;&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">579</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">580</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$number&nbsp;=&nbsp;$result-&gt;num_affected_rows();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">581</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$number&nbsp;==&nbsp;1&nbsp;?&nbsp;true&nbsp;:&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>582</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>583</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>584</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>585</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>586</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_shared_users($doc_id){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">587</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$doc_id&nbsp;=&nbsp;(int)$doc_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">588</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">589</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;select&nbsp;uvs_id_sender,&nbsp;uvs_id_recipient,&nbsp;UNIX_TIMESTAMP(sent_time)&nbsp;as&nbsp;sent_time&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+590</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;doc_share&nbsp;where&nbsp;doc_id=:doc_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">591</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">592</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$user_list&nbsp;=&nbsp;$conn-&gt;select_all($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">593</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$user_ids&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">594</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($user_list&nbsp;as&nbsp;$user){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">595</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user_ids[]&nbsp;=&nbsp;$user['uvs_id_sender'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">596</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user_ids[]&nbsp;=&nbsp;$user['uvs_id_recipient'];</span></code></td></tr><tr><td class="coverageDetails"><span>597</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">598</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$user_ids&nbsp;=&nbsp;array_unique($user_ids);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">599</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$users&nbsp;=&nbsp;implode(',',&nbsp;$user_ids);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">600</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;select&nbsp;first_name,&nbsp;last_name,&nbsp;uvs_id&nbsp;from&nbsp;account&nbsp;where&nbsp;uvs_id&nbsp;in&nbsp;(:users)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">601</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:users&quot;&nbsp;=&gt;&nbsp;$users);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">602</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$accounts&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">603</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(strlen($users)&nbsp;&gt;&nbsp;0){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">604</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$accounts&nbsp;=&nbsp;$conn-&gt;select_all($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span>605</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">606</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$user_names&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">607</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($accounts&nbsp;as&nbsp;$account){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">608</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(string)$account['uvs_id'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">609</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user_names-&gt;$uvs_id&nbsp;=&nbsp;$account['first_name']&nbsp;.&quot;&nbsp;&quot;&nbsp;.&nbsp;$account['last_name'];</span></code></td></tr><tr><td class="coverageDetails"><span>610</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">611</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span>612</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">613</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;foreach($user_list&nbsp;as&nbsp;$user){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">614</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">615</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;uvs_id_sender&nbsp;=&nbsp;$user['uvs_id_sender'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">616</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;uvs_id_recipient&nbsp;=&nbsp;$user['uvs_id_recipient'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">617</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;sent_time&nbsp;=&nbsp;$user['sent_time'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">618</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id_sender&nbsp;=&nbsp;(string)$user['uvs_id_sender'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">619</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;name_sender&nbsp;=&nbsp;$user_names-&gt;$uvs_id_sender;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">620</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id_recipient&nbsp;=&nbsp;(string)$user['uvs_id_recipient'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">621</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;name_recipient&nbsp;=&nbsp;$user_names-&gt;$uvs_id_recipient;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">622</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response[]&nbsp;=&nbsp;$item;</span></code></td></tr><tr><td class="coverageDetails"><span>623</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">624</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>625</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>626</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>627</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_list_users($doc_id,&nbsp;$uvs_id){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">628</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$doc_id&nbsp;=&nbsp;(int)$doc_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">629</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">630</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;select&nbsp;uvs_id_recipient,&nbsp;uvs_id_sender,&nbsp;UNIX_TIMESTAMP(sent_time)&nbsp;as&nbsp;sent_time,&nbsp;sent_method&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+631</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;doc_share&nbsp;where&nbsp;doc_id=:doc_id&nbsp;order&nbsp;by&nbsp;uvs_id_recipient,&nbsp;sent_time&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">632</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:doc_id&quot;&nbsp;=&gt;&nbsp;$doc_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">633</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$user_list&nbsp;=&nbsp;$conn-&gt;select_all($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">634</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!&nbsp;$user_list&nbsp;){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">635</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Array();</span></code></td></tr><tr><td class="coverageDetails"><span>636</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">637</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$sender_ids&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">638</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$recipient_ids&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">639</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($user_list&nbsp;as&nbsp;$user){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">640</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sender_ids[]&nbsp;=&nbsp;$user['uvs_id_sender'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">641</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$recipient_ids[]&nbsp;=&nbsp;$user['uvs_id_recipient'];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>642</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">643</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$sender_ids&nbsp;=&nbsp;array_unique($sender_ids);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">644</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$recipient_ids&nbsp;=&nbsp;array_unique($recipient_ids);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">645</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$senders&nbsp;=&nbsp;implode(',',&nbsp;$sender_ids);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">646</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;select&nbsp;first_name,&nbsp;last_name,&nbsp;uvs_id&nbsp;from&nbsp;account&nbsp;where&nbsp;uvs_id&nbsp;in&nbsp;(:senders)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">647</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(&quot;:senders&quot;&nbsp;=&gt;&nbsp;$senders);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">648</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$accounts&nbsp;=&nbsp;$conn-&gt;select_all($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">649</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$sender_names&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">650</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($accounts&nbsp;as&nbsp;$account){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">651</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$s_uvs_id&nbsp;=&nbsp;(string)$account['uvs_id'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">652</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sender_names-&gt;$s_uvs_id&nbsp;=&nbsp;$account['first_name']&nbsp;.&quot;&nbsp;&quot;&nbsp;.&nbsp;$account['last_name'];</span></code></td></tr><tr><td class="coverageDetails"><span>653</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">654</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$badges&nbsp;=&nbsp;Badge::find_by_uvs_ids($recipient_ids,&nbsp;Glob::$default_badge_settings[&quot;orgid&quot;]);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">655</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">656</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$previous&nbsp;=&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">657</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;foreach($user_list&nbsp;as&nbsp;$user){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">658</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($user['uvs_id_recipient']&nbsp;!=&nbsp;$previous){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">659</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$previous&nbsp;=&nbsp;$user['uvs_id_recipient'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">660</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">661</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;sent_time&nbsp;=&nbsp;(int)$user['sent_time'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">662</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id_sender&nbsp;=&nbsp;(string)$user['uvs_id_sender'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">663</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;sender_name&nbsp;=&nbsp;$sender_names-&gt;$uvs_id_sender;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">664</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;sent_method&nbsp;=&nbsp;$user['sent_method'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">665</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($user['uvs_id_sender']&nbsp;==&nbsp;$uvs_id){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">666</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;sent_by_creator&nbsp;=&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>667</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">668</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;sent_by_creator&nbsp;=&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>669</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">670</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id_recipient&nbsp;=&nbsp;(string)$user['uvs_id_recipient'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">671</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($badges[$uvs_id_recipient])){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">672</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;recipient&nbsp;=&nbsp;$badges[$uvs_id_recipient]-&gt;get_detail();</span></code></td></tr><tr><td class="coverageDetails"><span>673</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">674</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user_reserved&nbsp;=&nbsp;User::find_by_uvs_id($user['uvs_id_recipient']);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">675</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($user_reserved)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">676</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$email_accounts&nbsp;=&nbsp;$user_reserved-&gt;get_email_accounts();</span></code></td></tr><tr><td class="coverageDetails"><span>677</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">678</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($email_accounts)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">679</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;recipient&nbsp;=&nbsp;Badge::build_temprary_default_badge($user['uvs_id_recipient'],&nbsp;$email_accounts[0]-&gt;email)-&gt;get_detail();</span></code></td></tr><tr><td class="coverageDetails"><span>680</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">681</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;recipient&nbsp;=&nbsp;&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>682</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>683</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">684</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response[]&nbsp;=&nbsp;$item;</span></code></td></tr><tr><td class="coverageDetails"><span>685</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>686</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">687</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>688</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>689</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>690</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;update($conn,&nbsp;$query)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">691</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>692</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>693</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>694</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;assemble_active_log_params($doc,&nbsp;&amp;$user,&nbsp;&amp;$recipient,&nbsp;$method){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">695</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$log&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">696</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">697</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;name&nbsp;=&nbsp;&quot;name&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;$doc-&gt;doc_name;&nbsp;&nbsp;$log[]&nbsp;=&nbsp;$element;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">698</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">699</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;name&nbsp;=&nbsp;&quot;sharer&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;$user-&gt;get_first_name()&nbsp;.&nbsp;'&nbsp;'&nbsp;.&nbsp;$user-&gt;get_last_name();&nbsp;$log[]&nbsp;=&nbsp;$element;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">700</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">701</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;name&nbsp;=&nbsp;&quot;recipient&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;$recipient-&gt;get_first_name()&nbsp;.&nbsp;'&nbsp;'&nbsp;.&nbsp;$recipient-&gt;get_last_name()&nbsp;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">702</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($element-&gt;value)&nbsp;and&nbsp;strlen(trim($element-&gt;value))&nbsp;==&nbsp;0){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">703</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$email&nbsp;=&nbsp;$recipient-&gt;get_email();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">704</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$phone&nbsp;=&nbsp;$recipient-&gt;get_phone();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">705</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($email))</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">706</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;$email;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">707</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if(isset($phone))</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">708</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;$phone;</span></code></td></tr><tr><td class="coverageDetails"><span>709</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">710</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;&quot;New&nbsp;User&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>711</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">712</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$log[]&nbsp;=&nbsp;$element;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">713</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">714</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;name&nbsp;=&nbsp;&quot;doc_id&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;$doc-&gt;doc_id;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$log[]&nbsp;=&nbsp;$element;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">715</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">716</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;name&nbsp;=&nbsp;&quot;method&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;$method;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$log[]&nbsp;=&nbsp;$element;</span></code></td></tr><tr><td class="coverageDetails"><span>717</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span>718</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;name&nbsp;=&nbsp;&quot;doc_size&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;$doc-&gt;file_size;&nbsp;$log[]&nbsp;=&nbsp;$element;</span></code></td></tr><tr><td class="coverageDetails"><span>719</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span>720</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;name&nbsp;=&nbsp;&quot;doc_url&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;$doc-&gt;signed_file_url;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$log[]&nbsp;=&nbsp;$element;</span></code></td></tr><tr><td class="coverageDetails"><span>721</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span>722</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;name&nbsp;=&nbsp;&quot;thumbnail_url&quot;;&nbsp;$element-&gt;value&nbsp;=&nbsp;$doc-&gt;signed_thumbnail_url;&nbsp;$log[]&nbsp;=&nbsp;$element;</span></code></td></tr><tr><td class="coverageDetails"><span>723</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span>724</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;name&nbsp;=&nbsp;&quot;event_icon&quot;;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;&quot;img/ico_verifiedphone@2x.png&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$log[]&nbsp;=&nbsp;$element;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">725</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;json_encode($log);</span></code></td></tr><tr><td class="coverageDetails"><span>726</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>727</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>728</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;save_active_log($doc_id,&nbsp;$sender_id,&nbsp;$to_uvs_id,&nbsp;$method){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">729</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$active_logs&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span>730</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">731</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$doc&nbsp;=&nbsp;self::doc_by_id($doc_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">732</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sender&nbsp;=&nbsp;User::find_by_uvs_id($sender_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">733</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$recipient=&nbsp;User::find_by_uvs_id($to_uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">734</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params&nbsp;=&nbsp;self::assemble_active_log_params($doc,&nbsp;$sender,&nbsp;$recipient,&nbsp;$method);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">735</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_log&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">736</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($method&nbsp;==&nbsp;&quot;email&quot;){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">737</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_log-&gt;event_type&nbsp;=&nbsp;Activelog::$EVENT_TYPE_DOC_SHARED_EMAIL;</span></code></td></tr><tr><td class="coverageDetails"><span>738</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">739</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_log-&gt;event_type&nbsp;=&nbsp;Activelog::$EVENT_TYPE_DOC_SHARED_CODE;</span></code></td></tr><tr><td class="coverageDetails"><span>740</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">741</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_log-&gt;uvs_id&nbsp;=&nbsp;$sender_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">742</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_log-&gt;parameters&nbsp;=&nbsp;$params;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">743</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shared_log-&gt;event_icon&nbsp;=&nbsp;$recipient-&gt;get_profile_photo();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">744</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$active_logs[]&nbsp;=&nbsp;$shared_log;</span></code></td></tr><tr><td class="coverageDetails"><span>745</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">746</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$received_log&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">747</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($method&nbsp;==&nbsp;&quot;email&quot;){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">748</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$received_log-&gt;event_type&nbsp;=&nbsp;Activelog::$EVENT_TYPE_DOC_RECEIVED_EMAIL;</span></code></td></tr><tr><td class="coverageDetails"><span>749</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">750</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$received_log-&gt;event_type&nbsp;=&nbsp;Activelog::$EVENT_TYPE_DOC_RECEIVED_CODE;</span></code></td></tr><tr><td class="coverageDetails"><span>751</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">752</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$received_log-&gt;uvs_id&nbsp;=&nbsp;$to_uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">753</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$received_log-&gt;parameters&nbsp;=&nbsp;$params;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">754</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$received_log-&gt;event_icon&nbsp;=&nbsp;$sender-&gt;get_profile_photo();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">755</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$active_logs[]&nbsp;=&nbsp;$received_log;</span></code></td></tr><tr><td class="coverageDetails"><span>756</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">757</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User::add_active_logs($active_logs);</span></code></td></tr><tr><td class="coverageDetails"><span>758</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>759</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>760</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;share_history($doc_id,&nbsp;$uvs_id){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">761</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">762</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;select&nbsp;uvs_id_recipient,&nbsp;UNIX_TIMESTAMP(sent_time)&nbsp;as&nbsp;sent_time,&nbsp;sent_method&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+763</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;doc_share&nbsp;where&nbsp;doc_id=&nbsp;:doc_id&nbsp;and&nbsp;uvs_id_sender&nbsp;=&nbsp;:uvs_id&nbsp;order&nbsp;by&nbsp;uvs_id_recipient&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">764</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+765</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;':doc_id'&nbsp;=&gt;&nbsp;$doc_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+766</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;':uvs_id'&nbsp;=&gt;&nbsp;$uvs_id</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+767</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">768</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$user_list&nbsp;=&nbsp;$conn-&gt;select_all($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">769</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;if(!&nbsp;$user_list&nbsp;){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">770</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Array();</span></code></td></tr><tr><td class="coverageDetails"><span>771</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">772</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$recipient_ids&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">773</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($user_list&nbsp;as&nbsp;$user){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">774</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$recipient_ids[]&nbsp;=&nbsp;$user['uvs_id_recipient'];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>775</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">776</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$recipients&nbsp;=&nbsp;implode(','&nbsp;,&nbsp;$recipient_ids);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">777</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;select&nbsp;account.uvs_id&nbsp;as&nbsp;uvs_id,&nbsp;account.first_name&nbsp;as&nbsp;first_name,&nbsp;account.last_name&nbsp;as&nbsp;last_name,&nbsp;email.email,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+778</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;img.profile_photo_url&nbsp;as&nbsp;profile_photo,&nbsp;img.facebook_photo_url&nbsp;as&nbsp;fb_photo&nbsp;from&nbsp;account&nbsp;left&nbsp;join&nbsp;account_image&nbsp;img</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+779</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;img.uvs_id&nbsp;=&nbsp;account.uvs_id&nbsp;left&nbsp;join&nbsp;account_email&nbsp;email&nbsp;on&nbsp;email.uvs_id=account.uvs_id&nbsp;and&nbsp;email.is_primary=1&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+780</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;account.uvs_id&nbsp;in&nbsp;(&nbsp;$recipients&nbsp;)&nbsp;order&nbsp;by&nbsp;uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">781</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$attr&nbsp;=&nbsp;array(':recipients'&nbsp;=&gt;&nbsp;$recipients);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">782</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$profiles&nbsp;=&nbsp;$conn-&gt;select_all($query,&nbsp;$attr);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">783</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($user_list&nbsp;as&nbsp;$id&nbsp;=&gt;&nbsp;&amp;$user){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">784</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$profile&nbsp;=&nbsp;$profiles[$id];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">785</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user['first_name']&nbsp;=&nbsp;$profile['first_name'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">786</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user['last_name']&nbsp;=&nbsp;$profile['last_name'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">787</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user['profile_photo']&nbsp;=&nbsp;$profile['profile_photo'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">788</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user['fb_photo']&nbsp;=&nbsp;$profile['fb_photo'];&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">789</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($user['first_name'])&nbsp;and&nbsp;!isset($user['last_name'])){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">790</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user['first_name']&nbsp;=&nbsp;$profile['email'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">791</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user['last_name']&nbsp;=&nbsp;&quot;&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>792</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>793</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">794</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$is_owner&nbsp;=&nbsp;Doc::is_doc_owner($doc_id,&nbsp;$uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">795</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">796</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;foreach($user_list&nbsp;as&nbsp;$id&nbsp;=&gt;&nbsp;&amp;$user){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">797</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">798</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;sent_time&nbsp;=&nbsp;(int)$user['sent_time'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">799</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;sent_method&nbsp;=&nbsp;$user['sent_method'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">800</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($is_owner){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">801</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;sent_by_creator&nbsp;=&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>802</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">803</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;sent_by_creator&nbsp;=&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>804</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">805</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;recipient&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">806</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;recipient-&gt;first_name&nbsp;=&nbsp;$user['first_name'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">807</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;recipient-&gt;last_name&nbsp;=&nbsp;$user['last_name'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">808</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;recipient-&gt;profile_photo&nbsp;=&nbsp;$user['profile_photo'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">809</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item-&gt;recipient-&gt;fb_photo&nbsp;=&nbsp;$user['fb_photo'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">810</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response[]&nbsp;=&nbsp;$item;</span></code></td></tr><tr><td class="coverageDetails"><span>811</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">812</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;usort($response,&nbsp;function($a,&nbsp;$b){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">813</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($a-&gt;sent_time&nbsp;==&nbsp;$b-&gt;sent_time)&nbsp;return&nbsp;0;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">814</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;($a-&gt;sent_time&nbsp;&gt;&nbsp;$b-&gt;sent_time)&nbsp;?&nbsp;-1&nbsp;:&nbsp;1;</span></code></td></tr><tr><td class="coverageDetails"><span>815</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;});</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">816</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;</span></code></td></tr><tr><td class="coverageDetails"><span>817</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>818</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>819</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>}</span></code></td></tr><tr><td class="coverageDetails"><span>820</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>?&gt;</span></code></td></tr></table></td></tr>
  </table>

    </div>
  </body>
</html>
