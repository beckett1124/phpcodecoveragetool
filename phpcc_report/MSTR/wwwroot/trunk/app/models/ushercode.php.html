<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Spike PHPCoverage Details: ushercode.php</title> 
    <link href="../../../../..//css/spikesource.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="pageBox" >

      <table border="0" cellpadding="2" cellspacing="0" id="contentBox" width="100%">
        <tr>
          <td align="left" valign="top"><h1>Spike PHPCoverage Details: ushercode.php</h1>
          </td>
        </tr>
        <tr>
          <td>

<table width="100%" border="0" cellpadding="2" cellspacing="0"><td width="10%"class="coverageDetailsHead" >Line #</td><td width="10%" class="coverageDetailsHead">Frequency</td><td  width="80%" class="coverageDetailsHead">Source Line</td><tr><td class="coverageDetails"><span>1</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&lt;?php&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>2</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">3</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">define(&quot;USHER_CODE_LENGTH&quot;,&nbsp;&quot;4&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">4</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">define(&quot;USHER_CODE_EXPIRATION&quot;,&nbsp;120);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">5</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">define(&quot;DISABLE_DELAY&quot;,&nbsp;5);</span></code></td></tr><tr><td class="coverageDetails"><span>6</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>7</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>Class&nbsp;UsherCode{</span></code></td></tr><tr><td class="coverageDetails"><span>8</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;$code,&nbsp;$expiration,&nbsp;$asset_id,&nbsp;$asset_type,&nbsp;$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span>9</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>10</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;__construct($code)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">11</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;code&nbsp;=&nbsp;$code;</span></code></td></tr><tr><td class="coverageDetails"><span>12</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>13</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>14</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;create($uvs_id,&nbsp;$asset_id,&nbsp;$asset_type,&nbsp;$ttl,&nbsp;$extra_info=NULL)&nbsp;{&nbsp;&nbsp;//ignore&nbsp;$ttl&nbsp;now</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">15</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ttl&nbsp;=&nbsp;USHER_CODE_EXPIRATION;</span></code></td></tr><tr><td class="coverageDetails"><span>16</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//do&nbsp;table&nbsp;cleanup&nbsp;if&nbsp;needed</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">17</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">18</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;COUNT(*)&nbsp;AS&nbsp;row_num&nbsp;FROM&nbsp;usher_code&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">19</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">20</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if((int)$result['row_num']&nbsp;&gt;&nbsp;pow(10,&nbsp;USHER_CODE_LENGTH)&nbsp;/&nbsp;2&nbsp;)&nbsp;{&nbsp;//more&nbsp;than&nbsp;half&nbsp;space&nbsp;occupied</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">21</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$now&nbsp;=&nbsp;strtotime(&quot;now&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">22</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;select&nbsp;code&nbsp;FROM&nbsp;usher_code&nbsp;WHERE&nbsp;expiration&nbsp;&lt;&nbsp;$now&nbsp;-&nbsp;$ttl&nbsp;*&nbsp;2&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">23</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$results&nbsp;=&nbsp;$conn-&gt;select_all($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">24</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$codes&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">25</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($results&nbsp;as&nbsp;$row){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">26</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array_push($codes,&nbsp;$row['code']);</span></code></td></tr><tr><td class="coverageDetails"><span>27</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">28</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($codes){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">29</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$codes&nbsp;=&nbsp;implode(&quot;,&quot;,&nbsp;$codes);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">30</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;delete&nbsp;from&nbsp;usher_code&nbsp;where&nbsp;code&nbsp;in&nbsp;($codes)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">31</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>32</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>33</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>34</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">35</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$code&nbsp;=&nbsp;self::generate_usher_code();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">36</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ushercode&nbsp;=&nbsp;new&nbsp;self($code);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">37</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$expiration&nbsp;=&nbsp;strtotime(&quot;+$ttl&nbsp;seconds&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>38</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*$row&nbsp;=&nbsp;$conn-&gt;select_first(&quot;select&nbsp;UNIX_TIMESTAMP(date_add(now(),interval&nbsp;$ttl&nbsp;second))&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>39</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($row&nbsp;as&nbsp;$name&nbsp;=&gt;&nbsp;$value){</span></code></td></tr><tr><td class="coverageDetails"><span>40</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$expiration&nbsp;=&nbsp;$value;</span></code></td></tr><tr><td class="coverageDetails"><span>41</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ushercode-&gt;expiration&nbsp;=&nbsp;$expiration;</span></code></td></tr><tr><td class="coverageDetails"><span>42</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}*/</span></code></td></tr><tr><td class="coverageDetails"><span>43</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">44</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ushercode-&gt;expiration&nbsp;=&nbsp;$expiration;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">45</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ushercode-&gt;asset_id&nbsp;=&nbsp;$asset_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">46</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ushercode-&gt;asset_type&nbsp;=&nbsp;$asset_type;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">47</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ushercode-&gt;uvs_id&nbsp;=&nbsp;$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">48</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isset($extra_info)){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">49</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$extra_info&nbsp;=&nbsp;&quot;&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>50</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">51</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;'REPLACE&nbsp;INTO&nbsp;usher_code(code,&nbsp;expiration,&nbsp;asset_id,&nbsp;asset_type,&nbsp;uvs_id,&nbsp;extra_info)&nbsp;VALUES('</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+52</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.$conn-&gt;escape($code).',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+53</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.$conn-&gt;escape($expiration).',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+54</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.$conn-&gt;escape($asset_id).',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+55</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.$conn-&gt;escape($asset_type).',&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+56</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.$conn-&gt;escape($uvs_id).','</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+57</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.$conn-&gt;escape($extra_info).')';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">58</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">59</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">60</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;code&nbsp;=&nbsp;$code;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">61</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;expiration&nbsp;=&nbsp;$expiration;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">62</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result;</span></code></td></tr><tr><td class="coverageDetails"><span>63</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>64</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>65</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;verify_code($code)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">66</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">67</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$now&nbsp;=&nbsp;strtotime(&quot;now&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">68</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i_code&nbsp;=&nbsp;$conn-&gt;escape($code);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">69</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;asset_id,&nbsp;asset_type,&nbsp;uvs_id,&nbsp;extra_info&nbsp;from&nbsp;usher_code&nbsp;where&nbsp;code&nbsp;=&nbsp;$i_code&nbsp;AND&nbsp;expiration&nbsp;&gt;&nbsp;$now&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">70</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row&nbsp;=&nbsp;$conn-&gt;select_first($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">71</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($row){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">72</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row['asset_id']&nbsp;=&nbsp;(int)$row['asset_id'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">73</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row['uvs_id']&nbsp;=&nbsp;(int)$row['uvs_id'];</span></code></td></tr><tr><td class="coverageDetails"><span>74</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">75</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$row;</span></code></td></tr><tr><td class="coverageDetails"><span>76</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>77</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>78</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find($code)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">79</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">80</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;code,&nbsp;expiration,&nbsp;asset_id,&nbsp;asset_type,&nbsp;uvs_id,&nbsp;extra_info&nbsp;from&nbsp;usher_code&nbsp;where&nbsp;code&nbsp;=&nbsp;$code&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">81</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;$rows&nbsp;=&nbsp;$conn-&gt;select_all($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">82</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($rows&nbsp;as&nbsp;&amp;$row){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">83</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row['expiration']&nbsp;=&nbsp;(int)$row['expiration'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">84</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row['asset_id']&nbsp;=&nbsp;(int)$row['asset_id'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">85</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row['uvs_id']&nbsp;=&nbsp;(int)$row['uvs_id'];</span></code></td></tr><tr><td class="coverageDetails"><span>86</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">87</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$rows;</span></code></td></tr><tr><td class="coverageDetails"><span>88</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>89</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>90</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;delete($code)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">91</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!is_numeric($code))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">92</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>93</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">94</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">95</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;FROM&nbsp;usher_code&nbsp;WHERE&nbsp;code&nbsp;=&nbsp;$code&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">96</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">97</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>98</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>99</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>100</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;disable($code)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">101</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!is_numeric($code))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">102</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>103</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">104</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">105</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$expiration_time&nbsp;=&nbsp;strtotime('+'&nbsp;.&nbsp;DISABLE_DELAY&nbsp;.&nbsp;'seconds');</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">106</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;usher_code&nbsp;SET&nbsp;expiration&nbsp;=&nbsp;$expiration_time&nbsp;WHERE&nbsp;code&nbsp;=&nbsp;$code&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">107</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">108</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;</span></code></td></tr><tr><td class="coverageDetails"><span>109</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>110</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>111</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;private&nbsp;static&nbsp;function&nbsp;generate_usher_code()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">112</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">113</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$code&nbsp;=&nbsp;(int)Util::gen_random('n',&nbsp;USHER_CODE_LENGTH);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">114</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;while(self::find($code));</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">115</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$code;</span></code></td></tr><tr><td class="coverageDetails"><span>116</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>117</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>}</span></code></td></tr><tr><td class="coverageDetails"><span>118</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>?&gt;</span></code></td></tr></table></td></tr>
  </table>

    </div>
  </body>
</html>
