<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Spike PHPCoverage Details: device.php</title> 
    <link href="../../../../..//css/spikesource.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="pageBox" >

      <table border="0" cellpadding="2" cellspacing="0" id="contentBox" width="100%">
        <tr>
          <td align="left" valign="top"><h1>Spike PHPCoverage Details: device.php</h1>
          </td>
        </tr>
        <tr>
          <td>

<table width="100%" border="0" cellpadding="2" cellspacing="0"><td width="10%"class="coverageDetailsHead" >Line #</td><td width="10%" class="coverageDetailsHead">Frequency</td><td  width="80%" class="coverageDetailsHead">Source Line</td><tr><td class="coverageDetails"><span>1</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&lt;?php</span></code></td></tr><tr><td class="coverageDetails"><span>2</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetails"><span class="codeExecuted">5</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">define(&quot;ACTIVATION_CODE_EXPIRATION&quot;,&nbsp;259200);&nbsp;//3days</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetails"><span class="codeExecuted">5</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">define(&quot;ACTIVATION_CODE_LENGTH&quot;,6);</span></code></td></tr><tr><td class="coverageDetails"><span>5</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>6</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>Class&nbsp;Device{</span></code></td></tr><tr><td class="coverageDetails"><span>7</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;$id,&nbsp;$uvs_id,&nbsp;$device_id,&nbsp;$status,&nbsp;$device_name,&nbsp;$create_time,&nbsp;$activation_time,&nbsp;$update_time,&nbsp;$p12,&nbsp;$device_uid;</span></code></td></tr><tr><td class="coverageDetails"><span>8</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>9</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>10</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;function&nbsp;__construct($id,&nbsp;$uvs_id,&nbsp;$device_id,&nbsp;$device_uid,&nbsp;$device_name,&nbsp;$status,&nbsp;$create_time,&nbsp;$activation_time,&nbsp;$update_time)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">11</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;id&nbsp;=&nbsp;$id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">12</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;uvs_id&nbsp;=&nbsp;$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">13</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;device_id&nbsp;=&nbsp;$device_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">14</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;device_uid&nbsp;=&nbsp;$device_uid;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">15</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;status&nbsp;=&nbsp;$status;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">16</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;device_name&nbsp;=&nbsp;$device_name;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">17</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;create_time&nbsp;=&nbsp;$create_time;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">18</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;activation_time&nbsp;=&nbsp;$activation_time;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">19</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;update_time&nbsp;=&nbsp;$update_time;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">20</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;p12&nbsp;=&nbsp;null;</span></code></td></tr><tr><td class="coverageDetails"><span>21</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>22</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>23</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;create($uvs_id,&nbsp;$device_name&nbsp;=&nbsp;null,&nbsp;$device_uid&nbsp;=&nbsp;null)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">24</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">25</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($uvs_id&nbsp;&gt;=&nbsp;0)&nbsp;{&nbsp;return&nbsp;null;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">26</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>27</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">28</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device_id&nbsp;=&nbsp;self::get_next_device_id($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span>29</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">30</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;user_device&nbsp;(uvs_id,&nbsp;user_device_id,&nbsp;device_uid,&nbsp;device_name,&nbsp;create_time)&nbsp;&quot;.</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+31</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;values&nbsp;(&nbsp;:uvs_id,&nbsp;:device_id,&nbsp;:device_uid,&nbsp;:device_name,&nbsp;now()&nbsp;)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">32</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$data&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+33</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:uvs_id&quot;=&gt;$uvs_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+34</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:device_id&quot;=&gt;$device_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+35</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:device_uid&quot;=&gt;$device_uid,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+36</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:device_name&quot;=&gt;$device_name</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+37</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">);</span></code></td></tr><tr><td class="coverageDetails"><span>38</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">39</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$result&nbsp;=&nbsp;$conn-&gt;execute($query&nbsp;,&nbsp;$data);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">40</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$result-&gt;num_affected_rows()&nbsp;&gt;&nbsp;0&nbsp;){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">41</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self::find($uvs_id,&nbsp;$device_id);</span></code></td></tr><tr><td class="coverageDetails"><span>42</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>43</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>44</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>45</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>46</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;create_and_activate($uvs_id,&nbsp;$email,&nbsp;$passphrase,&nbsp;$device_name=null,&nbsp;$device_uid=null)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>47</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;device_uid&nbsp;is&nbsp;devices&nbsp;mac&nbsp;address&nbsp;for&nbsp;now</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">48</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">49</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">50</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($uvs_id&nbsp;&nbsp;&gt;=&nbsp;0&nbsp;)&nbsp;{&nbsp;return&nbsp;null;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>51</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">52</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device_id&nbsp;=&nbsp;self::get_next_device_id($uvs_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">53</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$certificate&nbsp;=&nbsp;KSConnector::get_certificate($uvs_id,&nbsp;$email,&nbsp;$device_id,&nbsp;$passphrase);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">54</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;!&nbsp;$certificate-&gt;p12&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>55</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>56</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">57</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;user_device&nbsp;(uvs_id,&nbsp;user_device_id,&nbsp;device_uid,&nbsp;device_name,&nbsp;status,&nbsp;create_time,&nbsp;activation_time)&nbsp;&quot;.</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+58</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;values&nbsp;(&nbsp;:uvs_id,&nbsp;:device_id,&nbsp;:device_uid,&nbsp;:device_name,&nbsp;'active',&nbsp;now(),&nbsp;now()&nbsp;)&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">59</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$data&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+60</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:uvs_id&quot;=&gt;$uvs_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+61</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:device_id&quot;=&gt;$device_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+62</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:device_uid&quot;=&gt;$device_uid,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+63</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:device_name&quot;=&gt;$device_name</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+64</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">);</span></code></td></tr><tr><td class="coverageDetails"><span>65</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">66</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$result&nbsp;=&nbsp;$conn-&gt;execute($query&nbsp;,&nbsp;$data);</span></code></td></tr><tr><td class="coverageDetails"><span>67</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">68</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$result-&gt;num_affected_rows()&nbsp;&gt;&nbsp;0&nbsp;){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">69</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device&nbsp;=&nbsp;self::find($uvs_id,&nbsp;$device_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">70</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device-&gt;set_p12($certificate-&gt;p12);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">71</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$device;</span></code></td></tr><tr><td class="coverageDetails"><span>72</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>73</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>74</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>75</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>76</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;generate_activation_code()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>77</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">78</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$code&nbsp;=&nbsp;Util::gen_random('n',&nbsp;ACTIVATION_CODE_LENGTH);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">79</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;uvs_id&nbsp;&nbsp;&gt;=&nbsp;0&nbsp;)&nbsp;{&nbsp;return&nbsp;null;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">80</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">81</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device_id&nbsp;=&nbsp;(int)$this-&gt;device_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">82</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$this-&gt;uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">83</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$expiration&nbsp;=&nbsp;time()&nbsp;+&nbsp;ACTIVATION_CODE_EXPIRATION;</span></code></td></tr><tr><td class="coverageDetails"><span>84</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">85</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;device_activation&nbsp;(uvs_id,&nbsp;user_device_id,&nbsp;activation_code,&nbsp;expiration)&nbsp;VALUES</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+86</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(:uvs_id,&nbsp;:device_id,&nbsp;:code,&nbsp;FROM_UNIXTIME($expiration))&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">87</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$data&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+88</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:uvs_id&quot;=&gt;$uvs_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+89</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:device_id&quot;=&gt;$device_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+90</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:code&quot;=&gt;$code</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+91</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">);</span></code></td></tr><tr><td class="coverageDetails"><span>92</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">93</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$result&nbsp;=&nbsp;$conn-&gt;execute($query&nbsp;,&nbsp;$data);</span></code></td></tr><tr><td class="coverageDetails"><span>94</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">95</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$result-&gt;num_affected_rows()&nbsp;&gt;&nbsp;0&nbsp;){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">96</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$code;</span></code></td></tr><tr><td class="coverageDetails"><span>97</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">98</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;</span></code></td></tr><tr><td class="coverageDetails"><span>99</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>100</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>101</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>102</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>103</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;function&nbsp;find($uvs_id,&nbsp;$device_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">104</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">105</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device_id&nbsp;=&nbsp;(int)$device_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">106</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($uvs_id&nbsp;&nbsp;&gt;=&nbsp;0)&nbsp;{&nbsp;return&nbsp;null;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">107</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>108</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">109</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;id,&nbsp;uvs_id,&nbsp;user_device_id,&nbsp;device_uid,&nbsp;device_name,&nbsp;status,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+110</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(create_time)&nbsp;as&nbsp;create_time,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+111</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(activation_time)&nbsp;as&nbsp;activation_time,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+112</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(update_time)&nbsp;as&nbsp;update_time&nbsp;FROM&nbsp;user_device&nbsp;WHERE&nbsp;uvs_id=:uvs_id&nbsp;AND&nbsp;user_device_id=:device_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">113</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$data&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+114</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:uvs_id&quot;=&gt;$uvs_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+115</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:device_id&quot;=&gt;$device_id</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+116</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">);</span></code></td></tr><tr><td class="coverageDetails"><span>117</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>118</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">119</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$result&nbsp;=&nbsp;$conn-&gt;select_first($query&nbsp;,&nbsp;$data);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">120</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$result&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">121</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device&nbsp;=&nbsp;new&nbsp;self(&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">122</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;id&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">123</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;uvs_id&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">124</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;user_device_id&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+125</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;device_uid&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+126</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;device_name&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+127</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;status&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+128</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;create_time&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+129</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;activation_time&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+130</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;update_time&quot;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+131</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">132</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$device;</span></code></td></tr><tr><td class="coverageDetails"><span>133</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>134</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>135</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>136</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>137</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;function&nbsp;find_all($uvs_id,&nbsp;$skip_deleted=true)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">138</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">139</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($uvs_id&nbsp;&nbsp;&gt;=&nbsp;0)&nbsp;{&nbsp;return&nbsp;null;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">140</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>141</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">142</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$query&nbsp;=&nbsp;&quot;SELECT&nbsp;id,&nbsp;uvs_id,&nbsp;user_device_id,&nbsp;device_uid,&nbsp;device_name,&nbsp;status,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+143</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(create_time)&nbsp;as&nbsp;create_time,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+144</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(activation_time)&nbsp;as&nbsp;activation_time,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+145</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(update_time)&nbsp;as&nbsp;update_time&nbsp;FROM&nbsp;user_device&nbsp;WHERE&nbsp;uvs_id=:uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">146</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$data&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+147</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:uvs_id&quot;=&gt;$uvs_id</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+148</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">149</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$skip_deleted&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">150</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;.=&nbsp;&quot;&nbsp;AND&nbsp;status&nbsp;in&nbsp;('pending',&nbsp;'active')&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>151</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">152</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$conn-&gt;execute($query&nbsp;,&nbsp;$data);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">153</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$devices&nbsp;=&nbsp;Array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">154</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(&nbsp;$row&nbsp;=&nbsp;$result-&gt;fetch_row()&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>155</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">156</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device&nbsp;=&nbsp;new&nbsp;self(&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">157</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$row[&quot;id&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">158</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$row[&quot;uvs_id&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">159</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$row[&quot;user_device_id&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+160</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row[&quot;device_uid&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+161</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row[&quot;device_name&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+162</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row[&quot;status&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">163</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$row[&quot;create_time&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">164</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$row[&quot;activation_time&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">165</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$row[&quot;update_time&quot;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+166</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">167</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$devices[]&nbsp;=&nbsp;$device;</span></code></td></tr><tr><td class="coverageDetails"><span>168</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">169</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$devices;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>170</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>171</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>172</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_device_uid($uvs_id,&nbsp;$device_uid)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">173</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">174</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($uvs_id&nbsp;&nbsp;&gt;=&nbsp;0)&nbsp;{&nbsp;return&nbsp;null;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">175</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>176</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">177</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$query&nbsp;=&nbsp;&quot;SELECT&nbsp;id,&nbsp;uvs_id,&nbsp;user_device_id,&nbsp;device_uid,&nbsp;device_name,&nbsp;status,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+178</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(create_time)&nbsp;as&nbsp;create_time,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+179</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(activation_time)&nbsp;as&nbsp;activation_time,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+180</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(update_time)&nbsp;as&nbsp;update_time&nbsp;FROM&nbsp;user_device&nbsp;WHERE&nbsp;uvs_id=:uvs_id&nbsp;AND&nbsp;device_uid=:device_uid_esc&nbsp;and&nbsp;status='active'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">181</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$data&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+182</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:uvs_id&quot;=&gt;$uvs_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+183</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:device_uid_esc&quot;=&gt;$device_uid_esc</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+184</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">);</span></code></td></tr><tr><td class="coverageDetails"><span>185</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">186</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$result&nbsp;=&nbsp;$conn-&gt;select_first($query&nbsp;,&nbsp;$data);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">187</span></td><td class="coverageDetails"><span class="codeExecuted">3</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$result&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">188</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device&nbsp;=&nbsp;new&nbsp;self(&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">189</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;id&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">190</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;uvs_id&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">191</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;user_device_id&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+192</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;device_uid&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+193</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;device_name&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+194</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;status&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">195</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;create_time&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">196</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;activation_time&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">197</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;update_time&quot;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+198</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">199</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$device;</span></code></td></tr><tr><td class="coverageDetails"><span>200</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>201</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>202</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>203</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;find_by_device_name($uvs_id,&nbsp;$device_name)&nbsp;{&nbsp;&nbsp;//assume&nbsp;device&nbsp;name&nbsp;must&nbsp;unique</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">204</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">205</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($uvs_id&nbsp;&nbsp;&gt;=&nbsp;0)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">206</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;</span></code></td></tr><tr><td class="coverageDetails"><span>207</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">208</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>209</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">210</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;id,&nbsp;uvs_id,&nbsp;user_device_id,&nbsp;device_uid,&nbsp;device_name,&nbsp;status,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+211</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(create_time)&nbsp;as&nbsp;create_time,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+212</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(activation_time)&nbsp;as&nbsp;activation_time,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+213</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIX_TIMESTAMP(update_time)&nbsp;as&nbsp;update_time&nbsp;FROM&nbsp;user_device&nbsp;WHERE&nbsp;uvs_id=:uvs_id&nbsp;AND&nbsp;device_name=:device_name_esc&nbsp;and&nbsp;status='active'&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">214</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$data&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+215</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:uvs_id&quot;=&gt;$uvs_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+216</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:device_name_esc&quot;=&gt;$device_name_esc</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+217</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">);</span></code></td></tr><tr><td class="coverageDetails"><span>218</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">219</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$result&nbsp;=&nbsp;$conn-&gt;select_first($query&nbsp;,&nbsp;$data);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">220</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$result&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">221</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device&nbsp;=&nbsp;new&nbsp;self(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">222</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;id&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">223</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;uvs_id&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">224</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;user_device_id&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+225</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;device_uid&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+226</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;device_name&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+227</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;status&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">228</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;create_time&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">229</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;activation_time&quot;],</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">230</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)$result[&quot;update_time&quot;]</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+231</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">232</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$device;</span></code></td></tr><tr><td class="coverageDetails"><span>233</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>234</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>235</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>236</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;function&nbsp;get_next_device_id($uvs_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">237</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">238</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($uvs_id&nbsp;&nbsp;&gt;=&nbsp;0)&nbsp;{&nbsp;return&nbsp;null;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">239</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>240</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">241</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;max(user_device_id)&nbsp;as&nbsp;user_device_id&nbsp;from&nbsp;user_device&nbsp;where&nbsp;uvs_id&nbsp;=&nbsp;:uvs_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">242</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$data&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+243</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:uvs_id&quot;=&gt;$uvs_id</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+244</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">);</span></code></td></tr><tr><td class="coverageDetails"><span>245</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">246</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$result&nbsp;=&nbsp;$conn-&gt;select_first($query&nbsp;,&nbsp;$data);</span></code></td></tr><tr><td class="coverageDetails"><span>247</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">248</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($result)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">249</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result['user_device_id']&nbsp;=&nbsp;(int)$result['user_device_id'];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">250</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;isset($result['user_device_id'])&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">251</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result['user_device_id']&nbsp;+&nbsp;1;</span></code></td></tr><tr><td class="coverageDetails"><span>252</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>253</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">254</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;</span></code></td></tr><tr><td class="coverageDetails"><span>255</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>256</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>257</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>258</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;activate($uvs_id,&nbsp;$code,&nbsp;$device_name,&nbsp;$email,&nbsp;$passphrase,&nbsp;$device_uid)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">259</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span>260</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">261</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($uvs_id&nbsp;&nbsp;&gt;=&nbsp;0)&nbsp;{&nbsp;return&nbsp;null;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">262</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>263</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>264</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>265</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//check&nbsp;if&nbsp;the&nbsp;device&nbsp;is&nbsp;already&nbsp;activated</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">266</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(Device::find_by_device_uid($uvs_id,&nbsp;$device_uid))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">267</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerDeviceAlreadyActivatedException(&quot;This&nbsp;device&nbsp;already&nbsp;activated&quot;);</span></code></td></tr><tr><td class="coverageDetails"><span>268</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>269</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">270</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;FROM&nbsp;device_activation&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+271</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;&nbsp;uvs_id=:uvs_id&nbsp;AND&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+272</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;activation_code=:code&nbsp;AND&nbsp;expiration&gt;=now()&quot;;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">273</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$data&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+274</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:uvs_id&quot;=&gt;$uvs_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+275</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:code&quot;=&gt;$code</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+276</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">);</span></code></td></tr><tr><td class="coverageDetails"><span>277</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">278</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$result&nbsp;=&nbsp;$conn-&gt;select_first($query&nbsp;,&nbsp;$data);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">279</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$result&nbsp;){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">280</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device_id&nbsp;=&nbsp;(int)$result[&quot;user_device_id&quot;];</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">281</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device&nbsp;=&nbsp;Device::find($uvs_id,&nbsp;$device_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">282</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($device-&gt;get_device_uid()&nbsp;!=&nbsp;$device_uid)&nbsp;{&nbsp;//actvation&nbsp;code&nbsp;is&nbsp;not&nbsp;for&nbsp;this&nbsp;device</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">283</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;</span></code></td></tr><tr><td class="coverageDetails"><span>284</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">285</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;Device::find_by_device_name($uvs_id,&nbsp;$device_name)&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">286</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ControllerDeviceNameAlreadyExistsException('Device&nbsp;Name&nbsp;already&nbsp;exists,&nbsp;must&nbsp;be&nbsp;unique');</span></code></td></tr><tr><td class="coverageDetails"><span>287</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>288</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">289</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$certificate&nbsp;=&nbsp;KSConnector::get_certificate($uvs_id,&nbsp;$email,&nbsp;$device_id,&nbsp;$passphrase);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">290</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;!&nbsp;$certificate-&gt;p12&nbsp;)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>291</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>292</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">293</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;user_device&nbsp;SET&nbsp;status='active',&nbsp;activation_time=now(),</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+294</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;device_name&nbsp;=&nbsp;:device_name_esc,&nbsp;device_uid&nbsp;=&nbsp;:device_uid_esc</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+295</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;uvs_id=:uvs_id&nbsp;and&nbsp;user_device_id=:device_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">296</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$data&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+297</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:device_name_esc&quot;=&gt;$device_name,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+298</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:device_uid_esc&quot;=&gt;$device_uid,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+299</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:uvs_id&quot;=&gt;$uvs_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+300</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:device_id&quot;=&gt;$device_id</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+301</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">);</span></code></td></tr><tr><td class="coverageDetails"><span>302</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">303</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$result&nbsp;=&nbsp;$conn-&gt;execute($query&nbsp;,&nbsp;$data);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">304</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$result-&gt;num_affected_rows()&nbsp;&gt;&nbsp;0&nbsp;){</span></code></td></tr><tr><td class="coverageDetails"><span>305</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;DELETE&nbsp;used&nbsp;activation_code</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">306</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;DELETE&nbsp;from&nbsp;device_activation</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+307</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;&nbsp;uvs_id=:uvs_id&nbsp;AND&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+308</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;activation_code=:code&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">309</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$data&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+310</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:uvs_id&quot;=&gt;$uvs_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+311</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:code&quot;=&gt;$code</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+312</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">);</span></code></td></tr><tr><td class="coverageDetails"><span>313</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">314</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$result&nbsp;=&nbsp;$conn-&gt;execute($query&nbsp;,&nbsp;$data);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">315</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device&nbsp;=&nbsp;self::find($uvs_id,&nbsp;$device_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">316</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device-&gt;set_p12($certificate-&gt;p12);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">317</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::save_active_log($device,&nbsp;Activelog::$EVENT_TYPE_DEVICE_ACTIVATION);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">318</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$device;</span></code></td></tr><tr><td class="coverageDetails"><span>319</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>320</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">321</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;</span></code></td></tr><tr><td class="coverageDetails"><span>322</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>323</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>324</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;get_id()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">325</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;id;</span></code></td></tr><tr><td class="coverageDetails"><span>326</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>327</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>328</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;get_uvs_id()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">329</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span>330</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>331</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>332</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;get_status()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">333</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;status;</span></code></td></tr><tr><td class="coverageDetails"><span>334</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>335</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>336</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;get_device_name()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">337</span></td><td class="coverageDetails"><span class="codeExecuted">4</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;device_name;</span></code></td></tr><tr><td class="coverageDetails"><span>338</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>339</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>340</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;get_device_id()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">341</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;device_id;</span></code></td></tr><tr><td class="coverageDetails"><span>342</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>343</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>344</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;get_device_uid()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">345</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;device_uid;</span></code></td></tr><tr><td class="coverageDetails"><span>346</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>347</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>348</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;get_create_time()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">349</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;create_time;</span></code></td></tr><tr><td class="coverageDetails"><span>350</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>351</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>352</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;get_activation_time()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">353</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;activation_time;</span></code></td></tr><tr><td class="coverageDetails"><span>354</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>355</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>356</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;get_update_time()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">357</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;update_time;</span></code></td></tr><tr><td class="coverageDetails"><span>358</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>359</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>360</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;set_p12($p12)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">361</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;p12&nbsp;=&nbsp;$p12;</span></code></td></tr><tr><td class="coverageDetails"><span>362</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>363</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>364</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;get_for_json()&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">365</span></td><td class="coverageDetails"><span class="codeExecuted">2</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Array(&nbsp;&quot;uvs_id&quot;=&gt;$this-&gt;uvs_id,&nbsp;&quot;device_id&quot;=&gt;$this-&gt;device_id,&nbsp;&quot;status&quot;=&gt;$this-&gt;status,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+366</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;device_name&quot;=&gt;$this-&gt;device_name,&nbsp;&quot;create_time&quot;=&gt;$this-&gt;create_time,&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+367</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;activation_time&quot;=&gt;$this-&gt;activation_time,&nbsp;&quot;update_time&quot;=&gt;$this-&gt;update_time,&nbsp;&quot;p12&quot;=&gt;$this-&gt;p12</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+368</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span>369</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>370</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>371</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;generate_activation_email($email,&nbsp;$activation_code)&nbsp;{&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">372</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_null($email))&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">373</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</span></code></td></tr><tr><td class="coverageDetails"><span>374</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>375</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>376</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;subject</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">377</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$subject&nbsp;=&nbsp;'Activation&nbsp;Code&nbsp;for&nbsp;your&nbsp;Usher&nbsp;Device';</span></code></td></tr><tr><td class="coverageDetails"><span>378</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;message</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">379</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$message&nbsp;=&nbsp;'</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+380</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;html&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+381</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+382</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;Activation&nbsp;Code&nbsp;for&nbsp;Your&nbsp;Usher&nbsp;Device&lt;/title&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+383</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+384</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+385</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Please&nbsp;use&nbsp;this&nbsp;code&nbsp;to&nbsp;confirm&nbsp;your&nbsp;Device&nbsp;Activation:&lt;/p&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+386</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;'.$activation_code.'&lt;/p&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+387</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+388</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/html&gt;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+389</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';</span></code></td></tr><tr><td class="coverageDetails"><span>390</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>391</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;To&nbsp;send&nbsp;HTML&nbsp;mail,&nbsp;the&nbsp;Content-type&nbsp;header&nbsp;must&nbsp;be&nbsp;set</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">392</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;&nbsp;=&nbsp;'MIME-Version:&nbsp;1.0'&nbsp;.&nbsp;&quot;\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">393</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;.=&nbsp;'Content-type:&nbsp;text/html;&nbsp;charset=iso-8859-1'&nbsp;.&nbsp;&quot;\n&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">394</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;.=&nbsp;'From:&nbsp;usher.com&nbsp;&lt;noreply@usher.com&gt;'&nbsp;.&nbsp;&quot;\n&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span>395</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>396</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$is_success&nbsp;=&nbsp;mail($email,&nbsp;$subject,&nbsp;$message,&nbsp;$headers);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">397</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$message&nbsp;=&nbsp;'Please&nbsp;use&nbsp;this&nbsp;code&nbsp;to&nbsp;confirm&nbsp;your&nbsp;Device&nbsp;Activation:';</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">398</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$is_success&nbsp;=&nbsp;Util::mail_code($email,&nbsp;$subject,&nbsp;$message,&nbsp;$activation_code,&nbsp;$headers);</span></code></td></tr><tr><td class="coverageDetails"><span>399</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">400</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$is_success;</span></code></td></tr><tr><td class="coverageDetails"><span>401</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>402</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>403</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;delete($uvs_id,&nbsp;$device_id)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">404</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">405</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$device_id&nbsp;=&nbsp;(int)$device_id;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">406</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!&nbsp;($uvs_id&nbsp;&amp;&amp;&nbsp;$device_id)&nbsp;){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">407</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;</span></code></td></tr><tr><td class="coverageDetails"><span>408</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">409</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span>410</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">411</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;user_device&nbsp;set&nbsp;status='deleted'&nbsp;where&nbsp;uvs_id=:uvs_id&nbsp;and&nbsp;user_device_id=:device_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">412</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$data&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+413</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:uvs_id&quot;=&gt;$uvs_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+414</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&quot;:device_id&quot;=&gt;$device_id</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">+415</span></td><td class="coverageDetails"><span class="codeExecuted">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">);</span></code></td></tr><tr><td class="coverageDetails"><span>416</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">417</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">$result&nbsp;=&nbsp;$conn-&gt;execute($query&nbsp;,&nbsp;$data);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">418</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$result-&gt;num_affected_rows()&nbsp;&gt;&nbsp;0&nbsp;){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">419</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</span></code></td></tr><tr><td class="coverageDetails"><span>420</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">421</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></code></td></tr><tr><td class="coverageDetails"><span>422</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>423</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>424</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>425</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;update($conn,&nbsp;$query)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span>426</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query);</span></code></td></tr><tr><td class="coverageDetails"><span>427</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>428</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>429</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get_p12(){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">430</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$CA_CERT&nbsp;=&nbsp;&quot;/Users/smironenko/test_ca/clientca.crt&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">431</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$CA_KEY&nbsp;&nbsp;=&nbsp;&quot;/Users/smironenko/test_ca/clientca.key&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">432</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$serial&nbsp;=&nbsp;125;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">433</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$email&nbsp;=&nbsp;&quot;test@tst.com&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">434</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req_key&nbsp;=&nbsp;openssl_pkey_new(array('digest_alg'&nbsp;=&gt;&nbsp;'sha1',&nbsp;'private_key_type'&nbsp;=&gt;&nbsp;OPENSSL_KEYTYPE_RSA,'private_key_bits'&nbsp;=&gt;&nbsp;2048));</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">435</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$dn&nbsp;=&nbsp;array(</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+436</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;countryName&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&quot;US&quot;,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+437</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;stateOrProvinceName&quot;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&quot;VA&quot;,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+438</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;organizationName&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&quot;Microstrategy&quot;,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+439</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;organizationalUnitName&quot;&nbsp;=&gt;&nbsp;&quot;Usher&quot;,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+440</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;commonName&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&quot;$email&quot;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+441</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">442</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req_csr&nbsp;&nbsp;=&nbsp;openssl_csr_new&nbsp;($dn,&nbsp;$req_key);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">443</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req_cert&nbsp;=&nbsp;openssl_csr_sign($req_csr,&nbsp;&quot;file://$CA_CERT&quot;,&nbsp;&quot;file://$CA_KEY&quot;,&nbsp;365,&nbsp;NULL,&nbsp;$serial);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">444</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;openssl_pkcs12_export(&nbsp;$req_cert,&nbsp;$p12,&nbsp;$req_key,&nbsp;null);&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>445</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">446</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;base64_encode($p12);</span></code></td></tr><tr><td class="coverageDetails"><span>447</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>448</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>449</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span></span></code></td></tr><tr><td class="coverageDetails"><span>450</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;assemble_active_log($device){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">451</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$log&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">452</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">453</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;name&nbsp;=&nbsp;&quot;device_name&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">454</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$element-&gt;value&nbsp;=&nbsp;$device-&gt;get_device_name();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">455</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$log[]&nbsp;=&nbsp;$element;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">456</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;json_encode($log);</span></code></td></tr><tr><td class="coverageDetails"><span>457</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>458</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>459</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;save_active_log($device,&nbsp;$event_type){</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">460</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params&nbsp;=&nbsp;self::assemble_active_log($device);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">461</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$active_logs&nbsp;=&nbsp;array();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">462</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$active_log&nbsp;=&nbsp;new&nbsp;stdClass();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">463</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$active_log-&gt;event_type&nbsp;=&nbsp;$event_type;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">464</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$active_log-&gt;uvs_id&nbsp;=&nbsp;$device-&gt;get_uvs_id();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">465</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$active_log-&gt;parameters&nbsp;=&nbsp;$params;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">466</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$active_log-&gt;event_icon&nbsp;=&nbsp;&quot;img/device_activity_icon.png&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">467</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;$active_logs[]&nbsp;=&nbsp;$active_log;</span></code></td></tr><tr><td class="coverageDetails"><span>468</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeExecuted">469</span></td><td class="coverageDetails"><span class="codeExecuted">1</span></td><td class="coverageDetailsCode"><code><span class="codeExecuted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User::add_active_logs($active_logs);</span></code></td></tr><tr><td class="coverageDetails"><span>470</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>471</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>472</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//&nbsp;public&nbsp;static&nbsp;function&nbsp;activate_if_previously_authorized($uvs_id,&nbsp;$device_uid){</span></code></td></tr><tr><td class="coverageDetails"><span>473</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;$uvs_id&nbsp;=&nbsp;(int)$uvs_id;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>474</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;if&nbsp;($uvs_id&nbsp;&nbsp;&gt;=&nbsp;0)&nbsp;{&nbsp;return&nbsp;null;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>475</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;$query&nbsp;=&nbsp;&quot;SELECT&nbsp;*&nbsp;from&nbsp;user_device&nbsp;where&nbsp;uvs_id=$uvs_id&nbsp;AND&nbsp;device_uid=$device_uid_esc&nbsp;and&nbsp;status='active'&quot;;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>476</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;//&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>477</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>478</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;update($uvs_id,&nbsp;$device_id,&nbsp;$device_name)&nbsp;{</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">479</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;=&nbsp;UVSDatabase::create_connection();</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">480</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query&nbsp;=&nbsp;&quot;UPDATE&nbsp;user_device&nbsp;SET&nbsp;device_name&nbsp;=&nbsp;:device_name&nbsp;WHERE&nbsp;uvs_id&nbsp;=&nbsp;:uvs_id&nbsp;AND&nbsp;user_device_id&nbsp;=&nbsp;:user_device_id&quot;;</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">481</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params&nbsp;=&nbsp;array(&quot;:device_name&quot;=&gt;$device_name,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+482</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:uvs_id&quot;=&gt;$uvs_id,</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">+483</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:user_device_id&quot;=&gt;$device_id);</span></code></td></tr><tr><td class="coverageDetails"><span class="codeMissed">484</span></td><td class="coverageDetails"><span class="codeMissed">&nbsp;</span></td><td class="coverageDetailsCode"><code><span class="codeMissed">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn-&gt;execute($query,&nbsp;$params);</span></code></td></tr><tr><td class="coverageDetails"><span>485</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;}</span></code></td></tr><tr><td class="coverageDetails"><span>486</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr><tr><td class="coverageDetails"><span>487</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>}</span></code></td></tr><tr><td class="coverageDetails"><span>488</span></td><td class="coverageDetails"><span>&nbsp;</span></td><td class="coverageDetailsCode"><code><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></code></td></tr></table></td></tr>
  </table>

    </div>
  </body>
</html>
